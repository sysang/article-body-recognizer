<!DOCTYPE html>
<html>
<head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

        <script> var url = encodeURIComponent('https://wiki.php.net/rfc/fibers');</script>

        <script> var body_html = 'PGJvZHkgPiA8ZGl2ID4gPGhlYWRlciA+ICA8L2hlYWRlcj4gPHNlY3Rpb24gPiA8c2VjdGlvbiA+ICA8L3NlY3Rpb24+IDxzZWN0aW9uID4gPGRpdiA+PGRpdiA+IDxkaXYgPiA8ZGl2ID48ZGl2ID4gPGRpdiA+cmZjOmZpYmVyczwvZGl2PiA8ZGl2ID4gPGgxID5QSFAgUkZDOiBGaWJlcnM8L2gxPiA8ZGl2ID4gPHVsPiA8bGkgPjxkaXYgPiBEYXRlOiAyMDIxLTAzLTA4PC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IEF1dGhvcnM6IEFhcm9uIFBpb3Ryb3dza2kgdHJvd3NraUBwaHAubmV0LCBOaWtsYXMgS2VsbGVyIGtlbHVuaWtAcGhwLm5ldDwvZGl2PiA8L2xpPiA8bGkgPjxkaXYgPiBTdGF0dXM6IEltcGxlbWVudGVkPC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IEZpcnN0IFB1Ymxpc2hlZCBhdDogaHR0cDovL3dpa2kucGhwLm5ldC9yZmMvZmliZXJzPC9kaXY+IDwvbGk+IDwvdWw+IDwvZGl2PiA8aDIgPkludHJvZHVjdGlvbjwvaDI+IDxkaXYgPiA8cD4gRm9yIG1vc3Qgb2YgUEhQ4oCZcyBoaXN0b3J5LCBwZW9wbGUgaGF2ZSB3cml0dGVuIFBIUCBjb2RlIG9ubHkgYXMgc3luY2hyb25vdXMgY29kZS4gRXhlY3V0aW9uIG9mIGZ1bmN0aW9ucyBzdG9wcyB1bnRpbCBhIHJlc3VsdCBpcyBhdmFpbGFibGUgdG8gcmV0dXJuIGZyb20gdGhlIGZ1bmN0aW9uLCBpbmNsdWRpbmcgZm9yIEkvTyBvcGVyYXRpb25zLCB3aGljaCBjYW4gYmUgcXVpdGUgc2xvdy4gPC9wPiA8cD4gTW9yZSByZWNlbnRseSwgdGhlcmUgaGF2ZSBiZWVuIG11bHRpcGxlIHByb2plY3RzIHRoYXQgaGF2ZSBhbGxvd2VkIHBlb3BsZSB0byB3cml0ZSBhc3luY2hyb25vdXMgUEhQIGNvZGUgdG8gYWxsb3cgZm9yIGNvbmN1cnJlbnQgSS9PIG9wZXJhdGlvbnMuIEFzeW5jaHJvbm91cyBmdW5jdGlvbnMgYWNjZXB0IGEgY2FsbGJhY2sgb3IgcmV0dXJuIGEgcGxhY2Vob2xkZXIgZm9yIGEgZnV0dXJlIHZhbHVlIChzdWNoIGFzIGEgcHJvbWlzZSkgdG8gcnVuIGNvZGUgYXQgYSBmdXR1cmUgdGltZSBvbmNlIHRoZSByZXN1bHQgaXMgYXZhaWxhYmxlLiBFeGVjdXRpb24gY29udGludWVzIHdpdGhvdXQgd2FpdGluZyBmb3IgYSByZXN1bHQuIEV4YW1wbGVzIG9mIHRoZXNlIHByb2plY3RzIGFyZSBhbXBocCwgUmVhY3RQSFAsIGFuZCBHdXp6bGUuIDwvcD4gPHA+IFRoZSBwcm9ibGVtIHRoaXMgPGFiYnIgPlJGQzwvYWJicj4gc2Vla3MgdG8gYWRkcmVzcyBpcyBhIGRpZmZpY3VsdCBvbmUgdG8gZXhwbGFpbiwgYnV0IGNhbiBiZSByZWZlcnJlZCB0byBhcyB0aGUg4oCcV2hhdCBjb2xvciBpcyB5b3VyIGZ1bmN0aW9uP+KAnSBwcm9ibGVtLiA8L3A+IDxwPiBBIHN1bW1hcnkgb2YgdGhlIHByb2JsZW0gZGVzY3JpYmVkIGluIHRoZSBsaW5rZWQgYXJ0aWNsZSBpczogPC9wPiA8dWw+IDxsaSA+PGRpdiA+IEFzeW5jaHJvbm91cyBmdW5jdGlvbnMgY2hhbmdlIHRoZSB3YXkgdGhlIGZ1bmN0aW9uIG11c3QgYmUgY2FsbGVkLjwvZGl2PiA8L2xpPiA8bGkgPjxkaXYgPiBTeW5jaHJvbm91cyBmdW5jdGlvbnMgbWF5IG5vdCBjYWxsIGFuIGFzeW5jaHJvbm91cyBmdW5jdGlvbiAodGhvdWdoIGFzeW5jaHJvbm91cyBmdW5jdGlvbnMgbWF5IGNhbGwgc3luY2hyb25vdXMgZnVuY3Rpb25zKS48L2Rpdj4gPC9saT4gPGxpID48ZGl2ID4gQ2FsbGluZyBhbiBhc3luY2hyb25vdXMgZnVuY3Rpb24gcmVxdWlyZXMgdGhlIGVudGlyZSBjYWxsIHN0YWNrIHRvIGJlIGFzeW5jaHJvbm91czwvZGl2PiA8L2xpPiA8L3VsPiA8cD4gRm9yIHBlb3BsZSB3aG8gYXJlIGZhbWlsaWFyIHdpdGggdXNpbmcgcHJvbWlzZXMgYW5kL29yIGF3YWl0L3lpZWxkIHRvIGFjaGlldmUgd3JpdGluZyBhc3luY2hyb25vdXMgY29kZSwgdGhlIHByb2JsZW0gY2FuIGJlIGV4cHJlc3NlZCBhczog4oCcT25jZSBvbmUgZnVuY3Rpb24gcmV0dXJucyBhIHByb21pc2Ugc29tZXdoZXJlIGluIHlvdXIgY2FsbCBzdGFjaywgdGhlIGVudGlyZSBjYWxsIHN0YWNrIG5lZWRzIHRvIHJldHVybiBhIHByb21pc2UgYmVjYXVzZSB0aGUgcmVzdWx0IG9mIHRoZSBjYWxsIGNhbm5vdCBiZSBrbm93biB1bnRpbCB0aGUgcHJvbWlzZSBpcyByZXNvbHZlZC7igJ0gPC9wPiA8cD4gVGhpcyA8YWJiciA+UkZDPC9hYmJyPiBzZWVrcyB0byBlbGltaW5hdGUgdGhlIGRpc3RpbmN0aW9uIGJldHdlZW4gc3luY2hyb25vdXMgYW5kIGFzeW5jaHJvbm91cyBmdW5jdGlvbnMgYnkgYWxsb3dpbmcgZnVuY3Rpb25zIHRvIGJlIGludGVycnVwdGlibGUgd2l0aG91dCBwb2xsdXRpbmcgdGhlIGVudGlyZSBjYWxsIHN0YWNrLiBUaGlzIHdvdWxkIGJlIGFjaGlldmVkIGJ5OiA8L3A+IDx1bD4gPGxpID48ZGl2ID4gQWRkaW5nIHN1cHBvcnQgZm9yIEZpYmVycyB0byBQSFAuPC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IEFkZGluZyBhIDxjb2RlPkZpYmVyPC9jb2RlPiBjbGFzcyBhbmQgdGhlIGNvcnJlc3BvbmRpbmcgcmVmbGVjdGlvbiBjbGFzcyA8Y29kZT5SZWZsZWN0aW9uRmliZXI8L2NvZGU+LjwvZGl2PiA8L2xpPiA8bGkgPjxkaXYgPiBBZGRpbmcgZXhjZXB0aW9uIGNsYXNzZXMgPGNvZGU+RmliZXJFcnJvcjwvY29kZT4gYW5kIDxjb2RlPkZpYmVyRXhpdDwvY29kZT4gdG8gcmVwcmVzZW50IGVycm9ycy48L2Rpdj4gPC9saT4gPC91bD4gPHA+IEZpYmVycyBhbGxvdyBmb3IgdHJhbnNwYXJlbnQgbm9uLWJsb2NraW5nIEkvTyBpbXBsZW1lbnRhdGlvbnMgb2YgZXhpc3RpbmcgaW50ZXJmYWNlcyAoc3VjaCBhcyBQU1ItNywgRG9jdGluZSBPUk0sIGV0Yy4pLiBUaGlzIGlzIGJlY2F1c2UgdGhlIHBsYWNlaG9sZGVyIChwcm9taXNlKSBvYmplY3QgaXMgZWxpbWluYXRlZC4gRnVuY3Rpb25zIGluc3RlYWQgY2FuIGRlY2xhcmUgdGhlIEkvTyByZXN1bHQgdHlwZSBpbnN0ZWFkIG9mIGEgcGxhY2Vob2xkZXIgb2JqZWN0IHdoaWNoIGNhbm5vdCBzcGVjaWZ5IGEgcmVzb2x1dGlvbiB0eXBlIGJlY2F1c2UgUEhQIGRvZXMgbm90IHN1cHBvcnQgZ2VuZXJpY3MuIDwvcD4gPC9kaXY+IDxoMyA+RmliZXJzPC9oMz4gPGRpdiA+IDxwPiBGaWJlcnMgYWxsb3cgdGhlIGNyZWF0aW9uIG9mIGZ1bGwtc3RhY2ssIGludGVycnVwdGlibGUgZnVuY3Rpb25zIHRoYXQgY2FuIGJlIHVzZWQgdG8gaW1wbGVtZW50IGNvb3BlcmF0aXZlIG11bHRpdGFza2luZyBpbiBQSFAuIFRoZXNlIGFyZSBhbHNvIGtub3duIGFzIGNvcm91dGluZXMgb3IgZ3JlZW4tdGhyZWFkcy4gPC9wPiA8cD4gRmliZXJzIHBhdXNlIHRoZSBlbnRpcmUgZXhlY3V0aW9uIHN0YWNrLCBzbyB0aGUgZGlyZWN0IGNhbGxlciBvZiB0aGUgZnVuY3Rpb24gZG9lcyBub3QgbmVlZCB0byBjaGFuZ2UgaG93IGl0IGludm9rZXMgdGhlIGZ1bmN0aW9uLiA8L3A+IDxwPiBFeGVjdXRpb24gbWF5IGJlIGludGVycnVwdGVkIGFueXdoZXJlIGluIHRoZSBjYWxsIHN0YWNrIHVzaW5nIDxjb2RlPkZpYmVyOjpzdXNwZW5kKCk8L2NvZGU+ICh0aGF0IGlzLCB0aGUgY2FsbCB0byA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPiBtYXkgYmUgaW4gYSBkZWVwbHkgbmVzdGVkIGZ1bmN0aW9uIG9yIG5vdCBldmVuIGV4aXN0IGF0IGFsbCkuIDwvcD4gPHA+IFVubGlrZSBzdGFjay1sZXNzIEdlbmVyYXRvcnMsIGVhY2ggRmliZXIgaGFzIGl0cyBvd24gY2FsbCBzdGFjaywgYWxsb3dpbmcgdGhlbSB0byBiZSBwYXVzZWQgd2l0aGluIGRlZXBseSBuZXN0ZWQgZnVuY3Rpb24gY2FsbHMuIEEgZnVuY3Rpb24gZGVjbGFyaW5nIGFuIGludGVycnVwdGlvbiBwb2ludCAoaS5lLiwgY2FsbGluZyA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPikgbmVlZCBub3QgY2hhbmdlIGl0cyByZXR1cm4gdHlwZSwgdW5saWtlIGEgZnVuY3Rpb24gdXNpbmcgPGNvZGU+eWllbGQ8L2NvZGU+IHdoaWNoIG11c3QgcmV0dXJuIGEgPGNvZGU+R2VuZXJhdG9yPC9jb2RlPiBpbnN0YW5jZS4gPC9wPiA8cD4gRmliZXJzIGNhbiBiZSBzdXNwZW5kZWQgaW4gYW55IGZ1bmN0aW9uIGNhbGwsIGluY2x1ZGluZyB0aG9zZSBjYWxsZWQgZnJvbSB3aXRoaW4gdGhlIFBIUCBWTSwgc3VjaCBhcyBmdW5jdGlvbnMgcHJvdmlkZWQgdG8gPGNvZGU+YXJyYXlfbWFwPC9jb2RlPiBvciBtZXRob2RzIGNhbGxlZCBieSA8Y29kZT5mb3JlYWNoPC9jb2RlPiBvbiBhbiA8Y29kZT5JdGVyYXRvcjwvY29kZT4gb2JqZWN0LiA8L3A+IDxwPiBPbmNlIHN1c3BlbmRlZCwgZXhlY3V0aW9uIG9mIHRoZSBmaWJlciBtYXkgYmUgcmVzdW1lZCB3aXRoIGFueSB2YWx1ZSB1c2luZyA8Y29kZT5GaWJlci0mZ3Q7cmVzdW1lKCk8L2NvZGU+IG9yIGJ5IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBpbnRvIHRoZSBmaWJlciB1c2luZyA8Y29kZT5GaWJlci0mZ3Q7dGhyb3coKTwvY29kZT4uIFRoZSB2YWx1ZSBpcyByZXR1cm5lZCAob3IgZXhjZXB0aW9uIHRocm93bikgZnJvbSA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPi4gPC9wPiA8L2Rpdj4gPGgyID5Qcm9wb3NhbDwvaDI+IDxoMyA+RmliZXI8L2gzPiA8ZGl2ID4gPHA+IEEgRmliZXIgd291bGQgYmUgcmVwcmVzZW50ZWQgYXMgY2xhc3Mgd2hpY2ggd291bGQgYmUgZGVmaW5lZCBpbiBjb3JlIFBIUCB3aXRoIHRoZSBmb2xsb3dpbmcgc2lnbmF0dXJlOiA8L3A+IDxibG9ja3F1b3RlID4gPHA+IEZpYmVyOjp0aGlzKCkgaGFzIGJlZW4gcmVuYW1lZCB0byBGaWJlcjo6Z2V0Q3VycmVudCgpIGR1cmluZyB0aGUgUEhQIDguMSBhbHBoYSByZWxlYXNlIHBoYXNlLiA8L3A+IDwvYmxvY2txdW90ZT48cHJlID5maW5hbCBjbGFzcyBGaWJlciB7IC8qKiAqIEBwYXJhbSBjYWxsYWJsZSAkY2FsbGJhY2sgRnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gc3RhcnRpbmcgdGhlIGZpYmVyLiAqLyBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoY2FsbGFibGUgJGNhbGxiYWNrKSB7fSAvKiogKiBTdGFydHMgZXhlY3V0aW9uIG9mIHRoZSBmaWJlci4gUmV0dXJucyB3aGVuIHRoZSBmaWJlciBzdXNwZW5kcyBvciB0ZXJtaW5hdGVzLiAqICogQHBhcmFtIG1peGVkIC4uLiRhcmdzIEFyZ3VtZW50cyBwYXNzZWQgdG8gZmliZXIgZnVuY3Rpb24uICogKiBAcmV0dXJuIG1peGVkIFZhbHVlIGZyb20gdGhlIGZpcnN0IHN1c3BlbnNpb24gcG9pbnQgb3IgTlVMTCBpZiB0aGUgZmliZXIgcmV0dXJucy4gKiAqIEB0aHJvdyBGaWJlckVycm9yIElmIHRoZSBmaWJlciBoYXMgYWxyZWFkeSBiZWVuIHN0YXJ0ZWQuICogQHRocm93IFRocm93YWJsZSBJZiB0aGUgZmliZXIgY2FsbGFibGUgdGhyb3dzIGFuIHVuY2F1Z2h0IGV4Y2VwdGlvbi4gKi8gcHVibGljIGZ1bmN0aW9uIHN0YXJ0KG1peGVkIC4uLiRhcmdzKTogbWl4ZWQge30gLyoqICogUmVzdW1lcyB0aGUgZmliZXIsIHJldHVybmluZyB0aGUgZ2l2ZW4gdmFsdWUgZnJvbSB7QHNlZSBGaWJlcjo6c3VzcGVuZCgpfS4gKiBSZXR1cm5zIHdoZW4gdGhlIGZpYmVyIHN1c3BlbmRzIG9yIHRlcm1pbmF0ZXMuICogKiBAcGFyYW0gbWl4ZWQgJHZhbHVlICogKiBAcmV0dXJuIG1peGVkIFZhbHVlIGZyb20gdGhlIG5leHQgc3VzcGVuc2lvbiBwb2ludCBvciBOVUxMIGlmIHRoZSBmaWJlciByZXR1cm5zLiAqICogQHRocm93IEZpYmVyRXJyb3IgSWYgdGhlIGZpYmVyIGhhcyBub3Qgc3RhcnRlZCwgaXMgcnVubmluZywgb3IgaGFzIHRlcm1pbmF0ZWQuICogQHRocm93IFRocm93YWJsZSBJZiB0aGUgZmliZXIgY2FsbGFibGUgdGhyb3dzIGFuIHVuY2F1Z2h0IGV4Y2VwdGlvbi4gKi8gcHVibGljIGZ1bmN0aW9uIHJlc3VtZShtaXhlZCAkdmFsdWUgPSBudWxsKTogbWl4ZWQge30gLyoqICogVGhyb3dzIHRoZSBnaXZlbiBleGNlcHRpb24gaW50byB0aGUgZmliZXIgZnJvbSB7QHNlZSBGaWJlcjo6c3VzcGVuZCgpfS4gKiBSZXR1cm5zIHdoZW4gdGhlIGZpYmVyIHN1c3BlbmRzIG9yIHRlcm1pbmF0ZXMuICogKiBAcGFyYW0gVGhyb3dhYmxlICRleGNlcHRpb24gKiAqIEByZXR1cm4gbWl4ZWQgVmFsdWUgZnJvbSB0aGUgbmV4dCBzdXNwZW5zaW9uIHBvaW50IG9yIE5VTEwgaWYgdGhlIGZpYmVyIHJldHVybnMuICogKiBAdGhyb3cgRmliZXJFcnJvciBJZiB0aGUgZmliZXIgaGFzIG5vdCBzdGFydGVkLCBpcyBydW5uaW5nLCBvciBoYXMgdGVybWluYXRlZC4gKiBAdGhyb3cgVGhyb3dhYmxlIElmIHRoZSBmaWJlciBjYWxsYWJsZSB0aHJvd3MgYW4gdW5jYXVnaHQgZXhjZXB0aW9uLiAqLyBwdWJsaWMgZnVuY3Rpb24gdGhyb3coVGhyb3dhYmxlICRleGNlcHRpb24pOiBtaXhlZCB7fSAvKiogKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgZmliZXIgaGFzIGJlZW4gc3RhcnRlZC4gKi8gcHVibGljIGZ1bmN0aW9uIGlzU3RhcnRlZCgpOiBib29sIHt9IC8qKiAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBmaWJlciBpcyBzdXNwZW5kZWQuICovIHB1YmxpYyBmdW5jdGlvbiBpc1N1c3BlbmRlZCgpOiBib29sIHt9IC8qKiAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBmaWJlciBpcyBjdXJyZW50bHkgcnVubmluZy4gKi8gcHVibGljIGZ1bmN0aW9uIGlzUnVubmluZygpOiBib29sIHt9IC8qKiAqIEByZXR1cm4gYm9vbCBUcnVlIGlmIHRoZSBmaWJlciBoYXMgY29tcGxldGVkIGV4ZWN1dGlvbiAocmV0dXJuZWQgb3IgdGhyZXcpLiAqLyBwdWJsaWMgZnVuY3Rpb24gaXNUZXJtaW5hdGVkKCk6IGJvb2wge30gLyoqICogQHJldHVybiBtaXhlZCBSZXR1cm4gdmFsdWUgb2YgdGhlIGZpYmVyIGNhbGxiYWNrLiBOVUxMIGlzIHJldHVybmVkIGlmIHRoZSBmaWJlciBkb2VzIG5vdCBoYXZlIGEgcmV0dXJuIHN0YXRlbWVudC4gKiAqIEB0aHJvd3MgRmliZXJFcnJvciBJZiB0aGUgZmliZXIgaGFzIG5vdCB0ZXJtaW5hdGVkIG9yIHRoZSBmaWJlciB0aHJldyBhbiBleGNlcHRpb24uICovIHB1YmxpYyBmdW5jdGlvbiBnZXRSZXR1cm4oKTogbWl4ZWQge30gLyoqICogQHJldHVybiBzZWxmfG51bGwgUmV0dXJucyB0aGUgY3VycmVudGx5IGV4ZWN1dGluZyBmaWJlciBpbnN0YW5jZSBvciBOVUxMIGlmIGluIHttYWlufS4gKi8gcHVibGljIHN0YXRpYyBmdW5jdGlvbiB0aGlzKCk6ID9zZWxmIHt9IC8qKiAqIFN1c3BlbmQgZXhlY3V0aW9uIG9mIHRoZSBmaWJlci4gVGhlIGZpYmVyIG1heSBiZSByZXN1bWVkIHdpdGgge0BzZWUgRmliZXI6OnJlc3VtZSgpfSBvciB7QHNlZSBGaWJlcjo6dGhyb3coKX0uICogKiBDYW5ub3QgYmUgY2FsbGVkIGZyb20ge21haW59LiAqICogQHBhcmFtIG1peGVkICR2YWx1ZSBWYWx1ZSB0byByZXR1cm4gZnJvbSB7QHNlZSBGaWJlcjo6cmVzdW1lKCl9IG9yIHtAc2VlIEZpYmVyOjp0aHJvdygpfS4gKiAqIEByZXR1cm4gbWl4ZWQgVmFsdWUgcHJvdmlkZWQgdG8ge0BzZWUgRmliZXI6OnJlc3VtZSgpfS4gKiAqIEB0aHJvd3MgRmliZXJFcnJvciBUaHJvd24gaWYgbm90IHdpdGhpbiBhIGZpYmVyIChpLmUuLCBpZiBjYWxsZWQgZnJvbSB7bWFpbn0pLiAqIEB0aHJvd3MgVGhyb3dhYmxlIEV4Y2VwdGlvbiBwcm92aWRlZCB0byB7QHNlZSBGaWJlcjo6dGhyb3coKX0uICovIHB1YmxpYyBzdGF0aWMgZnVuY3Rpb24gc3VzcGVuZChtaXhlZCAkdmFsdWUgPSBudWxsKTogbWl4ZWQge30gfTwvcHJlPiA8cD4gQSA8Y29kZT5GaWJlcjwvY29kZT4gb2JqZWN0IGlzIGNyZWF0ZWQgdXNpbmcgPGNvZGU+bmV3IEZpYmVyKGNhbGxhYmxlICRjYWxsYmFjayk8L2NvZGU+IHdpdGggYW55IGNhbGxhYmxlLiBUaGUgY2FsbGFibGUgbmVlZCBub3QgY2FsbCA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPiBkaXJlY3RseSwgaXQgbWF5IGJlIGluIGEgZGVlcGx5IG5lc3RlZCBjYWxsLCBmYXIgZG93biB0aGUgY2FsbCBzdGFjayAob3IgcGVyaGFwcyBuZXZlciBjYWxsIDxjb2RlPkZpYmVyOjpzdXNwZW5kKCk8L2NvZGU+IGF0IGFsbCkuIFRoZSBuZXcgPGNvZGU+RmliZXI8L2NvZGU+IG1heSBiZSBzdGFydGVkIHVzaW5nIDxjb2RlPkZpYmVyLSZndDtzdGFydChtaXhlZCAuLi4kYXJncyk8L2NvZGU+IHdpdGggYSB2YXJpYWRpYyBhcmd1bWVudCBsaXN0IHRoYXQgaXMgcHJvdmlkZWQgYXMgYXJndW1lbnRzIHRvIHRoZSBjYWxsYWJsZSB1c2VkIHdoZW4gY3JlYXRpbmcgdGhlIDxjb2RlPkZpYmVyPC9jb2RlPi4gPC9wPiA8cD4gPGNvZGU+RmliZXI6OnN1c3BlbmQoKTwvY29kZT4gc3VzcGVuZHMgZXhlY3V0aW9uIG9mIHRoZSBjdXJyZW50IGZpYmVyIGFuZCByZXR1cm5zIGV4ZWN1dGlvbiB0byB0aGUgY2FsbCB0byA8Y29kZT5GaWJlci0mZ3Q7c3RhcnQoKTwvY29kZT4sIDxjb2RlPkZpYmVyLSZndDtyZXN1bWUoKTwvY29kZT4sIG9yIDxjb2RlPkZpYmVyLSZndDt0aHJvdygpPC9jb2RlPi4gQ29uc2lkZXIgPGNvZGU+RmliZXI6OnN1c3BlbmQoKTwvY29kZT4gdG8gYmUgc2ltaWxhciB0byBhIGdlbmVyYXRvciB1c2luZyA8Y29kZT55aWVsZDwvY29kZT4sIHdoaWNoIHJldHVybnMgZXhlY3V0aW9uIHRvIHRoZSBjYWxsIHRoYXQgYWR2YW5jZWQgdGhlIGdlbmVyYXRvci4gPC9wPiA8cD4gQSBzdXNwZW5kZWQgZmliZXIgbWF5IGJlIHJlc3VtZWQgaW4gb25lIG9mIHR3byB3YXlzOiA8L3A+IDx1bD4gPGxpID48ZGl2ID4gcmV0dXJuaW5nIGEgdmFsdWUgZnJvbSA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPiB1c2luZyA8Y29kZT5GaWJlci0mZ3Q7cmVzdW1lKCk8L2NvZGU+PC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IHRocm93aW5nIGFuIGV4Y2VwdGlvbiBmcm9tIDxjb2RlPkZpYmVyOjpzdXNwZW5kKCk8L2NvZGU+IHVzaW5nIDxjb2RlPkZpYmVyLSZndDt0aHJvdygpPC9jb2RlPjwvZGl2PiA8L2xpPiA8L3VsPiA8cD4gPGNvZGU+RmliZXItJmd0O2dldFJldHVybigpPC9jb2RlPiByZXR1cm5zIHRoZSB2YWx1ZSByZXR1cm5lZCBmcm9tIGEgdGVybWluYXRlZCBmaWJlciAoPGNvZGU+TlVMTDwvY29kZT4gaXMgcmV0dXJuZWQgaWYgdGhlIGZpYmVyIGRpZCBub3QgcmV0dXJuIGEgdmFsdWUpLiBUaGlzIGZ1bmN0aW9uIHdpbGwgdGhyb3cgYW4gaW5zdGFuY2Ugb2YgPGNvZGU+RmliZXJFcnJvcjwvY29kZT4gaWYgdGhlIGZpYmVyIGhhcyBub3QgY29tcGxldGVkIGV4ZWN1dGlvbiBvciB0aHJldyBhbiBleGNlcHRpb24uIDwvcD4gPHA+IDxjb2RlPkZpYmVyOjp0aGlzKCk8L2NvZGU+IHJldHVybnMgdGhlIGN1cnJlbnRseSBleGVjdXRpbmcgPGNvZGU+RmliZXI8L2NvZGU+IGluc3RhbmNlIG9yIDxjb2RlPk5VTEw8L2NvZGU+IGlmIGNhbGxlZCBmcm9tIDxjb2RlPnttYWlufTwvY29kZT4uIFRoaXMgYWxsb3dzIGEgZmliZXIgdG8gc3RvcmUgYSByZWZlcmVuY2UgdG8gaXRzZWxmIGVsc2V3aGVyZSwgc3VjaCBhcyB3aXRoaW4gYW4gZXZlbnQgbG9vcCBjYWxsYmFjayBvciBhbiBhcnJheSBvZiBhd2FpdGluZyBmaWJlcnMuIDwvcD4gPC9kaXY+IDxoMyA+UmVmbGVjdGlvbkZpYmVyPC9oMz4gPGRpdiA+IDxwPiA8Y29kZT5SZWZsZWN0aW9uRmliZXI8L2NvZGU+IGlzIHVzZWQgdG8gaW5zcGVjdCBleGVjdXRpbmcgZmliZXJzLiBBIDxjb2RlPlJlZmxlY3Rpb25GaWJlcjwvY29kZT4gb2JqZWN0IGNhbiBiZSBjcmVhdGVkIGZyb20gYW55IDxjb2RlPkZpYmVyPC9jb2RlPiBvYmplY3QsIGV2ZW4gaWYgaXQgaGFzIG5vdCBiZWVuIHN0YXJ0ZWQgb3IgaWYgaXQgaGFzIHRlcm1pbmF0ZWQuIFRoaXMgcmVmbGVjdGlvbiBjbGFzcyBpcyBzaW1pbGFyIHRvIDxjb2RlPlJlZmxlY3Rpb25HZW5lcmF0b3I8L2NvZGU+LiA8L3A+IDxwcmUgPmZpbmFsIGNsYXNzIFJlZmxlY3Rpb25GaWJlciB7IC8qKiAqIEBwYXJhbSBGaWJlciAkZmliZXIgQW55IEZpYmVyIG9iamVjdCwgaW5jbHVkaW5nIHRob3NlIHRoYXQgYXJlIG5vdCBzdGFydGVkIG9yIGhhdmUgKiB0ZXJtaW5hdGVkLiAqLyBwdWJsaWMgZnVuY3Rpb24gX19jb25zdHJ1Y3QoRmliZXIgJGZpYmVyKSB7fSAvKiogKiBAcmV0dXJuIEZpYmVyIFRoZSByZWZsZWN0ZWQgRmliZXIgb2JqZWN0LiAqLyBwdWJsaWMgZnVuY3Rpb24gZ2V0RmliZXIoKTogRmliZXIge30gLyoqICogQHJldHVybiBzdHJpbmcgQ3VycmVudCBmaWxlIG9mIGZpYmVyIGV4ZWN1dGlvbi4gKi8gcHVibGljIGZ1bmN0aW9uIGdldEV4ZWN1dGluZ0ZpbGUoKTogc3RyaW5nIHt9IC8qKiAqIEByZXR1cm4gaW50IEN1cnJlbnQgbGluZSBvZiBmaWJlciBleGVjdXRpb24uICovIHB1YmxpYyBmdW5jdGlvbiBnZXRFeGVjdXRpbmdMaW5lKCk6IGludCB7fSAvKiogKiBAcGFyYW0gaW50ICRvcHRpb25zIFNhbWUgZmxhZ3MgYXMge0BzZWUgZGVidWdfYmFja3RyYWNlKCl9LiAqICogQHJldHVybiBhcnJheSBGaWJlciBiYWNrdHJhY2UsIHNpbWlsYXIgdG8ge0BzZWUgZGVidWdfYmFja3RyYWNlKCl9ICogYW5kIHtAc2VlIFJlZmxlY3Rpb25HZW5lcmF0b3I6OmdldFRyYWNlKCl9LiAqLyBwdWJsaWMgZnVuY3Rpb24gZ2V0VHJhY2UoaW50ICRvcHRpb25zID0gREVCVUdfQkFDS1RSQUNFX1BST1ZJREVfT0JKRUNUKTogYXJyYXkge30gLyoqICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGZpYmVyIGhhcyBiZWVuIHN0YXJ0ZWQuICovIHB1YmxpYyBmdW5jdGlvbiBpc1N0YXJ0ZWQoKTogYm9vbCB7fSAvKiogKiBAcmV0dXJuIGJvb2wgVHJ1ZSBpZiB0aGUgZmliZXIgaXMgY3VycmVudGx5IHN1c3BlbmRlZC4gKi8gcHVibGljIGZ1bmN0aW9uIGlzU3VzcGVuZGVkKCk6IGJvb2wge30gLyoqICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGZpYmVyIGlzIGN1cnJlbnRseSBydW5uaW5nLiAqLyBwdWJsaWMgZnVuY3Rpb24gaXNSdW5uaW5nKCk6IGJvb2wge30gLyoqICogQHJldHVybiBib29sIFRydWUgaWYgdGhlIGZpYmVyIGhhcyBjb21wbGV0ZWQgZXhlY3V0aW9uIChlaXRoZXIgcmV0dXJuaW5nIG9yICogdGhyb3dpbmcgYW4gZXhjZXB0aW9uKSwgZmFsc2Ugb3RoZXJ3aXNlLiAqLyBwdWJsaWMgZnVuY3Rpb24gaXNUZXJtaW5hdGVkKCk6IGJvb2wge30gfTwvcHJlPiA8L2Rpdj4gPGg0ID5VbmZpbmlzaGVkIEZpYmVyczwvaDQ+IDxkaXYgPiA8cD4gRmliZXJzIHRoYXQgYXJlIG5vdCBmaW5pc2hlZCAoZG8gbm90IGNvbXBsZXRlIGV4ZWN1dGlvbikgYXJlIGRlc3Ryb3llZCBzaW1pbGFybHkgdG8gdW5maW5pc2hlZCBnZW5lcmF0b3JzLCBleGVjdXRpbmcgYW55IHBlbmRpbmcgPGNvZGU+ZmluYWxseTwvY29kZT4gYmxvY2tzLiA8Y29kZT5GaWJlcjo6c3VzcGVuZCgpPC9jb2RlPiBtYXkgbm90IGJlIGludm9rZWQgaW4gYSBmb3JjZS1jbG9zZWQgZmliZXIsIGp1c3QgYXMgPGNvZGU+eWllbGQ8L2NvZGU+IGNhbm5vdCBiZSB1c2VkIGluIGEgZm9yY2UtY2xvc2VkIGdlbmVyYXRvci4gRmliZXJzIGFyZSBkZXN0cm95ZWQgd2hlbiB0aGVyZSBhcmUgbm8gcmVmZXJlbmNlcyB0byB0aGUgPGNvZGU+RmliZXI8L2NvZGU+IG9iamVjdC4gPC9wPiA8L2Rpdj4gPGg0ID5GaWJlciBTdGFja3M8L2g0PiA8ZGl2ID4gPHA+IEVhY2ggZmliZXIgaXMgYWxsb2NhdGVkIGEgc2VwYXJhdGUgQyBzdGFjayBhbmQgVk0gc3RhY2sgb24gdGhlIGhlYXAuIFRoZSBDIHN0YWNrIGlzIGFsbG9jYXRlZCB1c2luZyA8Y29kZT5tbWFwPC9jb2RlPiBpZiBhdmFpbGFibGUsIG1lYW5pbmcgcGh5c2ljYWwgbWVtb3J5IGlzIHVzZWQgb25seSBvbiBkZW1hbmQgKGlmIGl0IG5lZWRzIHRvIGJlIGFsbG9jYXRlZCB0byBhIHN0YWNrIHZhbHVlKSBvbiBtb3N0IHBsYXRmb3Jtcy4gRWFjaCBmaWJlciBzdGFjayBpcyBhbGxvY2F0ZWQgYSBtYXhpbXVtIG9mIDhNIG9mIG1lbW9yeSBieSBkZWZhdWx0LCBzZXR0YWJsZSB3aXRoIGFuIGluaSBzZXR0aW5nIDxjb2RlPmZpYmVyLnN0YWNrX3NpemU8L2NvZGU+LiBOb3RlIHRoYXQgdGhpcyBtZW1vcnkgaXMgdXNlZCBmb3IgdGhlIEMgc3RhY2sgYW5kIGlzIG5vdCByZWxhdGVkIHRvIHRoZSBtZW1vcnkgYXZhaWxhYmxlIHRvIFBIUCBjb2RlLiBWTSBzdGFja3MgZm9yIGVhY2ggZmliZXIgYXJlIGFsbG9jYXRlZCBpbiBhIHNpbWlsYXIgd2F5IHRvIGdlbmVyYXRvcnMgYW5kIHVzZSBhIHNpbWlsYXIgYW1vdW50IG9mIG1lbW9yeSBhbmQgQ1BVLiBWTSBzdGFja3MgYXJlIGFibGUgdG8gZ3JvdyBkeW5hbWljYWxseSwgc28gb25seSBhIHNpbmdsZSBWTSBwYWdlICg0SykgaXMgaW5pdGlhbGx5IGFsbG9jYXRlZC4gPC9wPiA8L2Rpdj4gPGgyID5CYWNrd2FyZCBJbmNvbXBhdGlibGUgQ2hhbmdlczwvaDI+IDxkaXYgPiA8cD4gRGVjbGFyZXMgPGNvZGU+RmliZXI8L2NvZGU+LCA8Y29kZT5GaWJlckVycm9yPC9jb2RlPiwgPGNvZGU+RmliZXJFeGl0PC9jb2RlPiwgYW5kIDxjb2RlPlJlZmxlY3Rpb25GaWJlcjwvY29kZT4gaW4gdGhlIHJvb3QgbmFtZXNwYWNlLiBObyBvdGhlciBCQyBicmVha3MuIDwvcD4gPC9kaXY+IDxoMiA+RnV0dXJlIFNjb3BlPC9oMj4gPGRpdiA+IDxwPiBUaGUgY3VycmVudCBpbXBsZW1lbnRhdGlvbiBkb2VzIG5vdCBwcm92aWRlIGFuIGludGVybmFsIDxhYmJyID5BUEk8L2FiYnI+IGZvciBmaWJlcnMgZm9yIFBIUCBleHRlbnNpb25zLiBUaGlzIDxhYmJyID5SRkM8L2FiYnI+IGZvY3VzZXMgb24gdGhlIHVzZXIgc3BhY2UgZmliZXIgPGFiYnIgPkFQSTwvYWJicj4uIEFuIGludGVybmFsIGZpYmVyIDxhYmJyID5BUEk8L2FiYnI+IHdpbGwgYmUgYWRkZWQsIGNvbGxhYm9yYXRpbmcgd2l0aCBvdGhlciBpbnRlcm5hbCBkZXZlbG9wZXJzIGFuZCB1c2luZyBmZWVkYmFjayBmcm9tIFBIUCBleHRlbnNpb24gZGV2ZWxvcGVycywgaW5jbHVkaW5nIFN3b29sZSwgc28gZmliZXJzIGNhbiBiZSBjcmVhdGVkIGFuZCBjb250cm9sbGVkIGZyb20gUEhQIGV4dGVuc2lvbnMuIEFuIGV4dGVuc2lvbiBtYXkgc3RpbGwgb3B0aW9uYWxseSBwcm92aWRlIHRoZWlyIG93biBjdXN0b20gZmliZXIgaW1wbGVtZW50YXRpb24sIGJ1dCBhbiBpbnRlcm5hbCA8YWJiciA+QVBJPC9hYmJyPiB3b3VsZCBhbGxvdyB0aGUgZXh0ZW5zaW9uIHRvIHVzZSB0aGUgZmliZXIgaW1wbGVtZW50YXRpb24gcHJvdmlkZWQgYnkgUEhQLiA8L3A+IDwvZGl2PiA8aDIgPlByb3Bvc2VkIFBIUCBWZXJzaW9uKHMpPC9oMj4gPGRpdiA+IDxwPiBQSFAgOC4xIDwvcD4gPC9kaXY+IDxoMiA+UHJvcG9zZWQgVm90aW5nIENob2ljZXM8L2gyPiA8ZGl2ID4gPHA+IE1lcmdlIGltcGxlbWVudGF0aW9uIGludG8gY29yZSwgMi8zIHJlcXVpcmVkLiA8L3A+IDwvZGl2PiA8aDIgPlBhdGNoZXMgYW5kIFRlc3RzPC9oMj4gPGRpdiA+IDxwPiBJbXBsZW1lbnRhdGlvbiBhbmQgdGVzdHMgYXQgYW1waHAvZXh0LWZpYmVyLiA8L3A+IDxwPiBhbXBocCB2MywgYSB3b3JrLWluLXByb2dyZXNzLCB1c2VzIDxjb2RlPmV4dC1maWJlcjwvY29kZT4uIE5lYXJseSBhbGwgbGlicmFyaWVzIHVuZGVyIHRoZSBHaXRIdWIgb3JnYW5pemF0aW9uIGFtcGhwIGhhdmUgYnJhbmNoZXMgY29tcGF0aWJsZSB3aXRoIGFtcGhwIHYzLiBUaGUgYnJhbmNoZXMgYXJlIGxhYmVsZWQgYXMgPGNvZGU+dlg8L2NvZGU+LCB3aGVyZSA8Y29kZT5YPC9jb2RlPiBpcyB0aGUgY3VycmVudCB2ZXJzaW9uICsgMSAoZm9yIGV4YW1wbGUsIHRoZSA8Y29kZT52NTwvY29kZT4gYnJhbmNoIG9mIGFtcGhwL2h0dHAtY2xpZW50KS4gU2VlIHRoZSA8Y29kZT5leGFtcGxlczwvY29kZT4gZGlyZWN0b3JpZXMgaW4gdmFyaW91cyBsaWJyYXJpZXMgZm9yIHNhbXBsZXMgb2YgUEhQIGNvZGUgdXNpbmcgZmliZXJzLiA8L3A+IDxwPiBSZWFjdCBGaWJlciB1c2VzIDxjb2RlPmV4dC1maWJlcjwvY29kZT4gYW5kIHRoZSBjdXJyZW50IHN0YWJsZSB2ZXJzaW9ucyBvZiA8Y29kZT5yZWFjdC9ldmVudC1sb29wPC9jb2RlPiBhbmQgPGNvZGU+cmVhY3QvcHJvbWlzZTwvY29kZT4gdG8gY3JlYXRlIGNvcm91dGluZXMgYW5kIGF3YWl0IGFueSBpbnN0YW5jZSBvZiA8Y29kZT5SZWFjdFxQcm9taXNlXFByb21pc2VJbnRlcmZhY2U8L2NvZGU+IHVudGlsIGl0IGlzIHJlc29sdmVkLiA8L3A+IDwvZGl2PiA8aDIgPkV4YW1wbGVzPC9oMj4gPGRpdiA+IDxwPiBUaGlzIGZpcnN0IHNpbXBsZSBleGFtcGxlIGNyZWF0ZXMgYSBmaWJlciB0aGF0IGltbWVkaWF0ZWx5IHN1c3BlbmRzIHdpdGggdGhlIHN0cmluZyA8Y29kZT7igJxmaWJlcuKAnTwvY29kZT4uIFRoaXMgc3RyaW5nIGlzIHJldHVybmVkIGZyb20gdGhlIGNhbGwgdG8gPGNvZGU+JGZpYmVyLSZndDtzdGFydCgpPC9jb2RlPi4gVGhlIGZpYmVyIGlzIHRoZW4gcmVzdW1lZCB3aXRoIHRoZSBzdHJpbmcgPGNvZGU+4oCcdGVzdOKAnTwvY29kZT4sIHdoaWNoIGlzIHJldHVybmVkIGZyb20gdGhlIGNhbGwgdG8gPGNvZGU+RmliZXI6OnN1c3BlbmQoKTwvY29kZT4uIDwvcD4gPHByZSA+JGZpYmVyID0gbmV3IEZpYmVyKGZ1bmN0aW9uICgpOiB2b2lkIHsgJHZhbHVlID0gRmliZXI6OnN1c3BlbmQoJ2ZpYmVyJyk7IGVjaG8gIlZhbHVlIHVzZWQgdG8gcmVzdW1lIGZpYmVyOiAiLCAkdmFsdWUsICIiOyB9KTsgJHZhbHVlID0gJGZpYmVyLSZndDtzdGFydCgpOyBlY2hvICJWYWx1ZSBmcm9tIGZpYmVyIHN1c3BlbmRpbmc6ICIsICR2YWx1ZSwgIiI7ICRmaWJlci0mZ3Q7cmVzdW1lKCd0ZXN0Jyk7PC9wcmU+IDxwPiBUaGlzIGV4YW1wbGUgd2lsbCBvdXRwdXQgdGhlIGZvbGxvd2luZzogPC9wPiA8cHJlID5WYWx1ZSBmcm9tIGZpYmVyIHN1c3BlbmRpbmc6IGZpYmVyIFZhbHVlIHVzZWQgdG8gcmVzdW1lIGZpYmVyOiB0ZXN0PC9wcmU+IDxwPiBUaGUgbmV4dCBleGFtcGxlIGRlZmluZXMgYSB2ZXJ5IHNpbXBsZSBldmVudCBsb29wIHdpdGggdGhlIGFiaWxpdHkgdG8gcG9sbCBhIHNvY2tldCBmb3IgaW5jb21pbmcgZGF0YSwgaW52b2tpbmcgYSBjYWxsYmFjayB3aGVuIGRhdGEgYmVjb21lcyBhdmFpbGFibGUgb24gdGhlIHNvY2tldC4gVGhpcyBldmVudCBsb29wIGNhbiBub3cgYmUgdXNlZCB0byByZXN1bWUgYSBmaWJlciBvbmx5IHdoZW4gZGF0YSBiZWNvbWVzIGF2YWlsYWJsZSBvbiBhIHNvY2tldCwgYXZvaWRpbmcgYSBibG9ja2luZyByZWFkLiA8L3A+IDxwcmUgPmNsYXNzIEV2ZW50TG9vcCB7IHByaXZhdGUgc3RyaW5nICRuZXh0SWQgPSAnYSc7IHByaXZhdGUgYXJyYXkgJGRlZmVyQ2FsbGJhY2tzID0gW107IHByaXZhdGUgYXJyYXkgJHJlYWQgPSBbXTsgcHJpdmF0ZSBhcnJheSAkc3RyZWFtQ2FsbGJhY2tzID0gW107IHB1YmxpYyBmdW5jdGlvbiBydW4oKTogdm9pZCB7IHdoaWxlICghZW1wdHkoJHRoaXMtJmd0O2RlZmVyQ2FsbGJhY2tzKSB8fCAhZW1wdHkoJHRoaXMtJmd0O3JlYWQpKSB7ICRkZWZlcnMgPSAkdGhpcy0mZ3Q7ZGVmZXJDYWxsYmFja3M7ICR0aGlzLSZndDtkZWZlckNhbGxiYWNrcyA9IFtdOyBmb3JlYWNoICgkZGVmZXJzIGFzICRpZCA9Jmd0OyAkZGVmZXIpIHsgJGRlZmVyKCk7IH0gJHRoaXMtJmd0O3NlbGVjdCgkdGhpcy0mZ3Q7cmVhZCk7IH0gfSBwcml2YXRlIGZ1bmN0aW9uIHNlbGVjdChhcnJheSAkcmVhZCk6IHZvaWQgeyAkdGltZW91dCA9IGVtcHR5KCR0aGlzLSZndDtkZWZlckNhbGxiYWNrcykgPyBudWxsIDogMDsgaWYgKCFzdHJlYW1fc2VsZWN0KCRyZWFkLCAkd3JpdGUsICRleGNlcHQsICR0aW1lb3V0LCAkdGltZW91dCkpIHsgcmV0dXJuOyB9IGZvcmVhY2ggKCRyZWFkIGFzICRpZCA9Jmd0OyAkcmVzb3VyY2UpIHsgJGNhbGxiYWNrID0gJHRoaXMtJmd0O3N0cmVhbUNhbGxiYWNrc1skaWRdOyB1bnNldCgkdGhpcy0mZ3Q7cmVhZFskaWRdLCAkdGhpcy0mZ3Q7c3RyZWFtQ2FsbGJhY2tzWyRpZF0pOyAkY2FsbGJhY2soJHJlc291cmNlKTsgfSB9IHB1YmxpYyBmdW5jdGlvbiBkZWZlcihjYWxsYWJsZSAkY2FsbGJhY2spOiB2b2lkIHsgJGlkID0gJHRoaXMtJmd0O25leHRJZCsrOyAkdGhpcy0mZ3Q7ZGVmZXJDYWxsYmFja3NbJGlkXSA9ICRjYWxsYmFjazsgfSBwdWJsaWMgZnVuY3Rpb24gcmVhZCgkcmVzb3VyY2UsIGNhbGxhYmxlICRjYWxsYmFjayk6IHZvaWQgeyAkaWQgPSAkdGhpcy0mZ3Q7bmV4dElkKys7ICR0aGlzLSZndDtyZWFkWyRpZF0gPSAkcmVzb3VyY2U7ICR0aGlzLSZndDtzdHJlYW1DYWxsYmFja3NbJGlkXSA9ICRjYWxsYmFjazsgfSB9IFskcmVhZCwgJHdyaXRlXSA9IHN0cmVhbV9zb2NrZXRfcGFpciggc3RyaXBvcyhQSFBfT1MsICd3aW4nKSA9PT0gMCA/IFNUUkVBTV9QRl9JTkVUIDogU1RSRUFNX1BGX1VOSVgsIFNUUkVBTV9TT0NLX1NUUkVBTSwgU1RSRUFNX0lQUFJPVE9fSVAgKTsgLy8gU2V0IHN0cmVhbXMgdG8gbm9uLWJsb2NraW5nIG1vZGUuIHN0cmVhbV9zZXRfYmxvY2tpbmcoJHJlYWQsIGZhbHNlKTsgc3RyZWFtX3NldF9ibG9ja2luZygkd3JpdGUsIGZhbHNlKTsgJGxvb3AgPSBuZXcgRXZlbnRMb29wOyAvLyBSZWFkIGRhdGEgaW4gYSBzZXBhcmF0ZSBmaWJlciBhZnRlciBjaGVja2luZyBpZiB0aGUgc3RyZWFtIGlzIHJlYWRhYmxlLiAkZmliZXIgPSBuZXcgRmliZXIoZnVuY3Rpb24gKCkgdXNlICgkbG9vcCwgJHJlYWQpOiB2b2lkIHsgZWNobyAiV2FpdGluZyBmb3IgZGF0YS4uLiI7ICRmaWJlciA9IEZpYmVyOjp0aGlzKCk7ICRsb29wLSZndDtyZWFkKCRyZWFkLCBmbigpID0mZ3Q7ICRmaWJlci0mZ3Q7cmVzdW1lKCkpOyBGaWJlcjo6c3VzcGVuZCgpOyAkZGF0YSA9IGZyZWFkKCRyZWFkLCA4MTkyKTsgZWNobyAiUmVjZWl2ZWQgZGF0YTogIiwgJGRhdGEsICIiOyB9KTsgLy8gU3RhcnQgdGhlIGZpYmVyLCB3aGljaCB3aWxsIHN1c3BlbmQgd2hpbGUgd2FpdGluZyBmb3IgYSByZWFkIGV2ZW50LiAkZmliZXItJmd0O3N0YXJ0KCk7IC8vIERlZmVyIHdyaXRpbmcgZGF0YSB0byBhbiBldmVudCBsb29wIGNhbGxiYWNrLiAkbG9vcC0mZ3Q7ZGVmZXIoZm4oKSA9Jmd0OyBmd3JpdGUoJHdyaXRlLCAiSGVsbG8sIHdvcmxkISIpKTsgLy8gUnVuIHRoZSBldmVudCBsb29wLiAkbG9vcC0mZ3Q7cnVuKCk7PC9wcmU+IDxwPiBUaGlzIHNjcmlwdCB3aWxsIG91dHB1dCB0aGUgZm9sbG93aW5nOiA8L3A+IDxwcmUgPldhaXRpbmcgZm9yIGRhdGEuLi4gUmVjZWl2ZWQgZGF0YTogSGVsbG8sIHdvcmxkITwvcHJlPiA8cD4gSWYgdGhpcyBleGFtcGxlIHdlcmUgd3JpdHRlbiBpbiBhIHNpbWlsYXIgb3JkZXIgd2l0aG91dCBmaWJlcnMsIHRoZSBzY3JpcHQgd291bGQgYmUgdW5hYmxlIHRvIHJlYWQgZnJvbSBhIHNvY2tldCBiZWZvcmUgd3JpdGluZyB0byBpdCwgYXMgdGhlIGNhbGwgdG8gPGNvZGU+ZnJlYWQoKTwvY29kZT4gd291bGQgYmxvY2sgdW50aWwgZGF0YSB3YXMgYXZhaWxhYmxlLiA8L3A+IDxwPiBCZWxvdyBpcyBhIGNoYXJ0IGlsbHVzdHJhdGluZyBleGVjdXRpb24gZmxvdyBiZXR3ZWVuIDxjb2RlPnttYWlufTwvY29kZT4gYW5kIHRoZSBmaWJlciBjcmVhdGVkIGJ5IDxjb2RlPm5ldyBGaWJlcigpPC9jb2RlPi4gRXhlY3V0aW9uIGZsb3cgc3dpdGNoZXMgYmV0d2VlbiBmaWJlcnMgYXMgPGNvZGU+RmliZXI6OnN1c3BlbmQoKTwvY29kZT4gYW5kIDxjb2RlPkZpYmVyLSZndDtyZXN1bWUoKTwvY29kZT4gYXJlIGNhbGxlZCBvciB3aGVuIGEgZmliZXIgdGVybWluYXRlcy4gPC9wPiA8cD4gVGhlIG5leHQgZmV3IGV4YW1wbGVzIHVzZSB0aGUgYXN5bmMgZnJhbWV3b3JrIGFtcGhwIHYzIG1lbnRpb25lZCBpbiBQYXRjaGVzIGFuZCBUZXN0cyB0byBkZW1vbnN0cmF0ZSBob3cgZmliZXJzIG1heSBiZSB1c2VkIGJ5IGZyYW1ld29ya3MgdG8gY3JlYXRlIGFzeW5jaHJvbm91cyBjb2RlIHRoYXQgaXMgd3JpdHRlbiBsaWtlIHN5bmNocm9ub3VzIGNvZGUuIDwvcD4gPHA+IGFtcGhwIHYzIHVzZXMgYW4gZXZlbnQgbG9vcCBpbnRlcmZhY2UgdG9nZXRoZXIgd2l0aCBhIHZhcmlldHkgb2YgZnVuY3Rpb25zIGFuZCBhIHBsYWNlaG9sZGVyIG9iamVjdCAoPGNvZGU+UHJvbWlzZTwvY29kZT4pIHRvIGJ1aWxkIG9uIHRvcCBvZiB0aGUgdW5kZXJseWluZyBmaWJlciA8YWJiciA+QVBJPC9hYmJyPiB0byBjcmVhdGUgaXRzIG93biBvcGluaW9uYXRlZCA8YWJiciA+QVBJPC9hYmJyPiB0byBjcmVhdGUgZ3JlZW4tdGhyZWFkcyAoY29yb3V0aW5lcykgdG8gZXhlY3V0ZSBjb2RlIGNvbmN1cnJlbnRseS4gVXNlcnMgb2YgYW1waHAgdjMgZG8gbm90IHVzZSB0aGUgRmliZXIgPGFiYnIgPkFQSTwvYWJicj4gZGlyZWN0bHksIHRoZSBmcmFtZXdvcmsgaGFuZGxlcyBzdXNwZW5kaW5nIGFuZCBjcmVhdGluZyBmaWJlcnMgYXMgbmVjZXNzYXJ5LCBpbmNsdWRpbmcgYWRkaW5nIHRoZSBhYmlsaXR5IHRvIGF3YWl0IGZyb20gPGNvZGU+e21haW59fTwvY29kZT4uIE90aGVyIGZyYW1ld29ya3MgbWF5IGNob29zZSB0byBhcHByb2FjaCBjcmVhdGluZyBncmVlbi10aHJlYWRzIGFuZCBwbGFjZWhvbGRlcnMgZGlmZmVyZW50bHkuIDwvcD4gPHA+IFRoZSA8Y29kZT5kZWZlcihjYWxsYWJsZSAkY2FsbGJhY2ssIG1peGVkIC4uLiRhcmdzKTwvY29kZT4gZnVuY3Rpb24gY3JlYXRlcyBhIG5ldyBmaWJlciB0aGF0IGlzIGV4ZWN1dGVkIHdoZW4gdGhlIGN1cnJlbnQgZmliZXIgc3VzcGVuZHMgb3IgdGVybWluYXRlcy4gPGNvZGU+ZGVsYXkoaW50ICRtaWxsaXNlY29uZHMpPC9jb2RlPiBzdXNwZW5kcyB0aGUgY3VycmVudCBmaWJlciB1bnRpbCB0aGUgZ2l2ZW4gbnVtYmVyIG9mIG1pbGxpc2Vjb25kcyBoYXMgZWxhc3BlZC4gPC9wPiA8cHJlID51c2UgZnVuY3Rpb24gQW1wXGRlZmVyOyB1c2UgZnVuY3Rpb24gQW1wXGRlbGF5OyAvLyBkZWZlcigpIGNyZWF0ZXMgYSBuZXcgZmliZXIgYW5kIHN0YXJ0cyBpdCB3aGVuIHRoZSAvLyBjdXJyZW50IGZpYmVyIGlzIHN1c3BlbmRlZCBvciB0ZXJtaW5hdGVkLiBkZWZlcihmdW5jdGlvbiAoKTogdm9pZCB7IGRlbGF5KDE1MDApOyB2YXJfZHVtcCgxKTsgfSk7IGRlZmVyKGZ1bmN0aW9uICgpOiB2b2lkIHsgZGVsYXkoMTAwMCk7IHZhcl9kdW1wKDIpOyB9KTsgZGVmZXIoZnVuY3Rpb24gKCk6IHZvaWQgeyBkZWxheSgyMDAwKTsgdmFyX2R1bXAoMyk7IH0pOyAvLyBTdXNwZW5kIHRoZSBtYWluIGNvbnRleHQgd2l0aCBkZWxheSgpLiBkZWxheSg1MDApOyB2YXJfZHVtcCg0KTs8L3ByZT4gPHA+IFRoZSBuZXh0IGV4YW1wbGUgYWdhaW4gdXNlcyBhbXBocCB2MyB0byBkZW1vbnN0cmF0ZSBob3cgdGhlIGV2ZW50IGxvb3AgZmliZXIgY29udGludWVzIGV4ZWN1dGluZyB3aGlsZSB0aGUgbWFpbiB0aHJlYWQgaXMg4oCcc3VzcGVuZGVk4oCdLiBUaGUgPGNvZGU+YXdhaXQoUHJvbWlzZSAkcHJvbWlzZSk8L2NvZGU+IGZ1bmN0aW9uIHN1c3BlbmRzIGEgZmliZXIgdW50aWwgdGhlIGdpdmVuIHByb21pc2UgaXMgcmVzb2x2ZWQgYW5kIHRoZSA8Y29kZT5hc3luYyhjYWxsYWJsZSAkY2FsbGJhY2ssIG1peGVkIC4uLiRhcmdzKTwvY29kZT4gZnVuY3Rpb24gY3JlYXRlcyBhIG5ldyBmaWJlciwgcmV0dXJuaW5nIGEgcHJvbWlzZSB0aGF0IGlzIHJlc29sdmVkIHdoZW4gdGhlIGZpYmVyIGNvbXBsZXRlcywgYWxsb3dpbmcgbXVsdGlwbGUgZmliZXJzIHRvIGJlIGV4ZWN1dGVkIGNvbmN1cnJlbnRseS4gPC9wPiA8cHJlID51c2UgZnVuY3Rpb24gQW1wXGFzeW5jOyB1c2UgZnVuY3Rpb24gQW1wXGF3YWl0OyB1c2UgZnVuY3Rpb24gQW1wXGRlZmVyOyB1c2UgZnVuY3Rpb24gQW1wXGRlbGF5OyAvLyBOb3RlIHRoYXQgdGhlIGZ1bmN0aW9uIGRlY2xhcmVzIGludCBhcyBhIHJldHVybiB0eXBlLCBub3QgUHJvbWlzZSBvciBHZW5lcmF0b3IsIC8vIGJ1dCBleGVjdXRlcyBhcyBhIGNvcm91dGluZS4gZnVuY3Rpb24gYXN5bmNUYXNrKGludCAkaWQpOiBpbnQgeyAvLyBOb3RoaW5nIHVzZWZ1bCBpcyBkb25lIGhlcmUsIGJ1dCByYXRoZXIgYWN0cyBhcyBhIHN1YnN0aXR1dGUgZm9yIGFzeW5jIEkvTy4gZGVsYXkoMTAwMCk7IC8vIFN1c3BlbmRzIHRoZSBmaWJlciB0aGlzIGZ1bmN0aW9uIGV4ZWN1dGVzIHdpdGhpbiBmb3IgMSBzZWNvbmQuIHJldHVybiAkaWQ7IH0gJHJ1bm5pbmcgPSB0cnVlOyBkZWZlcihmdW5jdGlvbiAoKSB1c2UgKCRydW5uaW5nKTogdm9pZCB7IC8vIFRoaXMgbG9vcCBpcyB0byBzaG93IGhvdyB0aGlzIGZpYmVyIGlzIG5vdCBibG9ja2VkIGJ5IG90aGVyIGZpYmVycy4gd2hpbGUgKCRydW5uaW5nKSB7IGRlbGF5KDEwMCk7IGVjaG8gIi4iOyB9IH0pOyAvLyBJbnZva2luZyBhc3luY1Rhc2soKSByZXR1cm5zIGFuIGludCBhZnRlciAxIHNlY29uZCwgYnV0IGlzIGV4ZWN1dGVkIGNvbmN1cnJlbnRseS4gJHJlc3VsdCA9IGFzeW5jVGFzaygxKTsgLy8gQ2FsbCBhIHN1YnJvdXRpbmUgd2l0aGluIHRoaXMgZmliZXIsIHRha2luZyAxIHNlY29uZCB0byByZXR1cm4uIHZhcl9kdW1wKCRyZXN1bHQpOyAvLyBTaW11bHRhbmVvdXNseSBydW5zIHR3byBuZXcgZmliZXJzLCBhd2FpdCB0aGVpciByZXNvbHV0aW9uIGluIHRoZSBtYWluIGZpYmVyLiAvLyBhd2FpdCgpIHN1c3BlbmRzIHRoZSBmaWJlciB1bnRpbCB0aGUgZ2l2ZW4gcHJvbWlzZSAob3IgYXJyYXkgb2YgcHJvbWlzZXMgaGVyZSkgYXJlIHJlc29sdmVkLiAkcmVzdWx0ID0gYXdhaXQoWyAvLyBFeGVjdXRlZCBzaW11bHRhbmVvdXNseSwgb25seSAxIHNlY29uZCB3aWxsIGVsYXBzZSBkdXJpbmcgdGhpcyBhd2FpdC4gYXN5bmMoZm4oKSA9Jmd0OyBhc3luY1Rhc2soMikpLCAvLyBhc3luYygpIGNyZWF0ZXMgYSBuZXcgZmliZXIgYW5kIHJldHVybnMgYSBwcm9taXNlIGZvciB0aGUgcmVzdWx0LiBhc3luYyhmbigpID0mZ3Q7IGFzeW5jVGFzaygzKSksIF0pOyB2YXJfZHVtcCgkcmVzdWx0KTsgLy8gRXhlY3V0ZWQgYWZ0ZXIgMiBzZWNvbmRzLiAkcmVzdWx0ID0gYXN5bmNUYXNrKDQpOyAvLyBDYWxsIHRha2VzIDEgc2Vjb25kIHRvIHJldHVybi4gdmFyX2R1bXAoJHJlc3VsdCk7IC8vIGFycmF5X21hcCgpIHRha2VzIDIgc2Vjb25kcyB0byBleGVjdXRlIGFzIHRoZSB0d28gY2FsbHMgYXJlIG5vdCBjb25jdXJyZW50LCBidXQgdGhpcyBzaG93cyAvLyB0aGF0IGZpYmVycyBhcmUgc3VwcG9ydGVkIGJ5IGludGVybmFsIGNhbGxiYWNrcy4gJHJlc3VsdCA9IGFycmF5X21hcChmbihpbnQgJHZhbHVlKSA9Jmd0OyBhc3luY1Rhc2soJHZhbHVlKSwgWzUsIDZdKTsgdmFyX2R1bXAoJHJlc3VsdCk7ICRydW5uaW5nID0gZmFsc2U7IC8vIFN0b3AgdGhlIGxvb3AgaW4gdGhlIGZpYmVyIGNyZWF0ZWQgd2l0aCBkZWZlcigpIGFib3ZlLjwvcHJlPiA8cD4gU2luY2UgZmliZXJzIGNhbiBiZSBwYXVzZWQgZHVyaW5nIGNhbGxzIHdpdGhpbiB0aGUgUEhQIFZNLCBmaWJlcnMgY2FuIGFsc28gYmUgdXNlZCB0byBjcmVhdGUgYXN5bmNocm9ub3VzIGl0ZXJhdG9ycyBhbmQgZ2VuZXJhdG9ycy4gVGhlIGV4YW1wbGUgYmVsb3cgdXNlcyBhbXBocCB2MyB0byBzdXNwZW5kIGEgZmliZXIgd2l0aGluIGEgZ2VuZXJhdG9yLCBhd2FpdGluZyByZXNvbHV0aW9uIG9mIGEgPGNvZGU+RGVsYXllZDwvY29kZT4sIGEgcHJvbWlzZS1saWtlIG9iamVjdCB0aGF0IHJlc29sdmVzIGl0c2VsZiB3aXRoIHRoZSBzZWNvbmQgYXJndW1lbnQgYWZ0ZXIgdGhlIG51bWJlciBvZiBtaWxsaXNlY29uZHMgZ2l2ZW4gYXMgdGhlIGZpcnN0IGFyZ3VtZW50LiBXaGVuIGl0ZXJhdGluZyBvdmVyIHRoZSBnZW5lcmF0b3IsIHRoZSA8Y29kZT5mb3JlYWNoPC9jb2RlPiBsb29wIHdpbGwgc3VzcGVuZCB3aGlsZSB3YWl0aW5nIGZvciBhbm90aGVyIHZhbHVlIHRvIGJlIHlpZWxkZWQgZnJvbSB0aGUgZ2VuZXJhdG9yLiA8L3A+IDxwcmUgPnVzZSBBbXBcRGVsYXllZDsgdXNlIGZ1bmN0aW9uIEFtcFxhd2FpdDsgZnVuY3Rpb24gZ2VuZXJhdG9yKCk6IEdlbmVyYXRvciB7IHlpZWxkIGF3YWl0KG5ldyBEZWxheWVkKDUwMCwgMSkpOyB5aWVsZCBhd2FpdChuZXcgRGVsYXllZCgxNTAwLCAyKSk7IHlpZWxkIGF3YWl0KG5ldyBEZWxheWVkKDEwMDAsIDMpKTsgeWllbGQgYXdhaXQobmV3IERlbGF5ZWQoMjAwMCwgNCkpOyB5aWVsZCA1OyB5aWVsZCA2OyB5aWVsZCA3OyB5aWVsZCBhd2FpdChuZXcgRGVsYXllZCgyMDAwLCA4KSk7IHlpZWxkIDk7IHlpZWxkIGF3YWl0KG5ldyBEZWxheWVkKDEwMDAsIDEwKSk7IH0gLy8gSXRlcmF0ZSBvdmVyIHRoZSBnZW5lcmF0b3IgYXMgbm9ybWFsLCBidXQgdGhlIGxvb3Agd2lsbCAvLyBiZSBzdXNwZW5kZWQgYW5kIHJlc3VtZWQgYXMgbmVlZGVkLiBmb3JlYWNoIChnZW5lcmF0b3IoKSBhcyAkdmFsdWUpIHsgcHJpbnRmKCJHZW5lcmF0b3IgeWllbGRlZCAlZCIsICR2YWx1ZSk7IH0gLy8gQXJndW1lbnQgdW5wYWNraW5nIGFsc28gY2FuIHVzZSBhIHN1c3BlbmRpbmcgZ2VuZXJhdG9yLiB2YXJfZHVtcCguLi5nZW5lcmF0b3IoKSk7PC9wcmU+IDxwPiBUaGUgZXhhbXBsZSBiZWxvdyBzaG93cyBob3cgUmVhY3RQSFAgbWlnaHQgdXNlIGZpYmVycyB0byBkZWZpbmUgYW4gPGNvZGU+YXdhaXQoKTwvY29kZT4gZnVuY3Rpb24gdGhhdCBjb3VsZCBiZSB1c2VkIHRvIGF3YWl0IHByb21pc2UgcmVzb2x1dGlvbiB3aXRoaW4gYSBmaWJlciB1c2luZyB0aGVpciA8Y29kZT5Qcm9taXNlSW50ZXJmYWNlPC9jb2RlPiBhbmQgPGNvZGU+TG9vcEludGVyZmFjZTwvY29kZT4uIDwvcD4gPHByZSA+dXNlIFJlYWN0XEV2ZW50TG9vcFxMb29wSW50ZXJmYWNlOyB1c2UgUmVhY3RcUHJvbWlzZVxQcm9taXNlSW50ZXJmYWNlOyBmdW5jdGlvbiBhd2FpdChQcm9taXNlSW50ZXJmYWNlICRwcm9taXNlLCBMb29wSW50ZXJmYWNlICRsb29wKTogbWl4ZWQgeyAkZmliZXIgPSBGaWJlcjo6dGhpcygpOyBpZiAoJGZpYmVyID09PSBudWxsKSB7IHRocm93IG5ldyBFcnJvcignUHJvbWlzZXMgY2FuIG9ubHkgYmUgYXdhaXRlZCB3aXRoaW4gYSBmaWJlcicpOyB9ICRwcm9taXNlLSZndDtkb25lKCBmbihtaXhlZCAkdmFsdWUpID0mZ3Q7ICRsb29wLSZndDtmdXR1cmVUaWNrKGZuKCkgPSZndDsgJGZpYmVyLSZndDtyZXN1bWUoJHZhbHVlKSksIGZuKFRocm93YWJsZSAkcmVhc29uKSA9Jmd0OyAkbG9vcC0mZ3Q7ZnV0dXJlVGljayhmbigpID0mZ3Q7ICRmaWJlci0mZ3Q7dGhyb3coJHJlYXNvbikpICk7IHJldHVybiBGaWJlcjo6c3VzcGVuZCgpOyB9PC9wcmU+IDxwPiBBIGRlbW9uc3RyYXRpb24gb2YgaW50ZWdyYXRpbmcgUmVhY3RQSFAgd2l0aCBmaWJlcnMgaGFzIGJlZW4gaW1wbGVtZW50ZWQgaW4gdHJvd3NraS9yZWFjdC1maWJlciBmb3IgdGhlIGN1cnJlbnQgc3RhYmxlIHZlcnNpb25zIG9mIDxjb2RlPnJlYWN0L2V2ZW50LWxvb3A8L2NvZGU+IGFuZCA8Y29kZT5yZWFjdC9wcm9taXNlPC9jb2RlPi4gPC9wPiA8L2Rpdj4gPGgyID5GQVE8L2gyPiA8aDQgPldobyBpcyB0aGUgdGFyZ2V0IGF1ZGllbmNlIGZvciB0aGlzIGZlYXR1cmU/PC9oND4gPGRpdiA+IDxwPiBGaWJlcnMgYXJlIGFuIGFkdmFuY2VkIGZlYXR1cmUgdGhhdCBtb3N0IHVzZXJzIHdpbGwgbm90IHVzZSBkaXJlY3RseS4gVGhpcyBmZWF0dXJlIGlzIHByaW1hcmlseSB0YXJnZXRlZCBhdCBsaWJyYXJ5IGFuZCBmcmFtZXdvcmsgYXV0aG9ycyB0byBwcm92aWRlIGFuIGV2ZW50IGxvb3AgYW5kIGFuIGFzeW5jaHJvbm91cyBwcm9ncmFtbWluZyA8YWJiciA+QVBJPC9hYmJyPi4gRmliZXJzIGFsbG93IGludGVncmF0aW5nIGFzeW5jaHJvbm91cyBjb2RlIGV4ZWN1dGlvbiBzZWFtbGVzc2x5IGludG8gc3luY2hyb25vdXMgY29kZSBhdCBhbnkgcG9pbnQgd2l0aG91dCB0aGUgbmVlZCB0byBtb2RpZnkgdGhlIGFwcGxpY2F0aW9uIGNhbGwgc3RhY2sgb3IgYWRkIGJvaWxlcnBsYXRlIGNvZGUuIDwvcD4gPHA+IFRoZSBGaWJlciA8YWJiciA+QVBJPC9hYmJyPiBpcyBub3QgZXhwZWN0ZWQgdG8gYmUgdXNlZCBkaXJlY3RseSBpbiBhcHBsaWNhdGlvbi1sZXZlbCBjb2RlLiBGaWJlcnMgcHJvdmlkZSBhIGJhc2ljLCBsb3ctbGV2ZWwgZmxvdy1jb250cm9sIDxhYmJyID5BUEk8L2FiYnI+IHRvIGNyZWF0ZSBoaWdoZXItbGV2ZWwgYWJzdHJhY3Rpb25zIHRoYXQgYXJlIHRoZW4gdXNlZCBpbiBhcHBsaWNhdGlvbiBjb2RlLiA8L3A+IDxwPiA8Y29kZT5GRkk8L2NvZGU+IGlzIGFuIGV4YW1wbGUgb2YgYSBmZWF0dXJlIHJlY2VudGx5IGFkZGVkIHRvIFBIUCB0aGF0IG1vc3QgdXNlcnMgbWF5IG5vdCB1c2UgZGlyZWN0bHksIGJ1dCBjYW4gYmVuZWZpdCBmcm9tIGdyZWF0bHkgd2l0aGluIGxpYnJhcmllcyB0aGV5IHVzZS4gPC9wPiA8L2Rpdj4gPGg0ID5XaGF0IGFib3V0IHBlcmZvcm1hbmNlPzwvaDQ+IDxkaXYgPiA8cD4gU3dpdGNoaW5nIGJldHdlZW4gZmliZXJzIGlzIGxpZ2h0d2VpZ2h0LCByZXF1aXJpbmcgY2hhbmdpbmcgdGhlIHZhbHVlIG9mIGFwcHJveGltYXRlbHkgMjAgcG9pbnRlcnMsIGdpdmUgb3IgdGFrZSwgZGVwZW5kaW5nIG9uIHBsYXRmb3JtLiBTd2l0Y2hpbmcgZXhlY3V0aW9uIGNvbnRleHQgaW4gdGhlIFBIUCBWTSBpcyBzaW1pbGFyIHRvIEdlbmVyYXRvcnMsIGFnYWluIG9ubHkgcmVxdWlyaW5nIHRoZSBzd2FwcGluZyBvZiBhIGZldyBwb2ludGVycy4gU2luY2UgZmliZXJzIGV4aXN0IHdpdGhpbiBhIHNpbmdsZSBwcm9jZXNzIHRocmVhZCwgc3dpdGNoaW5nIGJldHdlZW4gZmliZXJzIGlzIHNpZ25pZmljYW50bHkgbW9yZSBwZXJmb3JtYW50IHRoYW4gc3dpdGNoaW5nIGJldHdlZW4gcHJvY2Vzc2VzIG9yIHRocmVhZHMuIDwvcD4gPC9kaXY+IDxoNCA+V2hhdCBwbGF0Zm9ybXMgYXJlIHN1cHBvcnRlZD88L2g0PiA8ZGl2ID4gPHA+IEZpYmVycyBhcmUgc3VwcG9ydGVkIG9uIG5lYXJseSBhbGwgbW9kZXJuIENQVSBhcmNoaXRlY3R1cmVzLCBpbmNsdWRpbmcgeDg2LCB4ODZfNjQsIDMyLSBhbmQgNjQtYml0IEFSTSwgMzItIGFuZCA2NC1iaXQgUFBDLCBNSVBTLCBXaW5kb3dzIChhcmNoaXRlY3R1cmUgaW5kZXBlbmRlbnQsIFdpbmRvd3MgcHJvdmlkZXMgYSBmaWJlciA8YWJiciA+QVBJPC9hYmJyPiksIGFuZCBvbGRlciBQb3NpeCBwbGF0Zm9ybXMgd2l0aCB1Y29udGV4dC4gU3VwcG9ydCBmb3IgQyBzdGFjayBzd2l0Y2hpbmcgdXNpbmcgYXNzZW1ibHkgY29kZSBpcyBwcm92aWRlZCBieSA8YSA+Qm9vc3Q8L2E+LCB3aGljaCBoYXMgYW4gPGEgPk9TSS1hcHByb3ZlZDwvYT4gPGEgPmxpY2Vuc2U8L2E+IHRoYXQgYWxsb3dzIGNvbXBvbmVudHMgdG8gYmUgZGlzdHJpYnV0ZWQgZGlyZWN0bHkgd2l0aCBQSFAuIDwvcD4gPHA+IDxjb2RlPmV4dC1maWJlcjwvY29kZT4gaXMgYWN0aXZlbHkgdGVzdGVkIG9uIDxhID5UcmF2aXM8L2E+IGZvciBMaW51eCBydW5uaW5nIG9uIHg4Nl82NCBhbmQgNjQtYml0IEFSTSwgb24gPGEgPkFwcFZleW9yPC9hPiBmb3IgV2luZG93cywgYW5kIGJ5IHRoZSBkZXZlbG9wZXJzIG9uIG1hY09TIHJ1bm5pbmcgb24geDg2XzY0LiA8L3A+IDwvZGl2PiA8aDQgPkhvdyBhcmUgZXhlY3V0aW9uIHN0YWNrcyBzd2FwcGVkPzwvaDQ+IDxkaXYgPiA8cD4gRWFjaCBmaWJlciBob2xkcyBhIHBvaW50ZXIgdG8gYSBDIHN0YWNrIGFuZCBhIFZNIHN0YWNrICg8Y29kZT56ZW5kX2V4ZWN1dGVfZGF0YTwvY29kZT4pLiBXaGVuIGVudGVyaW5nIGEgZmliZXIsIHRoZSBjdXJyZW50IEMgc3RhY2sgaXMgc3dhcHBlZCBhbmQgdGhlIDxjb2RlPkVYKGN1cnJlbnRfZXhlY3V0ZV9kYXRhKTwvY29kZT4gcG9pbnRlciBhcmUgc3dhcHBlZCBmb3IgdGhvc2UgaGVsZCBieSB0aGUgZmliZXIuIFRoZSBwcmV2aW91cyBWTSBzdGFjayBpcyBiYWNrZWQgdXAgaW4gbWVtb3J5IHdoZXJlIGV4ZWN1dGlvbiB3aWxsIHJlc3VtZSB3aGVuIHRoZSBlbnRlcmVkIGZpYmVyIGlzIHN1c3BlbmRlZCBvciBjb21wbGV0ZXMuIFRoZSBwcmV2aW91cyBWTSBzdGFjayBpcyByZXN0b3JlZCBpbiA8Y29kZT5FWChjdXJyZW50X2V4ZWN1dGVfZGF0YSk8L2NvZGU+IHdoZW4gdGhlIHByaW9yIGZpYmVyIGlzIGVudGVyZWQgYWdhaW4sIGVpdGhlciBieSB0aGUgb3RoZXIgZmliZXIgc3VzcGVuZGluZyBvciBjb21wbGV0aW5nLiA8L3A+IDxwPiBGdW5jdGlvbnMgc3VjaCBhcyA8Y29kZT5kZWJ1Z19iYWNrdHJhY2UoKTwvY29kZT4gYW5kIGV4Y2VwdGlvbiBiYWNrdHJhY2VzIG9ubHkgaW5jbHVkZSB0aGUgdHJhY2Ugb2YgdGhlIGN1cnJlbnQgZmliZXIuIFByZXZpb3VzIGZpYmVyIGJhY2t0cmFjZXMgYXJlIG5vdCBpbmNsdWRlZCBjdXJyZW50bHksIHRob3VnaCB0aGlzIG1heSBiZSBwb3NzaWJsZSB3aXRoIHNvbWUgbW9kaWZpY2F0aW9uIHRvIHRoZSBpbnRlcm5hbCBmdW5jdGlvbnMgdGhhdCBnZW5lcmF0ZSB0aGVzZSB0cmFjZXMgdG8gYWxzbyBpbmNsdWRlIHRoZSBiYWNrdHJhY2Ugb2YgdGhlIGZpYmVycyB0aGF0IGVudGVyZWQgdGhlIGN1cnJlbnQgZmliZXIuIDwvcD4gPC9kaXY+IDxoNCA+SG93IGRvZXMgYmxvY2tpbmcgY29kZSBhZmZlY3QgZmliZXJzPC9oND4gPGRpdiA+IDxwPiBCbG9ja2luZyBjb2RlIChzdWNoIGFzIDxjb2RlPmZpbGVfZ2V0X2NvbnRlbnRzKCk8L2NvZGU+KSB3aWxsIGNvbnRpbnVlIHRvIGJsb2NrIHRoZSBlbnRpcmUgcHJvY2VzcywgZXZlbiBpZiBvdGhlciBmaWJlcnMgZXhpc3QuIENvZGUgbXVzdCBiZSB3cml0dGVuIHRvIHVzZSBhc3luY2hvbm91cyBJL08sIGFuIGV2ZW50IGxvb3AsIGFuZCBmaWJlcnMgdG8gc2VlIGEgcGVyZm9ybWFuY2UgYW5kIGNvbmN1cnJlbmN5IGJlbmVmaXQuIEFzIG1lbnRpb25lZCBpbiB0aGUgaW50cm9kdWN0aW9uLCBzZXZlcmFsIGxpYnJhcmllcyBhbHJlYWR5IGV4aXN0IGZvciBhc3luY2hyb25vdXMgSS9PIGFuZCBjYW4gdGFrZSBhZHZhbnRhZ2Ugb2YgZmliZXJzIHRvIGludGVncmF0ZSB3aXRoIHN5bmNocm9ub3VzIGNvZGUgd2hpbGUgZXhwYW5kaW5nIHRoZSBwb3RlbnRpYWwgZm9yIGNvbmN1cnJlbmN5IGluIGFuIGFwcGxpY2F0aW9uLiA8L3A+IDxwPiBBcyBmaWJlcnMgYWxsb3cgdHJhbnNwYXJlbnQgdXNlIG9mIGFzeW5jaHJvbm91cyBJL08sIGJsb2NraW5nIGltcGxlbWVudGF0aW9ucyBjYW4gYmUgcmVwbGFjZWQgYnkgbm9uLWJsb2NraW5nIGltcGxlbWVudGF0aW9ucyB3aXRob3V0IGFmZmVjdGluZyB0aGUgZW50aXJlIGNhbGwgc3RhY2suIElmIGFuIGludGVybmFsIGV2ZW50IGxvb3AgaXMgYXZhaWxhYmxlIGluIHRoZSBmdXR1cmUsIGludGVybmFsIGZ1bmN0aW9ucyBzdWNoIGFzIDxjb2RlPnNsZWVwKCk8L2NvZGU+IGNvdWxkIGJlIG1hZGUgbm9uLWJsb2NraW5nIGJ5IGRlZmF1bHQuIDwvcD4gPC9kaXY+IDxoNCA+SG93IGRvIHZhcmlvdXMgZmliZXJzIGFjY2VzcyB0aGUgc2FtZSBtZW1vcnk/PC9oND4gPGRpdiA+IDxwPiBBbGwgZmliZXJzIGV4aXN0IHdpdGhpbiBhIHNpbmdsZSB0aHJlYWQuIE9ubHkgYSBzaW5nbGUgZmliZXIgbWF5IGV4ZWN1dGUgYXQgYSB0aW1lLCBzbyBtZW1vcnkgY2Fubm90IGJlIGFjY2Vzc2VkIG9yIG1vZGlmaWVkIHNpbXVsdGFuZW91c2x5IGJ5IG11bHRpcGxlIGZpYmVycywgdW5saWtlIHRocmVhZHMgd2hpY2ggbWF5IG1vZGlmeSBtZW1vcnkgc2ltdWx0YW5lb3VzbHkuIDwvcD4gPHA+IEFzIGZpYmVycyBhcmUgc3VzcGVuZGVkIGFuZCByZXN1bWVkLCBleGVjdXRpb24gb2YgbXVsdGlwbGUgZmliZXJzIHRoYXQgYWNjZXNzIHRoZSBzYW1lIG1lbW9yeSBjYW4gYmUgaW50ZXJsZWF2ZWQuIFRodXMgYSBydW5uaW5nIGZpYmVyIG1heSBtb2RpZnkgbWVtb3J5IGRlcGVuZGVkIHVwb24gYnkgYW5vdGhlciBzdXNwZW5kZWQgZmliZXIuIFRoZXJlIGFyZSB2YXJpb3VzIHN0cmF0ZWdpZXMgdG8gYWRkcmVzcyB0aGlzIHByb2JsZW0sIGluY2x1ZGluZyBtdXRleGVzLCBzZW1hcGhvcmVzLCBtZW1vcnkgcGFyY2VscywgYW5kIGNoYW5uZWxzLiBUaGlzIDxhYmJyID5SRkM8L2FiYnI+IGRvZXMgbm90IHByb3ZpZGUgYW55IHN1Y2ggaW1wbGVtZW50YXRpb25zIGFzIHRoZXNlIGNhbiBiZSBpbXBsZW1lbnRlZCBpbiB1c2VyIHNwYWNlIGNvZGUgdXNpbmcgdGhlIHByb3Bvc2VkIGZpYmVyIDxhYmJyID5BUEk8L2FiYnI+LiA8L3A+IDwvZGl2PiA8aDQgPldoeSBhZGQgdGhpcyB0byBQSFAgY29yZT88L2g0PiA8ZGl2ID4gPHA+IEFkZGluZyB0aGlzIGNhcGFiaWxpdHkgZGlyZWN0bHkgaW4gUEhQIGNvcmUgbWFrZXMgaXQgd2lkZWx5IGF2YWlsYWJsZSBvbiBhbnkgaG9zdCBwcm92aWRpbmcgUEhQLiBPZnRlbiB1c2VycyBhcmUgbm90IGFibGUgdG8gZGV0ZXJtaW5lIHdoYXQgZXh0ZW5zaW9ucyBtYXkgYmUgYXZhaWxhYmxlIGluIGEgcGFydGljdWxhciBob3N0aW5nIGVudmlyb25tZW50LCBhcmUgdW5zdXJlIG9mIGhvdyB0byBpbnN0YWxsIGV4dGVuc2lvbnMsIG9yIGRvIG5vdCB3YW50IHRvIGluc3RhbGwgM3JkLXBhcnR5IGV4dGVuc2lvbnMuIFdpdGggZmliZXJzIGluIFBIUCBjb3JlLCBhbnkgbGlicmFyeSBhdXRob3IgbWF5IHVzZSB0aGUgZmVhdHVyZSB3aXRob3V0IGNvbmNlcm5zIGZvciBwb3J0YWJpbGl0eS4gPC9wPiA8cD4gRXh0ZW5zaW9ucyB0aGF0IHByb2ZpbGUgY29kZSBuZWVkIHRvIGFjY291bnQgZm9yIHN3aXRjaGluZyBmaWJlcnMgd2hlbiBjcmVhdGluZyBiYWNrdHJhY2VzIGFuZCBjYWxjdWxhdGluZyBleGVjdXRpb24gdGltZXMuIFRoaXMgbmVlZHMgdG8gYmUgcHJvdmlkZWQgYXMgYSBjb3JlIGludGVybmFsIDxhYmJyID5BUEk8L2FiYnI+IHNvIGFueSBwcm9maWxlciBjb3VsZCBzdXBwb3J0IGZpYmVycy4gVGhlIGludGVybmFsIDxhYmJyID5BUEk8L2FiYnI+IHRoYXQgd291bGQgYmUgcHJvdmlkZWQgaXMgb3V0IG9mIHNjb3BlIG9mIHRoaXMgPGFiYnIgPlJGQzwvYWJicj4gYXMgaXQgd291bGQgbm90IGFmZmVjdCB1c2VyIGNvZGUuIDwvcD4gPC9kaXY+IDxoNCA+V2h5IG5vdCBhZGQgYW4gZXZlbnQgbG9vcCBhbmQgYXN5bmMvYXdhaXQgQVBJIHRvIGNvcmU/PC9oND4gPGRpdiA+IDxwPiBUaGlzIDxhYmJyID5SRkM8L2FiYnI+IHByb3Bvc2VzIG9ubHkgdGhlIGJhcmUgbWluaW11bSByZXF1aXJlZCB0byBhbGxvdyB1c2VyIGNvZGUgdG8gaW1wbGVtZW50IGZ1bGwtc3RhY2sgY29yb3V0aW5lcyBvciBncmVlbi10aHJlYWRzIGluIFBIUC4gVGhlcmUgYXJlIHNldmVyYWwgZnJhbWV3b3JrcyB0aGF0IGltcGxlbWVudCB0aGVpciBvd24gZXZlbnQgbG9vcCA8YWJiciA+QVBJPC9hYmJyPiwgcHJvbWlzZXMsIGFuZCBvdGhlciBhc3luY2hyb25vdXMgQVBJcy4gVGhlc2UgQVBJcyB2YXJ5IGdyZWF0bHkgYW5kIGFyZSBvcGluaW9uYXRlZCwgZGVzaWduZWQgZm9yIGEgcGFydGljdWxhciBwdXJwb3NlLCBhbmQgdGhlaXIgcGFydGljdWxhciBuZWVkcyBtYXkgbm90IGJlIGFibGUgdG8gYmUgY292ZXJlZCBieSBhIGNvcmUgPGFiYnIgPkFQSTwvYWJicj4gdGhhdCBpcyBkZXNpZ25lZCBieSBvbmx5IGEgZmV3IGluZGl2aWR1YWxzLiA8L3A+IDxwPiBJdCBpcyB0aGUgb3BpbmlvbiBvZiB0aGUgYXV0aG9ycyBvZiB0aGlzIDxhYmJyID5SRkM8L2FiYnI+IHRoYXQgaXQgaXMgYmVzdCB0byBwcm92aWRlIHRoZSBiYXJlIG1pbmltdW0gaW4gY29yZSBhbmQgYWxsb3cgdXNlciBjb2RlIHRvIGltcGxlbWVudCBvdGhlciBjb21wb25lbnRzIGFzIHRoZXkgZGVzaXJlLiBJZiB0aGUgY29tbXVuaXR5IG1vdmVzIHRvd2FyZCBhIHNpbmdsZSBldmVudCBsb29wIDxhYmJyID5BUEk8L2FiYnI+IG9yIGEgbmVlZCBlbWVyZ2VzIGZvciBhbiBldmVudCBsb29wIGluIFBIUCBjb3JlLCB0aGlzIGNhbiBiZSBkb25lIGluIGEgZnV0dXJlIDxhYmJyID5SRkM8L2FiYnI+LiBQcm92aWRpbmcgYSBjb3JlIGV2ZW50IGxvb3Agd2l0aG91dCBjb3JlIGZ1bmN0aW9uYWxpdHkgdXNpbmcgaXQgKHN1Y2ggYXMgc3RyZWFtcywgZmlsZSBhY2Nlc3MsIGV0Yy4pIHdvdWxkIGJlIG1pc2xlYWRpbmcgYW5kIGNvbmZ1c2luZyBmb3IgdXNlcnMuIERlZmVycmluZyBzdWNoIGZ1bmN0aW9uYWxpdHkgdG8gdXNlciBmcmFtZXdvcmtzIGFuZCBwcm92aWRpbmcgb25seSBhIG1pbmltdW0gPGFiYnIgPkFQSTwvYWJicj4gaW4gY29yZSBrZWVwcyBleHBlY3RhdGlvbnMgaW4gY2hlY2suIDwvcD4gPHA+IFRoaXMgPGFiYnIgPlJGQzwvYWJicj4gZG9lcyBub3QgcHJlY2x1ZGUgYWRkaW5nIGFzeW5jL2F3YWl0IGFuZCBhbiBldmVudCBsb29wIHRvIGNvcmUuIDwvcD4gPC9kaXY+IDxoNCA+SG93IGRvZXMgdGhpcyBwcm9wb3NhbCBkaWZmZXIgZnJvbSBwcmlvciBGaWJlciBwcm9wb3NhbHM/PC9oND4gPGRpdiA+IDxwPiBUaGUgcHJpb3IgPGEgPkZpYmVyIFJGQzwvYT4gZGlkIG5vdCBzdXBwb3J0IGNvbnRleHQgc3dpdGNoaW5nIHdpdGhpbiBpbnRlcm5hbCBjYWxscyAoPGNvZGU+YXJyYXlfbWFwPC9jb2RlPiwgPGNvZGU+cHJlZ19yZXBsYWNlX2NhbGxiYWNrPC9jb2RlPiwgZXRjLikgb3Igb3Bjb2RlIGhhbmRsZXJzICg8Y29kZT5mb3JlYWNoPC9jb2RlPiwgPGNvZGU+eWllbGQgZnJvbTwvY29kZT4sIGV0Yy4pLiBUaGlzIGNvdWxkIHJlc3VsdCBpbiBhIGNyYXNoIGlmIGEgZnVuY3Rpb24gdXNpbmcgZmliZXJzIHdhcyB1c2VkIGluIGFueSB1c2VyIGNvZGUgY2FsbGVkIGZyb20gQyBjb2RlIG9yIGluIGV4dGVuc2lvbnMgdGhhdCBvdmVycmlkZSA8Y29kZT56ZW5kX2V4ZWN1dGVfZXg8L2NvZGU+IHN1Y2ggYXMgWGRlYnVnLiA8L3A+IDwvZGl2PiA8aDQgPkFyZSBmaWJlcnMgY29tcGF0aWJsZSB3aXRoIGV4dGVuc2lvbnMsIGluY2x1ZGluZyBYZGVidWc/PC9oND4gPGRpdiA+IDxwPiBGaWJlcnMgZG8gbm90IGNoYW5nZSBob3cgdGhlIFBIUCBWTSBleGVjdXRlcyBQSFAgY29kZSBhbmQgc3VzcGVuZGluZyBpcyBzdXBwb3J0ZWQgd2l0aGluIHRoZSBDIHN0YWNrLCBzbyBmaWJlcnMgYXJlIGNvbXBhdGlibGUgd2l0aCBQSFAgZXh0ZW5zaW9ucyB0aGF0IHNpbXBseSBwcm92aWRlIGEgYnJpZGdlIHRvIGEgQyA8YWJiciA+QVBJPC9hYmJyPiwgaW5jbHVkaW5nIHRob3NlIHVzaW5nIGNhbGxiYWNrcyB0aGF0IG1heSBjYWxsIDxjb2RlPkZpYmVyOjpzdXNwZW5kKCk8L2NvZGU+LiA8L3A+IDxwPiBTb21lIGV4dGVuc2lvbnMgaG9vayBpbnRvIHRoZSBQSFAgVk0gYW5kIHRoZXJlZm9yZSBhcmUgb2YgcGFydGljdWxhciBpbnRlcmVzdCBmb3IgY29tcGF0aWJpbGl0eS4gPC9wPiA8dWw+IDxsaSA+PGRpdiA+IDxhID5YZGVidWc8L2E+IGlzIGNvbXBhdGlibGUgYXMgb2YgYSBidWdmaXggaW4gdmVyc2lvbiAzLjAuMS4gQnJlYWtwb2ludHMgbWF5IGJlIHNldCB3aXRoaW4gZmliZXJzIGFuZCBpbnNwZWN0ZWQgYXMgdXN1YWwgd2l0aGluIElERXMgYW5kIGRlYnVnZ2VycyBzdWNoIGFzIFBocFN0b3JtLiBDb2RlIGNvdmVyYWdlIHdvcmtzIGFzIGV4cGVjdGVkLjwvZGl2PiA8L2xpPiA8bGkgPjxkaXYgPiA8YSA+cGNvdjwvYT4gZ2VuZXJhdGVzIGNvZGUgY292ZXJhZ2UgYXMgZXhwZWN0ZWQsIGluY2x1ZGluZyBjb2RlIGV4ZWN1dGVkIHdpdGhpbiBzZXBhcmF0ZSBmaWJlcnMuPC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IDxhID5wYXJhbGxlbDwvYT4gaXMgYWJsZSB0byB1c2UgZmliZXJzIHdpdGhpbiB0aHJlYWRzLjwvZGl2PiA8L2xpPiA8L3VsPiA8cD4gQXMgbm90ZWQgaW4gPGEgPuKAnFdoeSBhZGQgdGhpcyB0byBQSFAgY29yZT/igJ08L2E+LCBleHRlbnNpb25zIHRoYXQgcHJvZmlsZSBjb2RlLCBjcmVhdGUgYmFja3RyYWNlcywgcHJvdmlkZSBleGVjdXRpb24gdGltZXMsIGV0Yy4gd2lsbCBuZWVkIHRvIGJlIHVwZGF0ZWQgdG8gYWNjb3VudCBmb3Igc3dpdGNoaW5nIGJldHdlZW4gZmliZXJzIHRvIHByb3ZpZGUgY29ycmVjdCBkYXRhLiA8L3A+IDwvZGl2PiA8aDIgPlZvdGU8L2gyPiA8ZGl2ID4gPHA+IFZvdGluZyBzdGFydGVkIG9uIDIwMjEtMDMtMDggYW5kIHdpbGwgcnVuIHRocm91Z2ggMjAyMS0wMy0yMi4gMi8zIHJlcXVpcmVkIHRvIGFjY2VwdC4gPC9wPiA8L2Rpdj4gPGgyID5SZWZlcmVuY2VzPC9oMj4gPGRpdiA+IDx1bD4gPGxpID48ZGl2ID4gPGEgPkJvb3N0IEMrKyBmaWJlcnM8L2E+PC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IDxhID5SdWJ5IEZpYmVyczwvYT48L2Rpdj4gPC9saT4gPGxpID48ZGl2ID4gPGEgPkx1YSBGaWJlcnM8L2E+PC9kaXY+IDwvbGk+IDxsaSA+PGRpdiA+IDxhID5Qcm9qZWN0IExvb20gZm9yIEphdmE8L2E+PC9kaXY+IDwvbGk+IDwvdWw+IDwvZGl2PiA8L2Rpdj4gPGRpdiA+PGJkaT5yZmMvZmliZXJzLnR4dDwvYmRpPiDCtyBMYXN0IG1vZGlmaWVkOiAyMDIxLzA3LzEyIDIxOjMwIGJ5IDxiZGk+a2VsdW5pazwvYmRpPjwvZGl2PiA8L2Rpdj48L2Rpdj4gPGRpdiA+IDxoMyA+UGFnZSBUb29sczwvaDM+IDxkaXYgPiA8dWw+IDxsaT48YSA+U2hvdyBwYWdlc291cmNlPC9hPjwvbGk+PGxpPjxhID5PbGQgcmV2aXNpb25zPC9hPjwvbGk+PGxpPjxhID5CYWNrbGlua3M8L2E+PC9saT48bGk+PGEgPkJhY2sgdG8gdG9wPC9hPjwvbGk+IDwvdWw+IDwvZGl2PiA8L2Rpdj4gPC9kaXY+IDwvZGl2PjwvZGl2PiA8L3NlY3Rpb24+IO+7vzxzZWN0aW9uID4gPGRpdiA+IDxoMyA+VGFibGUgb2YgQ29udGVudHM8L2gzPiA8ZGl2PiA8dWwgPiA8bGkgPjxkaXYgPjxhID5QSFAgUkZDOiBGaWJlcnM8L2E+PC9kaXY+IDx1bCA+IDxsaSA+PGRpdiA+PGEgPkludHJvZHVjdGlvbjwvYT48L2Rpdj4gPHVsID4gPGxpID48ZGl2ID48YSA+RmliZXJzPC9hPjwvZGl2PjwvbGk+IDwvdWw+IDwvbGk+IDxsaSA+PGRpdiA+PGEgPlByb3Bvc2FsPC9hPjwvZGl2PiA8dWwgPiA8bGkgPjxkaXYgPjxhID5GaWJlcjwvYT48L2Rpdj48L2xpPiA8bGkgPjxkaXYgPjxhID5SZWZsZWN0aW9uRmliZXI8L2E+PC9kaXY+PC9saT4gPC91bD4gPC9saT4gPGxpID48ZGl2ID48YSA+QmFja3dhcmQgSW5jb21wYXRpYmxlIENoYW5nZXM8L2E+PC9kaXY+PC9saT4gPGxpID48ZGl2ID48YSA+RnV0dXJlIFNjb3BlPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPlByb3Bvc2VkIFBIUCBWZXJzaW9uKHMpPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPlByb3Bvc2VkIFZvdGluZyBDaG9pY2VzPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPlBhdGNoZXMgYW5kIFRlc3RzPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPkV4YW1wbGVzPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPkZBUTwvYT48L2Rpdj48L2xpPiA8bGkgPjxkaXYgPjxhID5Wb3RlPC9hPjwvZGl2PjwvbGk+IDxsaSA+PGRpdiA+PGEgPlJlZmVyZW5jZXM8L2E+PC9kaXY+PC9saT4gPC91bD48L2xpPiA8L3VsPiA8L2Rpdj4gPC9kaXY+IDwvc2VjdGlvbj4gPC9zZWN0aW9uPiA8L2Rpdj4gPC9ib2R5Pg=='</script>

      </head>
        <body class="valid" valid="valid" title="valid: True, node: 1, level: 1" node_number="1"> <div class="valid" valid="valid" title="valid: True, node: 2, level: 2" node_number="2"> <header class="valid" valid="valid" title="valid: True, node: 3, level: 3" node_number="3">  </header> <section class="valid" valid="valid" title="valid: True, node: 4, level: 3" node_number="4"> <section class="valid" valid="valid" title="valid: True, node: 5, level: 4" node_number="5">  </section> <section class="valid" valid="valid" title="valid: True, node: 6, level: 4" node_number="6"> <div class="valid" valid="valid" title="valid: True, node: 7, level: 5" node_number="7"><div class="valid" valid="valid" title="valid: True, node: 8, level: 6" node_number="8"> <div class="valid" valid="valid" title="valid: True, node: 9, level: 7" node_number="9"> <div class="valid" valid="valid" title="valid: True, node: 10, level: 8" node_number="10"><div class="valid" valid="valid" title="valid: True, node: 11, level: 9" node_number="11"> <div class="valid" valid="valid" title="valid: True, node: 12, level: 10" node_number="12">rfc:fibers</div> <div class="valid" valid="valid" title="valid: True, node: 13, level: 10" node_number="13"> <h1 class="valid" valid="valid" title="valid: True, node: 14, level: 11" node_number="14">PHP RFC: Fibers</h1> <div class="valid" valid="valid" title="valid: True, node: 15, level: 11" node_number="15"> <ul class="valid" valid="valid" title="valid: True, node: 16, level: 12" node_number="16"> <li class="valid" valid="valid" title="valid: True, node: 17, level: 13" node_number="17"><div class="valid" valid="valid" title="valid: True, node: 18, level: 14" node_number="18"> Date: 2021-03-08</div> </li> <li class="valid" valid="valid" title="valid: True, node: 19, level: 13" node_number="19"><div class="valid" valid="valid" title="valid: True, node: 20, level: 14" node_number="20"> Authors: Aaron Piotrowski trowski@php.net, Niklas Keller kelunik@php.net</div> </li> <li class="valid" valid="valid" title="valid: True, node: 21, level: 13" node_number="21"><div class="valid" valid="valid" title="valid: True, node: 22, level: 14" node_number="22"> Status: Implemented</div> </li> <li class="valid" valid="valid" title="valid: True, node: 23, level: 13" node_number="23"><div class="valid" valid="valid" title="valid: True, node: 24, level: 14" node_number="24"> First Published at: http://wiki.php.net/rfc/fibers</div> </li> </ul> </div> <h2 class="valid" valid="valid" title="valid: True, node: 25, level: 11" node_number="25">Introduction</h2> <div class="valid" valid="valid" title="valid: True, node: 26, level: 11" node_number="26"> <p class="valid" valid="valid" title="valid: True, node: 27, level: 12" node_number="27"> For most of PHP&#8217;s history, people have written PHP code only as synchronous code. Execution of functions stops until a result is available to return from the function, including for I/O operations, which can be quite slow. </p> <p class="valid" valid="valid" title="valid: True, node: 28, level: 12" node_number="28"> More recently, there have been multiple projects that have allowed people to write asynchronous PHP code to allow for concurrent I/O operations. Asynchronous functions accept a callback or return a placeholder for a future value (such as a promise) to run code at a future time once the result is available. Execution continues without waiting for a result. Examples of these projects are amphp, ReactPHP, and Guzzle. </p> <p class="valid" valid="valid" title="valid: True, node: 29, level: 12" node_number="29"> The problem this <abbr class="valid" valid="valid" title="valid: True, node: 30, level: 13" node_number="30">RFC</abbr> seeks to address is a difficult one to explain, but can be referred to as the &#8220;What color is your function?&#8221; problem. </p> <p class="valid" valid="valid" title="valid: True, node: 31, level: 12" node_number="31"> A summary of the problem described in the linked article is: </p> <ul class="valid" valid="valid" title="valid: True, node: 32, level: 12" node_number="32"> <li class="valid" valid="valid" title="valid: True, node: 33, level: 13" node_number="33"><div class="valid" valid="valid" title="valid: True, node: 34, level: 14" node_number="34"> Asynchronous functions change the way the function must be called.</div> </li> <li class="valid" valid="valid" title="valid: True, node: 35, level: 13" node_number="35"><div class="valid" valid="valid" title="valid: True, node: 36, level: 14" node_number="36"> Synchronous functions may not call an asynchronous function (though asynchronous functions may call synchronous functions).</div> </li> <li class="valid" valid="valid" title="valid: True, node: 37, level: 13" node_number="37"><div class="valid" valid="valid" title="valid: True, node: 38, level: 14" node_number="38"> Calling an asynchronous function requires the entire call stack to be asynchronous</div> </li> </ul> <p class="valid" valid="valid" title="valid: True, node: 39, level: 12" node_number="39"> For people who are familiar with using promises and/or await/yield to achieve writing asynchronous code, the problem can be expressed as: &#8220;Once one function returns a promise somewhere in your call stack, the entire call stack needs to return a promise because the result of the call cannot be known until the promise is resolved.&#8221; </p> <p class="valid" valid="valid" title="valid: True, node: 40, level: 12" node_number="40"> This <abbr class="valid" valid="valid" title="valid: True, node: 41, level: 13" node_number="41">RFC</abbr> seeks to eliminate the distinction between synchronous and asynchronous functions by allowing functions to be interruptible without polluting the entire call stack. This would be achieved by: </p> <ul class="valid" valid="valid" title="valid: True, node: 42, level: 12" node_number="42"> <li class="valid" valid="valid" title="valid: True, node: 43, level: 13" node_number="43"><div class="valid" valid="valid" title="valid: True, node: 44, level: 14" node_number="44"> Adding support for Fibers to PHP.</div> </li> <li class="valid" valid="valid" title="valid: True, node: 45, level: 13" node_number="45"><div class="valid" valid="valid" title="valid: True, node: 46, level: 14" node_number="46"> Adding a <code title="valid: False, node: 47, level: 15" node_number="47">Fiber</code> class and the corresponding reflection class <code title="valid: False, node: 48, level: 15" node_number="48">ReflectionFiber</code>.</div> </li> <li class="valid" valid="valid" title="valid: True, node: 49, level: 13" node_number="49"><div class="valid" valid="valid" title="valid: True, node: 50, level: 14" node_number="50"> Adding exception classes <code title="valid: False, node: 51, level: 15" node_number="51">FiberError</code> and <code title="valid: False, node: 52, level: 15" node_number="52">FiberExit</code> to represent errors.</div> </li> </ul> <p class="valid" valid="valid" title="valid: True, node: 53, level: 12" node_number="53"> Fibers allow for transparent non-blocking I/O implementations of existing interfaces (such as PSR-7, Doctine ORM, etc.). This is because the placeholder (promise) object is eliminated. Functions instead can declare the I/O result type instead of a placeholder object which cannot specify a resolution type because PHP does not support generics. </p> </div> <h3 class="valid" valid="valid" title="valid: True, node: 54, level: 11" node_number="54">Fibers</h3> <div class="valid" valid="valid" title="valid: True, node: 55, level: 11" node_number="55"> <p class="valid" valid="valid" title="valid: True, node: 56, level: 12" node_number="56"> Fibers allow the creation of full-stack, interruptible functions that can be used to implement cooperative multitasking in PHP. These are also known as coroutines or green-threads. </p> <p class="valid" valid="valid" title="valid: True, node: 57, level: 12" node_number="57"> Fibers pause the entire execution stack, so the direct caller of the function does not need to change how it invokes the function. </p> <p class="valid" valid="valid" title="valid: True, node: 58, level: 12" node_number="58"> Execution may be interrupted anywhere in the call stack using <code class="valid" valid="valid" title="valid: True, node: 59, level: 13" node_number="59">Fiber::suspend()</code> (that is, the call to <code class="valid" valid="valid" title="valid: True, node: 60, level: 13" node_number="60">Fiber::suspend()</code> may be in a deeply nested function or not even exist at all). </p> <p class="valid" valid="valid" title="valid: True, node: 61, level: 12" node_number="61"> Unlike stack-less Generators, each Fiber has its own call stack, allowing them to be paused within deeply nested function calls. A function declaring an interruption point (i.e., calling <code class="valid" valid="valid" title="valid: True, node: 62, level: 13" node_number="62">Fiber::suspend()</code>) need not change its return type, unlike a function using <code class="valid" valid="valid" title="valid: True, node: 63, level: 13" node_number="63">yield</code> which must return a <code class="valid" valid="valid" title="valid: True, node: 64, level: 13" node_number="64">Generator</code> instance. </p> <p class="valid" valid="valid" title="valid: True, node: 65, level: 12" node_number="65"> Fibers can be suspended in any function call, including those called from within the PHP VM, such as functions provided to <code class="valid" valid="valid" title="valid: True, node: 66, level: 13" node_number="66">array_map</code> or methods called by <code class="valid" valid="valid" title="valid: True, node: 67, level: 13" node_number="67">foreach</code> on an <code class="valid" valid="valid" title="valid: True, node: 68, level: 13" node_number="68">Iterator</code> object. </p> <p class="valid" valid="valid" title="valid: True, node: 69, level: 12" node_number="69"> Once suspended, execution of the fiber may be resumed with any value using <code class="valid" valid="valid" title="valid: True, node: 70, level: 13" node_number="70">Fiber-&gt;resume()</code> or by throwing an exception into the fiber using <code class="valid" valid="valid" title="valid: True, node: 71, level: 13" node_number="71">Fiber-&gt;throw()</code>. The value is returned (or exception thrown) from <code class="valid" valid="valid" title="valid: True, node: 72, level: 13" node_number="72">Fiber::suspend()</code>. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 73, level: 11" node_number="73">Proposal</h2> <h3 class="valid" valid="valid" title="valid: True, node: 74, level: 11" node_number="74">Fiber</h3> <div class="valid" valid="valid" title="valid: True, node: 75, level: 11" node_number="75"> <p class="valid" valid="valid" title="valid: True, node: 76, level: 12" node_number="76"> A Fiber would be represented as class which would be defined in core PHP with the following signature: </p> <blockquote class="valid" valid="valid" title="valid: True, node: 77, level: 12" node_number="77"> <p class="valid" valid="valid" title="valid: True, node: 78, level: 13" node_number="78"> Fiber::this() has been renamed to Fiber::getCurrent() during the PHP 8.1 alpha release phase. </p> </blockquote><pre class="valid" valid="valid" title="valid: True, node: 79, level: 12" node_number="79">final class Fiber { /** * @param callable $callback Function to invoke when starting the fiber. */ public function __construct(callable $callback) {} /** * Starts execution of the fiber. Returns when the fiber suspends or terminates. * * @param mixed ...$args Arguments passed to fiber function. * * @return mixed Value from the first suspension point or NULL if the fiber returns. * * @throw FiberError If the fiber has already been started. * @throw Throwable If the fiber callable throws an uncaught exception. */ public function start(mixed ...$args): mixed {} /** * Resumes the fiber, returning the given value from {@see Fiber::suspend()}. * Returns when the fiber suspends or terminates. * * @param mixed $value * * @return mixed Value from the next suspension point or NULL if the fiber returns. * * @throw FiberError If the fiber has not started, is running, or has terminated. * @throw Throwable If the fiber callable throws an uncaught exception. */ public function resume(mixed $value = null): mixed {} /** * Throws the given exception into the fiber from {@see Fiber::suspend()}. * Returns when the fiber suspends or terminates. * * @param Throwable $exception * * @return mixed Value from the next suspension point or NULL if the fiber returns. * * @throw FiberError If the fiber has not started, is running, or has terminated. * @throw Throwable If the fiber callable throws an uncaught exception. */ public function throw(Throwable $exception): mixed {} /** * @return bool True if the fiber has been started. */ public function isStarted(): bool {} /** * @return bool True if the fiber is suspended. */ public function isSuspended(): bool {} /** * @return bool True if the fiber is currently running. */ public function isRunning(): bool {} /** * @return bool True if the fiber has completed execution (returned or threw). */ public function isTerminated(): bool {} /** * @return mixed Return value of the fiber callback. NULL is returned if the fiber does not have a return statement. * * @throws FiberError If the fiber has not terminated or the fiber threw an exception. */ public function getReturn(): mixed {} /** * @return self|null Returns the currently executing fiber instance or NULL if in {main}. */ public static function this(): ?self {} /** * Suspend execution of the fiber. The fiber may be resumed with {@see Fiber::resume()} or {@see Fiber::throw()}. * * Cannot be called from {main}. * * @param mixed $value Value to return from {@see Fiber::resume()} or {@see Fiber::throw()}. * * @return mixed Value provided to {@see Fiber::resume()}. * * @throws FiberError Thrown if not within a fiber (i.e., if called from {main}). * @throws Throwable Exception provided to {@see Fiber::throw()}. */ public static function suspend(mixed $value = null): mixed {} }</pre> <p class="valid" valid="valid" title="valid: True, node: 80, level: 12" node_number="80"> A <code class="valid" valid="valid" title="valid: True, node: 81, level: 13" node_number="81">Fiber</code> object is created using <code class="valid" valid="valid" title="valid: True, node: 82, level: 13" node_number="82">new Fiber(callable $callback)</code> with any callable. The callable need not call <code class="valid" valid="valid" title="valid: True, node: 83, level: 13" node_number="83">Fiber::suspend()</code> directly, it may be in a deeply nested call, far down the call stack (or perhaps never call <code class="valid" valid="valid" title="valid: True, node: 84, level: 13" node_number="84">Fiber::suspend()</code> at all). The new <code class="valid" valid="valid" title="valid: True, node: 85, level: 13" node_number="85">Fiber</code> may be started using <code class="valid" valid="valid" title="valid: True, node: 86, level: 13" node_number="86">Fiber-&gt;start(mixed ...$args)</code> with a variadic argument list that is provided as arguments to the callable used when creating the <code class="valid" valid="valid" title="valid: True, node: 87, level: 13" node_number="87">Fiber</code>. </p> <p class="valid" valid="valid" title="valid: True, node: 88, level: 12" node_number="88"> <code class="valid" valid="valid" title="valid: True, node: 89, level: 13" node_number="89">Fiber::suspend()</code> suspends execution of the current fiber and returns execution to the call to <code class="valid" valid="valid" title="valid: True, node: 90, level: 13" node_number="90">Fiber-&gt;start()</code>, <code class="valid" valid="valid" title="valid: True, node: 91, level: 13" node_number="91">Fiber-&gt;resume()</code>, or <code class="valid" valid="valid" title="valid: True, node: 92, level: 13" node_number="92">Fiber-&gt;throw()</code>. Consider <code class="valid" valid="valid" title="valid: True, node: 93, level: 13" node_number="93">Fiber::suspend()</code> to be similar to a generator using <code class="valid" valid="valid" title="valid: True, node: 94, level: 13" node_number="94">yield</code>, which returns execution to the call that advanced the generator. </p> <p class="valid" valid="valid" title="valid: True, node: 95, level: 12" node_number="95"> A suspended fiber may be resumed in one of two ways: </p> <ul class="valid" valid="valid" title="valid: True, node: 96, level: 12" node_number="96"> <li class="valid" valid="valid" title="valid: True, node: 97, level: 13" node_number="97"><div class="valid" valid="valid" title="valid: True, node: 98, level: 14" node_number="98"> returning a value from <code title="valid: False, node: 99, level: 15" node_number="99">Fiber::suspend()</code> using <code title="valid: False, node: 100, level: 15" node_number="100">Fiber-&gt;resume()</code></div> </li> <li class="valid" valid="valid" title="valid: True, node: 101, level: 13" node_number="101"><div class="valid" valid="valid" title="valid: True, node: 102, level: 14" node_number="102"> throwing an exception from <code title="valid: False, node: 103, level: 15" node_number="103">Fiber::suspend()</code> using <code title="valid: False, node: 104, level: 15" node_number="104">Fiber-&gt;throw()</code></div> </li> </ul> <p class="valid" valid="valid" title="valid: True, node: 105, level: 12" node_number="105"> <code class="valid" valid="valid" title="valid: True, node: 106, level: 13" node_number="106">Fiber-&gt;getReturn()</code> returns the value returned from a terminated fiber (<code class="valid" valid="valid" title="valid: True, node: 107, level: 13" node_number="107">NULL</code> is returned if the fiber did not return a value). This function will throw an instance of <code class="valid" valid="valid" title="valid: True, node: 108, level: 13" node_number="108">FiberError</code> if the fiber has not completed execution or threw an exception. </p> <p class="valid" valid="valid" title="valid: True, node: 109, level: 12" node_number="109"> <code class="valid" valid="valid" title="valid: True, node: 110, level: 13" node_number="110">Fiber::this()</code> returns the currently executing <code class="valid" valid="valid" title="valid: True, node: 111, level: 13" node_number="111">Fiber</code> instance or <code class="valid" valid="valid" title="valid: True, node: 112, level: 13" node_number="112">NULL</code> if called from <code class="valid" valid="valid" title="valid: True, node: 113, level: 13" node_number="113">{main}</code>. This allows a fiber to store a reference to itself elsewhere, such as within an event loop callback or an array of awaiting fibers. </p> </div> <h3 class="valid" valid="valid" title="valid: True, node: 114, level: 11" node_number="114">ReflectionFiber</h3> <div class="valid" valid="valid" title="valid: True, node: 115, level: 11" node_number="115"> <p class="valid" valid="valid" title="valid: True, node: 116, level: 12" node_number="116"> <code class="valid" valid="valid" title="valid: True, node: 117, level: 13" node_number="117">ReflectionFiber</code> is used to inspect executing fibers. A <code class="valid" valid="valid" title="valid: True, node: 118, level: 13" node_number="118">ReflectionFiber</code> object can be created from any <code class="valid" valid="valid" title="valid: True, node: 119, level: 13" node_number="119">Fiber</code> object, even if it has not been started or if it has terminated. This reflection class is similar to <code class="valid" valid="valid" title="valid: True, node: 120, level: 13" node_number="120">ReflectionGenerator</code>. </p> <pre class="valid" valid="valid" title="valid: True, node: 121, level: 12" node_number="121">final class ReflectionFiber { /** * @param Fiber $fiber Any Fiber object, including those that are not started or have * terminated. */ public function __construct(Fiber $fiber) {} /** * @return Fiber The reflected Fiber object. */ public function getFiber(): Fiber {} /** * @return string Current file of fiber execution. */ public function getExecutingFile(): string {} /** * @return int Current line of fiber execution. */ public function getExecutingLine(): int {} /** * @param int $options Same flags as {@see debug_backtrace()}. * * @return array Fiber backtrace, similar to {@see debug_backtrace()} * and {@see ReflectionGenerator::getTrace()}. */ public function getTrace(int $options = DEBUG_BACKTRACE_PROVIDE_OBJECT): array {} /** * @return bool True if the fiber has been started. */ public function isStarted(): bool {} /** * @return bool True if the fiber is currently suspended. */ public function isSuspended(): bool {} /** * @return bool True if the fiber is currently running. */ public function isRunning(): bool {} /** * @return bool True if the fiber has completed execution (either returning or * throwing an exception), false otherwise. */ public function isTerminated(): bool {} }</pre> </div> <h4 class="valid" valid="valid" title="valid: True, node: 122, level: 11" node_number="122">Unfinished Fibers</h4> <div class="valid" valid="valid" title="valid: True, node: 123, level: 11" node_number="123"> <p class="valid" valid="valid" title="valid: True, node: 124, level: 12" node_number="124"> Fibers that are not finished (do not complete execution) are destroyed similarly to unfinished generators, executing any pending <code class="valid" valid="valid" title="valid: True, node: 125, level: 13" node_number="125">finally</code> blocks. <code class="valid" valid="valid" title="valid: True, node: 126, level: 13" node_number="126">Fiber::suspend()</code> may not be invoked in a force-closed fiber, just as <code class="valid" valid="valid" title="valid: True, node: 127, level: 13" node_number="127">yield</code> cannot be used in a force-closed generator. Fibers are destroyed when there are no references to the <code class="valid" valid="valid" title="valid: True, node: 128, level: 13" node_number="128">Fiber</code> object. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 129, level: 11" node_number="129">Fiber Stacks</h4> <div class="valid" valid="valid" title="valid: True, node: 130, level: 11" node_number="130"> <p class="valid" valid="valid" title="valid: True, node: 131, level: 12" node_number="131"> Each fiber is allocated a separate C stack and VM stack on the heap. The C stack is allocated using <code class="valid" valid="valid" title="valid: True, node: 132, level: 13" node_number="132">mmap</code> if available, meaning physical memory is used only on demand (if it needs to be allocated to a stack value) on most platforms. Each fiber stack is allocated a maximum of 8M of memory by default, settable with an ini setting <code class="valid" valid="valid" title="valid: True, node: 133, level: 13" node_number="133">fiber.stack_size</code>. Note that this memory is used for the C stack and is not related to the memory available to PHP code. VM stacks for each fiber are allocated in a similar way to generators and use a similar amount of memory and CPU. VM stacks are able to grow dynamically, so only a single VM page (4K) is initially allocated. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 134, level: 11" node_number="134">Backward Incompatible Changes</h2> <div class="valid" valid="valid" title="valid: True, node: 135, level: 11" node_number="135"> <p class="valid" valid="valid" title="valid: True, node: 136, level: 12" node_number="136"> Declares <code class="valid" valid="valid" title="valid: True, node: 137, level: 13" node_number="137">Fiber</code>, <code class="valid" valid="valid" title="valid: True, node: 138, level: 13" node_number="138">FiberError</code>, <code class="valid" valid="valid" title="valid: True, node: 139, level: 13" node_number="139">FiberExit</code>, and <code class="valid" valid="valid" title="valid: True, node: 140, level: 13" node_number="140">ReflectionFiber</code> in the root namespace. No other BC breaks. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 141, level: 11" node_number="141">Future Scope</h2> <div class="valid" valid="valid" title="valid: True, node: 142, level: 11" node_number="142"> <p class="valid" valid="valid" title="valid: True, node: 143, level: 12" node_number="143"> The current implementation does not provide an internal <abbr class="valid" valid="valid" title="valid: True, node: 144, level: 13" node_number="144">API</abbr> for fibers for PHP extensions. This <abbr class="valid" valid="valid" title="valid: True, node: 145, level: 13" node_number="145">RFC</abbr> focuses on the user space fiber <abbr class="valid" valid="valid" title="valid: True, node: 146, level: 13" node_number="146">API</abbr>. An internal fiber <abbr class="valid" valid="valid" title="valid: True, node: 147, level: 13" node_number="147">API</abbr> will be added, collaborating with other internal developers and using feedback from PHP extension developers, including Swoole, so fibers can be created and controlled from PHP extensions. An extension may still optionally provide their own custom fiber implementation, but an internal <abbr class="valid" valid="valid" title="valid: True, node: 148, level: 13" node_number="148">API</abbr> would allow the extension to use the fiber implementation provided by PHP. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 149, level: 11" node_number="149">Proposed PHP Version(s)</h2> <div class="valid" valid="valid" title="valid: True, node: 150, level: 11" node_number="150"> <p class="valid" valid="valid" title="valid: True, node: 151, level: 12" node_number="151"> PHP 8.1 </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 152, level: 11" node_number="152">Proposed Voting Choices</h2> <div class="valid" valid="valid" title="valid: True, node: 153, level: 11" node_number="153"> <p class="valid" valid="valid" title="valid: True, node: 154, level: 12" node_number="154"> Merge implementation into core, 2/3 required. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 155, level: 11" node_number="155">Patches and Tests</h2> <div class="valid" valid="valid" title="valid: True, node: 156, level: 11" node_number="156"> <p class="valid" valid="valid" title="valid: True, node: 157, level: 12" node_number="157"> Implementation and tests at amphp/ext-fiber. </p> <p class="valid" valid="valid" title="valid: True, node: 158, level: 12" node_number="158"> amphp v3, a work-in-progress, uses <code class="valid" valid="valid" title="valid: True, node: 159, level: 13" node_number="159">ext-fiber</code>. Nearly all libraries under the GitHub organization amphp have branches compatible with amphp v3. The branches are labeled as <code class="valid" valid="valid" title="valid: True, node: 160, level: 13" node_number="160">vX</code>, where <code class="valid" valid="valid" title="valid: True, node: 161, level: 13" node_number="161">X</code> is the current version + 1 (for example, the <code class="valid" valid="valid" title="valid: True, node: 162, level: 13" node_number="162">v5</code> branch of amphp/http-client). See the <code class="valid" valid="valid" title="valid: True, node: 163, level: 13" node_number="163">examples</code> directories in various libraries for samples of PHP code using fibers. </p> <p class="valid" valid="valid" title="valid: True, node: 164, level: 12" node_number="164"> React Fiber uses <code class="valid" valid="valid" title="valid: True, node: 165, level: 13" node_number="165">ext-fiber</code> and the current stable versions of <code class="valid" valid="valid" title="valid: True, node: 166, level: 13" node_number="166">react/event-loop</code> and <code class="valid" valid="valid" title="valid: True, node: 167, level: 13" node_number="167">react/promise</code> to create coroutines and await any instance of <code class="valid" valid="valid" title="valid: True, node: 168, level: 13" node_number="168">React\Promise\PromiseInterface</code> until it is resolved. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 169, level: 11" node_number="169">Examples</h2> <div class="valid" valid="valid" title="valid: True, node: 170, level: 11" node_number="170"> <p class="valid" valid="valid" title="valid: True, node: 171, level: 12" node_number="171"> This first simple example creates a fiber that immediately suspends with the string <code class="valid" valid="valid" title="valid: True, node: 172, level: 13" node_number="172">&#8220;fiber&#8221;</code>. This string is returned from the call to <code class="valid" valid="valid" title="valid: True, node: 173, level: 13" node_number="173">$fiber-&gt;start()</code>. The fiber is then resumed with the string <code class="valid" valid="valid" title="valid: True, node: 174, level: 13" node_number="174">&#8220;test&#8221;</code>, which is returned from the call to <code class="valid" valid="valid" title="valid: True, node: 175, level: 13" node_number="175">Fiber::suspend()</code>. </p> <pre class="valid" valid="valid" title="valid: True, node: 176, level: 12" node_number="176">$fiber = new Fiber(function (): void { $value = Fiber::suspend('fiber'); echo "Value used to resume fiber: ", $value, ""; }); $value = $fiber-&gt;start(); echo "Value from fiber suspending: ", $value, ""; $fiber-&gt;resume('test');</pre> <p class="valid" valid="valid" title="valid: True, node: 177, level: 12" node_number="177"> This example will output the following: </p> <pre class="valid" valid="valid" title="valid: True, node: 178, level: 12" node_number="178">Value from fiber suspending: fiber Value used to resume fiber: test</pre> <p class="valid" valid="valid" title="valid: True, node: 179, level: 12" node_number="179"> The next example defines a very simple event loop with the ability to poll a socket for incoming data, invoking a callback when data becomes available on the socket. This event loop can now be used to resume a fiber only when data becomes available on a socket, avoiding a blocking read. </p> <pre class="valid" valid="valid" title="valid: True, node: 180, level: 12" node_number="180">class EventLoop { private string $nextId = 'a'; private array $deferCallbacks = []; private array $read = []; private array $streamCallbacks = []; public function run(): void { while (!empty($this-&gt;deferCallbacks) || !empty($this-&gt;read)) { $defers = $this-&gt;deferCallbacks; $this-&gt;deferCallbacks = []; foreach ($defers as $id =&gt; $defer) { $defer(); } $this-&gt;select($this-&gt;read); } } private function select(array $read): void { $timeout = empty($this-&gt;deferCallbacks) ? null : 0; if (!stream_select($read, $write, $except, $timeout, $timeout)) { return; } foreach ($read as $id =&gt; $resource) { $callback = $this-&gt;streamCallbacks[$id]; unset($this-&gt;read[$id], $this-&gt;streamCallbacks[$id]); $callback($resource); } } public function defer(callable $callback): void { $id = $this-&gt;nextId++; $this-&gt;deferCallbacks[$id] = $callback; } public function read($resource, callable $callback): void { $id = $this-&gt;nextId++; $this-&gt;read[$id] = $resource; $this-&gt;streamCallbacks[$id] = $callback; } } [$read, $write] = stream_socket_pair( stripos(PHP_OS, 'win') === 0 ? STREAM_PF_INET : STREAM_PF_UNIX, STREAM_SOCK_STREAM, STREAM_IPPROTO_IP ); // Set streams to non-blocking mode. stream_set_blocking($read, false); stream_set_blocking($write, false); $loop = new EventLoop; // Read data in a separate fiber after checking if the stream is readable. $fiber = new Fiber(function () use ($loop, $read): void { echo "Waiting for data..."; $fiber = Fiber::this(); $loop-&gt;read($read, fn() =&gt; $fiber-&gt;resume()); Fiber::suspend(); $data = fread($read, 8192); echo "Received data: ", $data, ""; }); // Start the fiber, which will suspend while waiting for a read event. $fiber-&gt;start(); // Defer writing data to an event loop callback. $loop-&gt;defer(fn() =&gt; fwrite($write, "Hello, world!")); // Run the event loop. $loop-&gt;run();</pre> <p class="valid" valid="valid" title="valid: True, node: 181, level: 12" node_number="181"> This script will output the following: </p> <pre class="valid" valid="valid" title="valid: True, node: 182, level: 12" node_number="182">Waiting for data... Received data: Hello, world!</pre> <p class="valid" valid="valid" title="valid: True, node: 183, level: 12" node_number="183"> If this example were written in a similar order without fibers, the script would be unable to read from a socket before writing to it, as the call to <code class="valid" valid="valid" title="valid: True, node: 184, level: 13" node_number="184">fread()</code> would block until data was available. </p> <p class="valid" valid="valid" title="valid: True, node: 185, level: 12" node_number="185"> Below is a chart illustrating execution flow between <code class="valid" valid="valid" title="valid: True, node: 186, level: 13" node_number="186">{main}</code> and the fiber created by <code class="valid" valid="valid" title="valid: True, node: 187, level: 13" node_number="187">new Fiber()</code>. Execution flow switches between fibers as <code class="valid" valid="valid" title="valid: True, node: 188, level: 13" node_number="188">Fiber::suspend()</code> and <code class="valid" valid="valid" title="valid: True, node: 189, level: 13" node_number="189">Fiber-&gt;resume()</code> are called or when a fiber terminates. </p> <p class="valid" valid="valid" title="valid: True, node: 190, level: 12" node_number="190"> The next few examples use the async framework amphp v3 mentioned in Patches and Tests to demonstrate how fibers may be used by frameworks to create asynchronous code that is written like synchronous code. </p> <p class="valid" valid="valid" title="valid: True, node: 191, level: 12" node_number="191"> amphp v3 uses an event loop interface together with a variety of functions and a placeholder object (<code class="valid" valid="valid" title="valid: True, node: 192, level: 13" node_number="192">Promise</code>) to build on top of the underlying fiber <abbr class="valid" valid="valid" title="valid: True, node: 193, level: 13" node_number="193">API</abbr> to create its own opinionated <abbr class="valid" valid="valid" title="valid: True, node: 194, level: 13" node_number="194">API</abbr> to create green-threads (coroutines) to execute code concurrently. Users of amphp v3 do not use the Fiber <abbr class="valid" valid="valid" title="valid: True, node: 195, level: 13" node_number="195">API</abbr> directly, the framework handles suspending and creating fibers as necessary, including adding the ability to await from <code class="valid" valid="valid" title="valid: True, node: 196, level: 13" node_number="196">{main}}</code>. Other frameworks may choose to approach creating green-threads and placeholders differently. </p> <p class="valid" valid="valid" title="valid: True, node: 197, level: 12" node_number="197"> The <code class="valid" valid="valid" title="valid: True, node: 198, level: 13" node_number="198">defer(callable $callback, mixed ...$args)</code> function creates a new fiber that is executed when the current fiber suspends or terminates. <code class="valid" valid="valid" title="valid: True, node: 199, level: 13" node_number="199">delay(int $milliseconds)</code> suspends the current fiber until the given number of milliseconds has elasped. </p> <pre class="valid" valid="valid" title="valid: True, node: 200, level: 12" node_number="200">use function Amp\defer; use function Amp\delay; // defer() creates a new fiber and starts it when the // current fiber is suspended or terminated. defer(function (): void { delay(1500); var_dump(1); }); defer(function (): void { delay(1000); var_dump(2); }); defer(function (): void { delay(2000); var_dump(3); }); // Suspend the main context with delay(). delay(500); var_dump(4);</pre> <p class="valid" valid="valid" title="valid: True, node: 201, level: 12" node_number="201"> The next example again uses amphp v3 to demonstrate how the event loop fiber continues executing while the main thread is &#8220;suspended&#8221;. The <code class="valid" valid="valid" title="valid: True, node: 202, level: 13" node_number="202">await(Promise $promise)</code> function suspends a fiber until the given promise is resolved and the <code class="valid" valid="valid" title="valid: True, node: 203, level: 13" node_number="203">async(callable $callback, mixed ...$args)</code> function creates a new fiber, returning a promise that is resolved when the fiber completes, allowing multiple fibers to be executed concurrently. </p> <pre class="valid" valid="valid" title="valid: True, node: 204, level: 12" node_number="204">use function Amp\async; use function Amp\await; use function Amp\defer; use function Amp\delay; // Note that the function declares int as a return type, not Promise or Generator, // but executes as a coroutine. function asyncTask(int $id): int { // Nothing useful is done here, but rather acts as a substitute for async I/O. delay(1000); // Suspends the fiber this function executes within for 1 second. return $id; } $running = true; defer(function () use ($running): void { // This loop is to show how this fiber is not blocked by other fibers. while ($running) { delay(100); echo "."; } }); // Invoking asyncTask() returns an int after 1 second, but is executed concurrently. $result = asyncTask(1); // Call a subroutine within this fiber, taking 1 second to return. var_dump($result); // Simultaneously runs two new fibers, await their resolution in the main fiber. // await() suspends the fiber until the given promise (or array of promises here) are resolved. $result = await([ // Executed simultaneously, only 1 second will elapse during this await. async(fn() =&gt; asyncTask(2)), // async() creates a new fiber and returns a promise for the result. async(fn() =&gt; asyncTask(3)), ]); var_dump($result); // Executed after 2 seconds. $result = asyncTask(4); // Call takes 1 second to return. var_dump($result); // array_map() takes 2 seconds to execute as the two calls are not concurrent, but this shows // that fibers are supported by internal callbacks. $result = array_map(fn(int $value) =&gt; asyncTask($value), [5, 6]); var_dump($result); $running = false; // Stop the loop in the fiber created with defer() above.</pre> <p class="valid" valid="valid" title="valid: True, node: 205, level: 12" node_number="205"> Since fibers can be paused during calls within the PHP VM, fibers can also be used to create asynchronous iterators and generators. The example below uses amphp v3 to suspend a fiber within a generator, awaiting resolution of a <code class="valid" valid="valid" title="valid: True, node: 206, level: 13" node_number="206">Delayed</code>, a promise-like object that resolves itself with the second argument after the number of milliseconds given as the first argument. When iterating over the generator, the <code class="valid" valid="valid" title="valid: True, node: 207, level: 13" node_number="207">foreach</code> loop will suspend while waiting for another value to be yielded from the generator. </p> <pre class="valid" valid="valid" title="valid: True, node: 208, level: 12" node_number="208">use Amp\Delayed; use function Amp\await; function generator(): Generator { yield await(new Delayed(500, 1)); yield await(new Delayed(1500, 2)); yield await(new Delayed(1000, 3)); yield await(new Delayed(2000, 4)); yield 5; yield 6; yield 7; yield await(new Delayed(2000, 8)); yield 9; yield await(new Delayed(1000, 10)); } // Iterate over the generator as normal, but the loop will // be suspended and resumed as needed. foreach (generator() as $value) { printf("Generator yielded %d", $value); } // Argument unpacking also can use a suspending generator. var_dump(...generator());</pre> <p class="valid" valid="valid" title="valid: True, node: 209, level: 12" node_number="209"> The example below shows how ReactPHP might use fibers to define an <code class="valid" valid="valid" title="valid: True, node: 210, level: 13" node_number="210">await()</code> function that could be used to await promise resolution within a fiber using their <code class="valid" valid="valid" title="valid: True, node: 211, level: 13" node_number="211">PromiseInterface</code> and <code class="valid" valid="valid" title="valid: True, node: 212, level: 13" node_number="212">LoopInterface</code>. </p> <pre class="valid" valid="valid" title="valid: True, node: 213, level: 12" node_number="213">use React\EventLoop\LoopInterface; use React\Promise\PromiseInterface; function await(PromiseInterface $promise, LoopInterface $loop): mixed { $fiber = Fiber::this(); if ($fiber === null) { throw new Error('Promises can only be awaited within a fiber'); } $promise-&gt;done( fn(mixed $value) =&gt; $loop-&gt;futureTick(fn() =&gt; $fiber-&gt;resume($value)), fn(Throwable $reason) =&gt; $loop-&gt;futureTick(fn() =&gt; $fiber-&gt;throw($reason)) ); return Fiber::suspend(); }</pre> <p class="valid" valid="valid" title="valid: True, node: 214, level: 12" node_number="214"> A demonstration of integrating ReactPHP with fibers has been implemented in trowski/react-fiber for the current stable versions of <code class="valid" valid="valid" title="valid: True, node: 215, level: 13" node_number="215">react/event-loop</code> and <code class="valid" valid="valid" title="valid: True, node: 216, level: 13" node_number="216">react/promise</code>. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 217, level: 11" node_number="217">FAQ</h2> <h4 class="valid" valid="valid" title="valid: True, node: 218, level: 11" node_number="218">Who is the target audience for this feature?</h4> <div class="valid" valid="valid" title="valid: True, node: 219, level: 11" node_number="219"> <p class="valid" valid="valid" title="valid: True, node: 220, level: 12" node_number="220"> Fibers are an advanced feature that most users will not use directly. This feature is primarily targeted at library and framework authors to provide an event loop and an asynchronous programming <abbr class="valid" valid="valid" title="valid: True, node: 221, level: 13" node_number="221">API</abbr>. Fibers allow integrating asynchronous code execution seamlessly into synchronous code at any point without the need to modify the application call stack or add boilerplate code. </p> <p class="valid" valid="valid" title="valid: True, node: 222, level: 12" node_number="222"> The Fiber <abbr class="valid" valid="valid" title="valid: True, node: 223, level: 13" node_number="223">API</abbr> is not expected to be used directly in application-level code. Fibers provide a basic, low-level flow-control <abbr class="valid" valid="valid" title="valid: True, node: 224, level: 13" node_number="224">API</abbr> to create higher-level abstractions that are then used in application code. </p> <p class="valid" valid="valid" title="valid: True, node: 225, level: 12" node_number="225"> <code class="valid" valid="valid" title="valid: True, node: 226, level: 13" node_number="226">FFI</code> is an example of a feature recently added to PHP that most users may not use directly, but can benefit from greatly within libraries they use. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 227, level: 11" node_number="227">What about performance?</h4> <div class="valid" valid="valid" title="valid: True, node: 228, level: 11" node_number="228"> <p class="valid" valid="valid" title="valid: True, node: 229, level: 12" node_number="229"> Switching between fibers is lightweight, requiring changing the value of approximately 20 pointers, give or take, depending on platform. Switching execution context in the PHP VM is similar to Generators, again only requiring the swapping of a few pointers. Since fibers exist within a single process thread, switching between fibers is significantly more performant than switching between processes or threads. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 230, level: 11" node_number="230">What platforms are supported?</h4> <div class="valid" valid="valid" title="valid: True, node: 231, level: 11" node_number="231"> <p class="valid" valid="valid" title="valid: True, node: 232, level: 12" node_number="232"> Fibers are supported on nearly all modern CPU architectures, including x86, x86_64, 32- and 64-bit ARM, 32- and 64-bit PPC, MIPS, Windows (architecture independent, Windows provides a fiber <abbr class="valid" valid="valid" title="valid: True, node: 233, level: 13" node_number="233">API</abbr>), and older Posix platforms with ucontext. Support for C stack switching using assembly code is provided by <a class="valid" valid="valid" title="valid: True, node: 234, level: 13" node_number="234">Boost</a>, which has an <a class="valid" valid="valid" title="valid: True, node: 235, level: 13" node_number="235">OSI-approved</a> <a class="valid" valid="valid" title="valid: True, node: 236, level: 13" node_number="236">license</a> that allows components to be distributed directly with PHP. </p> <p class="valid" valid="valid" title="valid: True, node: 237, level: 12" node_number="237"> <code class="valid" valid="valid" title="valid: True, node: 238, level: 13" node_number="238">ext-fiber</code> is actively tested on <a class="valid" valid="valid" title="valid: True, node: 239, level: 13" node_number="239">Travis</a> for Linux running on x86_64 and 64-bit ARM, on <a class="valid" valid="valid" title="valid: True, node: 240, level: 13" node_number="240">AppVeyor</a> for Windows, and by the developers on macOS running on x86_64. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 241, level: 11" node_number="241">How are execution stacks swapped?</h4> <div class="valid" valid="valid" title="valid: True, node: 242, level: 11" node_number="242"> <p class="valid" valid="valid" title="valid: True, node: 243, level: 12" node_number="243"> Each fiber holds a pointer to a C stack and a VM stack (<code class="valid" valid="valid" title="valid: True, node: 244, level: 13" node_number="244">zend_execute_data</code>). When entering a fiber, the current C stack is swapped and the <code class="valid" valid="valid" title="valid: True, node: 245, level: 13" node_number="245">EX(current_execute_data)</code> pointer are swapped for those held by the fiber. The previous VM stack is backed up in memory where execution will resume when the entered fiber is suspended or completes. The previous VM stack is restored in <code class="valid" valid="valid" title="valid: True, node: 246, level: 13" node_number="246">EX(current_execute_data)</code> when the prior fiber is entered again, either by the other fiber suspending or completing. </p> <p class="valid" valid="valid" title="valid: True, node: 247, level: 12" node_number="247"> Functions such as <code class="valid" valid="valid" title="valid: True, node: 248, level: 13" node_number="248">debug_backtrace()</code> and exception backtraces only include the trace of the current fiber. Previous fiber backtraces are not included currently, though this may be possible with some modification to the internal functions that generate these traces to also include the backtrace of the fibers that entered the current fiber. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 249, level: 11" node_number="249">How does blocking code affect fibers</h4> <div class="valid" valid="valid" title="valid: True, node: 250, level: 11" node_number="250"> <p class="valid" valid="valid" title="valid: True, node: 251, level: 12" node_number="251"> Blocking code (such as <code class="valid" valid="valid" title="valid: True, node: 252, level: 13" node_number="252">file_get_contents()</code>) will continue to block the entire process, even if other fibers exist. Code must be written to use asynchonous I/O, an event loop, and fibers to see a performance and concurrency benefit. As mentioned in the introduction, several libraries already exist for asynchronous I/O and can take advantage of fibers to integrate with synchronous code while expanding the potential for concurrency in an application. </p> <p class="valid" valid="valid" title="valid: True, node: 253, level: 12" node_number="253"> As fibers allow transparent use of asynchronous I/O, blocking implementations can be replaced by non-blocking implementations without affecting the entire call stack. If an internal event loop is available in the future, internal functions such as <code class="valid" valid="valid" title="valid: True, node: 254, level: 13" node_number="254">sleep()</code> could be made non-blocking by default. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 255, level: 11" node_number="255">How do various fibers access the same memory?</h4> <div class="valid" valid="valid" title="valid: True, node: 256, level: 11" node_number="256"> <p class="valid" valid="valid" title="valid: True, node: 257, level: 12" node_number="257"> All fibers exist within a single thread. Only a single fiber may execute at a time, so memory cannot be accessed or modified simultaneously by multiple fibers, unlike threads which may modify memory simultaneously. </p> <p class="valid" valid="valid" title="valid: True, node: 258, level: 12" node_number="258"> As fibers are suspended and resumed, execution of multiple fibers that access the same memory can be interleaved. Thus a running fiber may modify memory depended upon by another suspended fiber. There are various strategies to address this problem, including mutexes, semaphores, memory parcels, and channels. This <abbr class="valid" valid="valid" title="valid: True, node: 259, level: 13" node_number="259">RFC</abbr> does not provide any such implementations as these can be implemented in user space code using the proposed fiber <abbr class="valid" valid="valid" title="valid: True, node: 260, level: 13" node_number="260">API</abbr>. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 261, level: 11" node_number="261">Why add this to PHP core?</h4> <div class="valid" valid="valid" title="valid: True, node: 262, level: 11" node_number="262"> <p class="valid" valid="valid" title="valid: True, node: 263, level: 12" node_number="263"> Adding this capability directly in PHP core makes it widely available on any host providing PHP. Often users are not able to determine what extensions may be available in a particular hosting environment, are unsure of how to install extensions, or do not want to install 3rd-party extensions. With fibers in PHP core, any library author may use the feature without concerns for portability. </p> <p class="valid" valid="valid" title="valid: True, node: 264, level: 12" node_number="264"> Extensions that profile code need to account for switching fibers when creating backtraces and calculating execution times. This needs to be provided as a core internal <abbr class="valid" valid="valid" title="valid: True, node: 265, level: 13" node_number="265">API</abbr> so any profiler could support fibers. The internal <abbr class="valid" valid="valid" title="valid: True, node: 266, level: 13" node_number="266">API</abbr> that would be provided is out of scope of this <abbr class="valid" valid="valid" title="valid: True, node: 267, level: 13" node_number="267">RFC</abbr> as it would not affect user code. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 268, level: 11" node_number="268">Why not add an event loop and async/await API to core?</h4> <div class="valid" valid="valid" title="valid: True, node: 269, level: 11" node_number="269"> <p class="valid" valid="valid" title="valid: True, node: 270, level: 12" node_number="270"> This <abbr class="valid" valid="valid" title="valid: True, node: 271, level: 13" node_number="271">RFC</abbr> proposes only the bare minimum required to allow user code to implement full-stack coroutines or green-threads in PHP. There are several frameworks that implement their own event loop <abbr class="valid" valid="valid" title="valid: True, node: 272, level: 13" node_number="272">API</abbr>, promises, and other asynchronous APIs. These APIs vary greatly and are opinionated, designed for a particular purpose, and their particular needs may not be able to be covered by a core <abbr class="valid" valid="valid" title="valid: True, node: 273, level: 13" node_number="273">API</abbr> that is designed by only a few individuals. </p> <p class="valid" valid="valid" title="valid: True, node: 274, level: 12" node_number="274"> It is the opinion of the authors of this <abbr class="valid" valid="valid" title="valid: True, node: 275, level: 13" node_number="275">RFC</abbr> that it is best to provide the bare minimum in core and allow user code to implement other components as they desire. If the community moves toward a single event loop <abbr class="valid" valid="valid" title="valid: True, node: 276, level: 13" node_number="276">API</abbr> or a need emerges for an event loop in PHP core, this can be done in a future <abbr class="valid" valid="valid" title="valid: True, node: 277, level: 13" node_number="277">RFC</abbr>. Providing a core event loop without core functionality using it (such as streams, file access, etc.) would be misleading and confusing for users. Deferring such functionality to user frameworks and providing only a minimum <abbr class="valid" valid="valid" title="valid: True, node: 278, level: 13" node_number="278">API</abbr> in core keeps expectations in check. </p> <p class="valid" valid="valid" title="valid: True, node: 279, level: 12" node_number="279"> This <abbr class="valid" valid="valid" title="valid: True, node: 280, level: 13" node_number="280">RFC</abbr> does not preclude adding async/await and an event loop to core. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 281, level: 11" node_number="281">How does this proposal differ from prior Fiber proposals?</h4> <div class="valid" valid="valid" title="valid: True, node: 282, level: 11" node_number="282"> <p class="valid" valid="valid" title="valid: True, node: 283, level: 12" node_number="283"> The prior <a class="valid" valid="valid" title="valid: True, node: 284, level: 13" node_number="284">Fiber RFC</a> did not support context switching within internal calls (<code class="valid" valid="valid" title="valid: True, node: 285, level: 13" node_number="285">array_map</code>, <code class="valid" valid="valid" title="valid: True, node: 286, level: 13" node_number="286">preg_replace_callback</code>, etc.) or opcode handlers (<code class="valid" valid="valid" title="valid: True, node: 287, level: 13" node_number="287">foreach</code>, <code class="valid" valid="valid" title="valid: True, node: 288, level: 13" node_number="288">yield from</code>, etc.). This could result in a crash if a function using fibers was used in any user code called from C code or in extensions that override <code class="valid" valid="valid" title="valid: True, node: 289, level: 13" node_number="289">zend_execute_ex</code> such as Xdebug. </p> </div> <h4 class="valid" valid="valid" title="valid: True, node: 290, level: 11" node_number="290">Are fibers compatible with extensions, including Xdebug?</h4> <div class="valid" valid="valid" title="valid: True, node: 291, level: 11" node_number="291"> <p class="valid" valid="valid" title="valid: True, node: 292, level: 12" node_number="292"> Fibers do not change how the PHP VM executes PHP code and suspending is supported within the C stack, so fibers are compatible with PHP extensions that simply provide a bridge to a C <abbr class="valid" valid="valid" title="valid: True, node: 293, level: 13" node_number="293">API</abbr>, including those using callbacks that may call <code class="valid" valid="valid" title="valid: True, node: 294, level: 13" node_number="294">Fiber::suspend()</code>. </p> <p class="valid" valid="valid" title="valid: True, node: 295, level: 12" node_number="295"> Some extensions hook into the PHP VM and therefore are of particular interest for compatibility. </p> <ul class="valid" valid="valid" title="valid: True, node: 296, level: 12" node_number="296"> <li class="valid" valid="valid" title="valid: True, node: 297, level: 13" node_number="297"><div class="valid" valid="valid" title="valid: True, node: 298, level: 14" node_number="298"> <a title="valid: False, node: 299, level: 15" node_number="299">Xdebug</a> is compatible as of a bugfix in version 3.0.1. Breakpoints may be set within fibers and inspected as usual within IDEs and debuggers such as PhpStorm. Code coverage works as expected.</div> </li> <li class="valid" valid="valid" title="valid: True, node: 300, level: 13" node_number="300"><div class="valid" valid="valid" title="valid: True, node: 301, level: 14" node_number="301"> <a title="valid: False, node: 302, level: 15" node_number="302">pcov</a> generates code coverage as expected, including code executed within separate fibers.</div> </li> <li class="valid" valid="valid" title="valid: True, node: 303, level: 13" node_number="303"><div class="valid" valid="valid" title="valid: True, node: 304, level: 14" node_number="304"> <a title="valid: False, node: 305, level: 15" node_number="305">parallel</a> is able to use fibers within threads.</div> </li> </ul> <p class="valid" valid="valid" title="valid: True, node: 306, level: 12" node_number="306"> As noted in <a class="valid" valid="valid" title="valid: True, node: 307, level: 13" node_number="307">&#8220;Why add this to PHP core?&#8221;</a>, extensions that profile code, create backtraces, provide execution times, etc. will need to be updated to account for switching between fibers to provide correct data. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 308, level: 11" node_number="308">Vote</h2> <div class="valid" valid="valid" title="valid: True, node: 309, level: 11" node_number="309"> <p class="valid" valid="valid" title="valid: True, node: 310, level: 12" node_number="310"> Voting started on 2021-03-08 and will run through 2021-03-22. 2/3 required to accept. </p> </div> <h2 class="valid" valid="valid" title="valid: True, node: 311, level: 11" node_number="311">References</h2> <div class="valid" valid="valid" title="valid: True, node: 312, level: 11" node_number="312"> <ul class="valid" valid="valid" title="valid: True, node: 313, level: 12" node_number="313"> <li class="valid" valid="valid" title="valid: True, node: 314, level: 13" node_number="314"><div class="valid" valid="valid" title="valid: True, node: 315, level: 14" node_number="315"> <a title="valid: False, node: 316, level: 15" node_number="316">Boost C++ fibers</a></div> </li> <li class="valid" valid="valid" title="valid: True, node: 317, level: 13" node_number="317"><div class="valid" valid="valid" title="valid: True, node: 318, level: 14" node_number="318"> <a title="valid: False, node: 319, level: 15" node_number="319">Ruby Fibers</a></div> </li> <li class="valid" valid="valid" title="valid: True, node: 320, level: 13" node_number="320"><div class="valid" valid="valid" title="valid: True, node: 321, level: 14" node_number="321"> <a title="valid: False, node: 322, level: 15" node_number="322">Lua Fibers</a></div> </li> <li class="valid" valid="valid" title="valid: True, node: 323, level: 13" node_number="323"><div class="valid" valid="valid" title="valid: True, node: 324, level: 14" node_number="324"> <a title="valid: False, node: 325, level: 15" node_number="325">Project Loom for Java</a></div> </li> </ul> </div> </div> <div class="valid" valid="valid" title="valid: True, node: 326, level: 10" node_number="326"><bdi class="valid" valid="valid" title="valid: True, node: 327, level: 11" node_number="327">rfc/fibers.txt</bdi> &#183; Last modified: 2021/07/12 21:30 by <bdi class="valid" valid="valid" title="valid: True, node: 328, level: 11" node_number="328">kelunik</bdi></div> </div></div> <div class="valid" valid="valid" title="valid: True, node: 329, level: 8" node_number="329"> <h3 class="valid" valid="valid" title="valid: True, node: 330, level: 9" node_number="330">Page Tools</h3> <div class="valid" valid="valid" title="valid: True, node: 331, level: 9" node_number="331"> <ul class="valid" valid="valid" title="valid: True, node: 332, level: 10" node_number="332"> <li class="valid" valid="valid" title="valid: True, node: 333, level: 11" node_number="333"><a class="valid" valid="valid" title="valid: True, node: 334, level: 12" node_number="334">Show pagesource</a></li><li class="valid" valid="valid" title="valid: True, node: 335, level: 11" node_number="335"><a class="valid" valid="valid" title="valid: True, node: 336, level: 12" node_number="336">Old revisions</a></li><li class="valid" valid="valid" title="valid: True, node: 337, level: 11" node_number="337"><a class="valid" valid="valid" title="valid: True, node: 338, level: 12" node_number="338">Backlinks</a></li><li class="valid" valid="valid" title="valid: True, node: 339, level: 11" node_number="339"><a class="valid" valid="valid" title="valid: True, node: 340, level: 12" node_number="340">Back to top</a></li> </ul> </div> </div> </div> </div></div> </section> &#65279;<section class="valid" valid="valid" title="valid: True, node: 341, level: 4" node_number="341"> <div class="valid" valid="valid" title="valid: True, node: 342, level: 5" node_number="342"> <h3 class="valid" valid="valid" title="valid: True, node: 343, level: 6" node_number="343">Table of Contents</h3> <div class="valid" valid="valid" title="valid: True, node: 344, level: 6" node_number="344"> <ul class="valid" valid="valid" title="valid: True, node: 345, level: 7" node_number="345"> <li class="valid" valid="valid" title="valid: True, node: 346, level: 8" node_number="346"><div class="valid" valid="valid" title="valid: True, node: 347, level: 9" node_number="347"><a class="valid" valid="valid" title="valid: True, node: 348, level: 10" node_number="348">PHP RFC: Fibers</a></div> <ul class="valid" valid="valid" title="valid: True, node: 349, level: 9" node_number="349"> <li class="valid" valid="valid" title="valid: True, node: 350, level: 10" node_number="350"><div class="valid" valid="valid" title="valid: True, node: 351, level: 11" node_number="351"><a class="valid" valid="valid" title="valid: True, node: 352, level: 12" node_number="352">Introduction</a></div> <ul class="valid" valid="valid" title="valid: True, node: 353, level: 11" node_number="353"> <li class="valid" valid="valid" title="valid: True, node: 354, level: 12" node_number="354"><div class="valid" valid="valid" title="valid: True, node: 355, level: 13" node_number="355"><a class="valid" valid="valid" title="valid: True, node: 356, level: 14" node_number="356">Fibers</a></div></li> </ul> </li> <li class="valid" valid="valid" title="valid: True, node: 357, level: 10" node_number="357"><div class="valid" valid="valid" title="valid: True, node: 358, level: 11" node_number="358"><a class="valid" valid="valid" title="valid: True, node: 359, level: 12" node_number="359">Proposal</a></div> <ul class="valid" valid="valid" title="valid: True, node: 360, level: 11" node_number="360"> <li class="valid" valid="valid" title="valid: True, node: 361, level: 12" node_number="361"><div class="valid" valid="valid" title="valid: True, node: 362, level: 13" node_number="362"><a class="valid" valid="valid" title="valid: True, node: 363, level: 14" node_number="363">Fiber</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 364, level: 12" node_number="364"><div class="valid" valid="valid" title="valid: True, node: 365, level: 13" node_number="365"><a class="valid" valid="valid" title="valid: True, node: 366, level: 14" node_number="366">ReflectionFiber</a></div></li> </ul> </li> <li class="valid" valid="valid" title="valid: True, node: 367, level: 10" node_number="367"><div class="valid" valid="valid" title="valid: True, node: 368, level: 11" node_number="368"><a class="valid" valid="valid" title="valid: True, node: 369, level: 12" node_number="369">Backward Incompatible Changes</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 370, level: 10" node_number="370"><div class="valid" valid="valid" title="valid: True, node: 371, level: 11" node_number="371"><a class="valid" valid="valid" title="valid: True, node: 372, level: 12" node_number="372">Future Scope</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 373, level: 10" node_number="373"><div class="valid" valid="valid" title="valid: True, node: 374, level: 11" node_number="374"><a class="valid" valid="valid" title="valid: True, node: 375, level: 12" node_number="375">Proposed PHP Version(s)</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 376, level: 10" node_number="376"><div class="valid" valid="valid" title="valid: True, node: 377, level: 11" node_number="377"><a class="valid" valid="valid" title="valid: True, node: 378, level: 12" node_number="378">Proposed Voting Choices</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 379, level: 10" node_number="379"><div class="valid" valid="valid" title="valid: True, node: 380, level: 11" node_number="380"><a class="valid" valid="valid" title="valid: True, node: 381, level: 12" node_number="381">Patches and Tests</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 382, level: 10" node_number="382"><div class="valid" valid="valid" title="valid: True, node: 383, level: 11" node_number="383"><a class="valid" valid="valid" title="valid: True, node: 384, level: 12" node_number="384">Examples</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 385, level: 10" node_number="385"><div class="valid" valid="valid" title="valid: True, node: 386, level: 11" node_number="386"><a class="valid" valid="valid" title="valid: True, node: 387, level: 12" node_number="387">FAQ</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 388, level: 10" node_number="388"><div class="valid" valid="valid" title="valid: True, node: 389, level: 11" node_number="389"><a class="valid" valid="valid" title="valid: True, node: 390, level: 12" node_number="390">Vote</a></div></li> <li class="valid" valid="valid" title="valid: True, node: 391, level: 10" node_number="391"><div class="valid" valid="valid" title="valid: True, node: 392, level: 11" node_number="392"><a class="valid" valid="valid" title="valid: True, node: 393, level: 12" node_number="393">References</a></div></li> </ul></li> </ul> </div> </div> </section> </section> </div> </body>
        <style tyle='text/css'>
body{
    position: relative;
    padding-left: 30px;
    top: 60px;
}
* {
    border: 1px solid #eee;
    padding: 5px 12px;
    margin: 3px 0;
    box-sizing: content-box;
    background-color: #fff;
    cursor: no-drop;
}
main:hover > *, section:hover > *, header:hover > *, nav:hover > *, a:hover > *, div:hover > *, p:hover > *, ul:hover > *, h1:hover > *, h2:hover > *, h3:hover > *, li:hover > *, span:hover > *{
    border: 2px solid green;
    background-color: #fffeee;
    padding: 5px 23px !important;
    margin: 1px 0;
    color: green;
}
main:hover, section:hover, header:hover, nav:hover, a:hover, div:hover, p:hover, ul:hover, h1:hover, h2:hover, h3:hover, li:hover, span:hover{
    border: 1px solid #fff;
    background-color: #eee;
}
a, span {
    display: block;
}
.selected {
    border: 2px solid orchid !important;
    opacity: 0.8;
    color: orchid !important;
}
.selected * {
    padding: 2px !important;
    color: orchid !important;
}
.valid {
  cursor: pointer;
}
.btn{
  cursor: pointer;
  font-weight: bolder;
  padding: 8px;
}
</style> 
        <script>function OpenOriginalLink($event){
    $event.stopPropagation();
    console.log(url);
}

function removeItem($event){
    $event.stopPropagation();
    console.log('Remove item: ', url)
    localStorage.removeItem(url)
}

function exportData($event){
    $event.stopPropagation();

    result = []
    for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        result.push(localStorage.getItem(key))
    }
    const _url = URL.createObjectURL(new Blob([result.join("\n")], {type: 'text/plain'}))
    $event.target.href = _url;
    localStorage.clear()
}

var removeItemBtn = document.createElement("BUTTON");   // Create a <button> element
removeItemBtn.innerHTML = "Remove Item";
removeItemBtn.classList.add('btn');
removeItemBtn.style.position = "fixed";
removeItemBtn.style.left = '5px';
removeItemBtn.style.top = 0;
removeItemBtn.style.border = "1px solid";
removeItemBtn.style.boxShadow = "3px 3px #888";
removeItemBtn.onclick = removeItem;
document.body.appendChild(removeItemBtn);

var goToOriginLink = document.createElement("A");   // Create a <button> element
goToOriginLink.innerHTML = "GoToOrigin";
goToOriginLink.classList.add('btn');
goToOriginLink.style.position = "fixed"
goToOriginLink.style.left = '115px'
goToOriginLink.style.top = 0;
goToOriginLink.onclick = OpenOriginalLink;
goToOriginLink.setAttribute('href', decodeURIComponent(url));
goToOriginLink.target = '_blank';
document.body.appendChild(goToOriginLink);

var current = new Date
var exportDataLink = document.createElement("A");   // Create a <button> element
exportDataLink.innerHTML = "Export data";
exportDataLink.classList.add('btn');
exportDataLink.download = current.toISOString() + '.exported.txt';
exportDataLink.style.position = "fixed";
exportDataLink.style.right = '5px';
exportDataLink.style.top = 0;
exportDataLink.style.border = "1px solid #888";
exportDataLink.style.boxShadow = "3px 3px #888";
exportDataLink.onclick = exportData;
document.body.appendChild(exportDataLink);

data = {
    'title': null ,
    'article': null
}

var body = document.getElementsByTagName("body")[0];

body.onclick = function($e){
    var num = $e.target.getAttribute('node_number')
    var valid = $e.target.getAttribute('valid')

    if(!valid){
        console.log("Element is invalid")
        return
    }

    if(data.length > 2){
        data = data.splice(0, 2)
    }

    console.log("node:", $e.target)

    if(!data.title && !data.article){
        data.title = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else if (data.title && !data.article){
        data.article = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else{
        selected = Array.from(document.getElementsByClassName("selected"))
        selected.forEach(function(el){
            el.classList.remove('selected')
        })

        data.title = num;
        data.article = null;
        $e.target.classList.add('selected')

    }

    if(data.title && data.article){
        var obj = {
            url: url,
            text: body_html,
            title: data.title,
            article: data.article,
        }

        var datasetItem = JSON.stringify(obj)
        localStorage.setItem(url, datasetItem)
    }
}
</script> 
      </html>