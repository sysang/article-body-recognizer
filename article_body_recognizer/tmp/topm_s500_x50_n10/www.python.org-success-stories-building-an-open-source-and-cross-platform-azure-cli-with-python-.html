<!DOCTYPE html>
<html>
<head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

        <script> var url = encodeURIComponent('https://www.python.org/success-stories/building-an-open-source-and-cross-platform-azure-cli-with-python/');</script>

        <script> var body_html = 'PGJvZHkgPiA8ZGl2ID4gPGRpdiA+IDxwPk5vdGljZTogV2hpbGUgSmF2YVNjcmlwdCBpcyBub3QgZXNzZW50aWFsIGZvciB0aGlzIHdlYnNpdGUsIHlvdXIgaW50ZXJhY3Rpb24gd2l0aCB0aGUgY29udGVudCB3aWxsIGJlIGxpbWl0ZWQuIFBsZWFzZSB0dXJuIEphdmFTY3JpcHQgb24gZm9yIHRoZSBmdWxsIGV4cGVyaWVuY2UuIDwvcD4gPC9kaXY+IDxkaXYgPiAgPC9kaXY+IDxoZWFkZXIgPiA8ZGl2ID4gPGRpdiA+IDxhID5Eb25hdGU8L2E+IDxkaXYgPiA8YSA+4omhIE1lbnU8L2E+PGRpdiA+IDx1bCA+IDxsaSA+IDxhID48c21hbGw+QTwvc21hbGw+IEE8L2E+IDx1bCA+IDxsaSA+U21hbGxlcjwvbGk+IDxsaSA+PGEgPkxhcmdlcjwvYT48L2xpPiA8bGkgPjxhID5SZXNldDwvYT48L2xpPiA8L3VsPiA8L2xpPiA8L3VsPiA8L2Rpdj48ZGl2ID4gPHVsID4gPGxpID4gPGEgPlNvY2lhbGl6ZTwvYT4gPHVsID4gPGxpID48YSA+RmFjZWJvb2s8L2E+PC9saT4gPGxpID48YSA+VHdpdHRlcjwvYT48L2xpPiA8bGkgPjxhID5DaGF0IG9uIElSQzwvYT48L2xpPiA8L3VsPiA8L2xpPiA8L3VsPiA8L2Rpdj4gPC9kaXY+IDwvZGl2PiAgPC9kaXY+IDwvaGVhZGVyPiA8ZGl2ID4gPGRpdiA+IDxzZWN0aW9uID4gPGFydGljbGUgPiA8aDE+QnVpbGRpbmcgYW4gb3Blbi1zb3VyY2UgYW5kIGNyb3NzLXBsYXRmb3JtIEF6dXJlIENMSSB3aXRoIFB5dGhvbjwvaDE+IDxwID4gV3JpdHRlbiBieSBEYW4gVGF5bG9yLCA8YSA+TWljcm9zb2Z0PC9hPiA8L3A+IDxoMj5CYWNrZ3JvdW5kPC9oMj4gPHA+PGEgPk1pY3Jvc29mdCBBenVyZTwvYT4gaXMgYSBjbG91ZCBjb21wdXRpbmcgcGxhdGZvcm0gdGhhdCBzcGFucyBvdmVyIGZpZnR5IGRhdGEgY2VudGVycyB3b3JsZHdpZGUgYW5kIG9mZmVycyBodW5kcmVkcyBvZiBzZXJ2aWNlcy4gQXMgYSBsYXJnZSBjbG91ZCBzZXJ2aWNlLCBpdCBpcyB2ZXJ5IGltcG9ydGFudCB0aGF0IGN1c3RvbWVycyBoYXZlIHRoZSBiZXN0IHRvb2xzIGZvciBkZXBsb3ltZW50IGFuZCBtYW5hZ2VtZW50IG9mIHRoZWlyIHN5c3RlbXMuPC9wPiA8cD5TaW5jZSB0aGUgdmVyeSBiZWdpbm5pbmcsIHdl4oCZdmUgb2ZmZXJlZCBhIHZhcmlldHkgb2YgdG9vbHMgYW5kIGxpYnJhcmllcyBmb3IgZGV2ZWxvcGVycywgYWRtaW5pc3RyYXRvcnMgYW5kIGFyY2hpdGVjdHMgdG8gcGVyZm9ybSBhbGwga2luZCBvZiBhY3Rpb25zOiBmcm9tIHNwaW5uaW5nIHVwIFZpcnR1YWwgTWFjaGluZXMgaW4gdmlydHVhbCBuZXR3b3JrcyB0byBkZXBsb3lpbmcgV2ViIEFwcHMgd2l0aCBQb3N0Z3JlU1FMIGRhdGFiYXNlcy4gT25lIG9mIHRoZSBtb3N0IHBvcHVsYXIgdG9vbHMgb2YgY291cnNlIGlzIHRoZSA8YSA+QXp1cmUg4oCcYXrigJ0gY29tbWFuZCBsaW5lIGludGVyZmFjZTwvYT4uIFRvIGJ1aWxkIHRoaXMgb3BlbiBzb3VyY2UgdG9vbCwgd2hpY2ggaW5jbHVkZXMgdGhvdXNhbmRzIG9mIGNvbW1hbmRzIGFzIHdlbGwgYXMgdGhpcmQtcGFydHkgZXh0ZW5zaW9ucywgd2UgdHVybmVkIHRvIFB5dGhvbi48L3A+IDxoMj5XaHkgUHl0aG9uPC9oMj4gPHA+QXQgdGhlIGJlZ2lubmluZywgdGhlIEF6dXJlIGNvbW1hbmQgbGluZSBleHBlcmllbmNlIHdhcyBhdmFpbGFibGUgYXMgYSBQb3dlclNoZWxsIG1vZHVsZSBmb3IgV2luZG93cyB1c2VycywgYW5kIGFzIGEgTm9kZS5qcy1iYXNlZCBDTEkgZm9yIGV2ZXJ5b25lIGVsc2UsIGluY2x1ZGluZyB1c2VycyB3b3JraW5nIHdpdGggbWFjT1MgYW5kIExpbnV4LiBIb3dldmVyLCBzaWduaWZpY2FudCBncm93dGggbGVkIHRvIGVuZ2luZWVyaW5nIGNvbXBsZXhpdHkgdGhhdCBiZWNhbWUgZGlmZmljdWx0IHRvIHJlc29sdmUuPC9wPiA8cD5Td2l0Y2hpbmcgdG8gUHl0aG9uIGVuYWJsZWQgdXMgdG8gcHJvZHVjZSBvbmUgaW1wbGVtZW50YXRpb24gdGhhdCBiZWhhdmVzIHRoZSBzYW1lIGFjcm9zcyBhbGwgcGxhdGZvcm1zLiBFYWNoIGNvbW1hbmQgaXMgYSB3cmFwcGVyIGFyb3VuZCBvbmUgb3IgbW9yZSBmdW5jdGlvbnMgZnJvbSB0aGUgPGEgPkF6dXJlIFNESyBmb3IgUHl0aG9uPC9hPiwgd2hpY2ggZW5zdXJlcyB0aGF0IGRldmVsb3BlcnMgY2FuIGJ1aWxkIHNjcmlwdHMgd2l0aCBpZGVudGljYWwgZnVuY3Rpb25hbGl0eS4gQW5kIGNvbnNpc3RlbnQgY29tbWFuZCBsaW5lIGNvbnZlbnRpb25zIGVuYWJsZSB1cyB0byBwcm92aWRlIG9uZSBzZXQgb2YgaW5zdHJ1Y3Rpb25zIGZvciBhbGwgdXNlcnMuPC9wPiA8cD5CZWNhdXNlIFB5dGhvbiBpcyBlYXN5IHRvIGRpc3RyaWJ1dGUgZm9yIGFsbCBvdXIgcGxhdGZvcm1zLCB3ZSBjYW4gcHJvdmlkZSBwbGF0Zm9ybS1zcGVjaWZpYyBwYWNrYWdlcyB0aGF0IGFkaGVyZSB0byB0aGUgY29ycmVjdCBjb252ZW50aW9ucy4gT24gV2luZG93cywgeW91IGNhbiB1c2UgYSByZWd1bGFyIGluc3RhbGxlciB0aGF0IGluY2x1ZGVzIGFsbCBuZWNlc3NhcnkgY29tcG9uZW50cy4gT24gTGludXgsIHdlIG9mZmVyIHBhY2thZ2VzIGluIG91ciByZXBvc2l0b3JpZXMgZm9yIG1hbnkgZGlzdHJpYnV0aW9ucywgc28gZm9yIGV4YW1wbGUgdXNlcnMgb24gVWJ1bnR1IGNhbiB1c2UgYXB0LWdldDsgYW5kIG9uIG1hY09TIHdlIHJlY29tbWVuZCBIb21lYnJldy4gQWRoZXJpbmcgdG8gcGxhdGZvcm0gY29udmVudGlvbnMgZ2l2ZXMgb3VyIHVzZXJzIGNvbmZpZGVuY2UgdGhhdCB0aGUgc29mdHdhcmUgaXMgdHJ1c3R3b3J0aHksIGFuZCBQeXRob24gcHJvdmlkZXMgdGhlIGZsZXhpYmlsaXR5IHRvIHByb3ZpZGUgaXQuPC9wPiA8aDI+RmVhdHVyZXMgb2YgdGhlIEF6dXJlIENMSTwvaDI+IDxwPlRoYW5rcyB0byB0aGUgZmxleGliaWxpdHkgb2YgUHl0aG9uIGFuZCB0aGUgcG93ZXJmdWwgZWNvc3lzdGVtIG9mIHBhY2thZ2VzLCB0aGUgQXp1cmUgQ0xJIHN1cHBvcnRzIGZlYXR1cmVzIHN1Y2ggYXMgYXV0b2NvbXBsZXRpb24gKGluIHNoZWxscyB0aGF0IHN1cHBvcnQgaXQpLCBwZXJzaXN0ZW50IGNyZWRlbnRpYWxzLCBKTUVTUGF0aCByZXN1bHQgcGFyc2luZywgbGF6eSBpbml0aWFsaXphdGlvbiwgbmV0d29yay1sZXNzIHVuaXQgdGVzdHMsIGFuZCBtb3JlLjwvcD4gPHA+TXVjaCBvZiB0aGlzIHN1cHBvcnQgaGFzIGJlZW4gYWJzdHJhY3RlZCBpbnRvIGFuIG9wZW4tc291cmNlIHBhY2thZ2UgY2FsbGVkIDxhID5LbmFjazwvYT4sIGFsbG93aW5nIHVzLCBvciBhbnlvbmUgZWxzZSwgdG8gdXNlIGl0IGZvciB0aGVpciBvd24gY29tbWFuZCBsaW5lIHRvb2xzLjwvcD4gPHA+U3BlY2lmaWMgdG8gdGhlIEF6dXJlIENMSSwgd2UgaGF2ZSBlbmFibGVkIGV4dGVuc2lvbnMgdGhhdCBjYW4gYmUgaW5zdGFsbGVkIHVzaW5nIHBpcCB0byBhbGxvdyB0aGUgZGV2ZWxvcG1lbnQgb2YgbW9yZSBjb21wbGV4IHRvb2xzLCBzdWNoIGFzIDxhID5zZWxmLWRlc3RydWN0IG1vZGU8L2E+LCB3aGljaCBhbGxvd3MgYW55IHJlc291cmNlIHRvIGJlIGF1dG9tYXRpY2FsbHkgZGVsZXRlZCBhZnRlciBhIGNlcnRhaW4gdGltZSB1c2luZyBhIHNpbXBsZSBjb21tYW5kIGxpbmUgYXJndW1lbnQuIEJlaW5nIGFibGUgdG8gaGF2ZSBhbiBlY29zeXN0ZW0gb2YgZXh0ZW5zaW9ucyBlbXBvd2VycyBvdXIgdXNlcnMgdG8gZGV2ZWxvcCB3b3JrZmxvd3MgdGhhdCBmaXQgdGhlaXIgcHJlZmVyZW5jZXMuPC9wPiA8cD5CZWNhdXNlIEF6dXJlIHN1cHBvcnRzIHNldmVyYWwgQVBJIHZlcnNpb25zIHNpbXVsdGFuZW91c2x5LCBhcyB3ZWxsIGFzIG9uLXByZW1pc2VzIEF6dXJlIFN0YWNrIGRlcGxveW1lbnRzLCB0aGUgQXp1cmUgQ0xJIGhhcyB0byBiZSBhYmxlIHRvIGFkYXB0IGl0cyBjb21tYW5kcyB0byB3aGF0ZXZlciB2ZXJzaW9uIGlzIGl0IGNvbm5lY3RlZCB0by4gVGhhbmtzIHRvIHRoZSBjb21wb3NhYmxlIGFyY2hpdGVjdHVyZSBvZiB0aGUgdG9vbCBpbiBQeXRob24sIHdlIGNhbiBlYXNpbHkgYWRkIG9yIHJlbW92ZSBjb21tYW5kcyBhdCBydW50aW1lIGJhc2VkIG9uIGF2YWlsYWJpbGl0eS4gVGhlIHJlc3VsdCBpcyB0aGF0IHVzZXJzIGFyZSBub3Qgc3VnZ2VzdGVkIHRvIHVzZSBpbnZhbGlkIGNvbW1hbmRzIG9yIGFyZ3VtZW50cyBhbmQgY2FuIGZyZWVseSB1cGRhdGUgdGhlIGNvbW1hbmQgbGluZSB0b29sIGV2ZW4gd2hlbiB3b3JraW5nIGFnYWluc3Qgb2xkZXIgZGVwbG95bWVudHMuPC9wPiA8aDI+Q29uY2x1c2lvbjwvaDI+IDxwPk1pY3Jvc29mdCBBenVyZSBwcm92aWRlcyBodW5kcmVkcyBvZiBzZXJ2aWNlcywgZWFjaCBwcm92aWRpbmcgbXVsdGlwbGUgY29tcGF0aWJpbGl0eSB2ZXJzaW9ucyBhbmQgbWFueSBjb21tYW5kcy4gRXhwb3NpbmcgdGhpcyBjb21wbGV4aXR5IHRocm91Z2ggYSBjb21tYW5kLWxpbmUgdG9vbCB0aGF0IGlzIHJlc3BvbnNpdmUsIGhlbHBmdWwsIGFuZCBlYXN5IHRvIHVzZSBpcyBhIGNoYWxsZW5nZS48L3A+IDxwPkRldmVsb3BpbmcgdGhlIEF6dXJlIENMSSBpbiBQeXRob24gZW5hYmxlZCB1cyB0byBhcmNoaXRlY3QgYSB0b29sIHRoYXQgbG9va3MgYW5kIGZlZWxzIG5hdGl2ZSBvbiBhbGwgcGxhdGZvcm1zLCBydW5zIGNvbnNpc3RlbnRseSBldmVyeXdoZXJlLCBwZXJmb3JtcyB3ZWxsIGVub3VnaCBmb3IgaW50ZXJhY3RpdmUgdXNlLCBzdXBwb3J0cyBwb3dlcmZ1bCBleHRlbnNpYmlsaXR5LCBhbmQgaGVscHMgb3VyIGN1c3RvbWVycyBiZSBzdWNjZXNzZnVsIG5vIG1hdHRlciB3aGF0IHRoZXkgaW50ZW5kIHRvIGFjaGlldmUuPC9wPiA8L2FydGljbGU+IDwvc2VjdGlvbj4gPC9kaXY+IDwvZGl2PiA8L2Rpdj4gPC9ib2R5Pg=='</script>

      </head>
        <body class="valid" valid="valid" title="valid: True, node: 1, level: 1" node_number="1"> <div class="valid" valid="valid" title="valid: True, node: 2, level: 2" node_number="2"> <div class="valid" valid="valid" title="valid: True, node: 3, level: 3" node_number="3"> <p class="valid" valid="valid" title="valid: True, node: 4, level: 4" node_number="4">Notice: While JavaScript is not essential for this website, your interaction with the content will be limited. Please turn JavaScript on for the full experience. </p> </div> <div class="valid" valid="valid" title="valid: True, node: 5, level: 3" node_number="5">  </div> <header class="valid" valid="valid" title="valid: True, node: 6, level: 3" node_number="6"> <div class="valid" valid="valid" title="valid: True, node: 7, level: 4" node_number="7"> <div class="valid" valid="valid" title="valid: True, node: 8, level: 5" node_number="8"> <a class="valid" valid="valid" title="valid: True, node: 9, level: 6" node_number="9">Donate</a> <div class="valid" valid="valid" title="valid: True, node: 10, level: 6" node_number="10"> <a class="valid" valid="valid" title="valid: True, node: 11, level: 7" node_number="11">&#8801; Menu</a><div class="valid" valid="valid" title="valid: True, node: 12, level: 7" node_number="12"> <ul class="valid" valid="valid" title="valid: True, node: 13, level: 8" node_number="13"> <li class="valid" valid="valid" title="valid: True, node: 14, level: 9" node_number="14"> <a class="valid" valid="valid" title="valid: True, node: 15, level: 10" node_number="15"><small class="valid" valid="valid" title="valid: True, node: 16, level: 11" node_number="16">A</small> A</a> <ul class="valid" valid="valid" title="valid: True, node: 17, level: 10" node_number="17"> <li class="valid" valid="valid" title="valid: True, node: 18, level: 11" node_number="18">Smaller</li> <li class="valid" valid="valid" title="valid: True, node: 19, level: 11" node_number="19"><a class="valid" valid="valid" title="valid: True, node: 20, level: 12" node_number="20">Larger</a></li> <li class="valid" valid="valid" title="valid: True, node: 21, level: 11" node_number="21"><a class="valid" valid="valid" title="valid: True, node: 22, level: 12" node_number="22">Reset</a></li> </ul> </li> </ul> </div><div class="valid" valid="valid" title="valid: True, node: 23, level: 7" node_number="23"> <ul class="valid" valid="valid" title="valid: True, node: 24, level: 8" node_number="24"> <li class="valid" valid="valid" title="valid: True, node: 25, level: 9" node_number="25"> <a class="valid" valid="valid" title="valid: True, node: 26, level: 10" node_number="26">Socialize</a> <ul class="valid" valid="valid" title="valid: True, node: 27, level: 10" node_number="27"> <li class="valid" valid="valid" title="valid: True, node: 28, level: 11" node_number="28"><a class="valid" valid="valid" title="valid: True, node: 29, level: 12" node_number="29">Facebook</a></li> <li class="valid" valid="valid" title="valid: True, node: 30, level: 11" node_number="30"><a class="valid" valid="valid" title="valid: True, node: 31, level: 12" node_number="31">Twitter</a></li> <li class="valid" valid="valid" title="valid: True, node: 32, level: 11" node_number="32"><a class="valid" valid="valid" title="valid: True, node: 33, level: 12" node_number="33">Chat on IRC</a></li> </ul> </li> </ul> </div> </div> </div>  </div> </header> <div class="valid" valid="valid" title="valid: True, node: 34, level: 3" node_number="34"> <div class="valid" valid="valid" title="valid: True, node: 35, level: 4" node_number="35"> <section class="valid" valid="valid" title="valid: True, node: 36, level: 5" node_number="36"> <article class="valid" valid="valid" title="valid: True, node: 37, level: 6" node_number="37"> <h1 class="valid" valid="valid" title="valid: True, node: 38, level: 7" node_number="38">Building an open-source and cross-platform Azure CLI with Python</h1> <p class="valid" valid="valid" title="valid: True, node: 39, level: 7" node_number="39"> Written by Dan Taylor, <a class="valid" valid="valid" title="valid: True, node: 40, level: 8" node_number="40">Microsoft</a> </p> <h2 class="valid" valid="valid" title="valid: True, node: 41, level: 7" node_number="41">Background</h2> <p class="valid" valid="valid" title="valid: True, node: 42, level: 7" node_number="42"><a class="valid" valid="valid" title="valid: True, node: 43, level: 8" node_number="43">Microsoft Azure</a> is a cloud computing platform that spans over fifty data centers worldwide and offers hundreds of services. As a large cloud service, it is very important that customers have the best tools for deployment and management of their systems.</p> <p class="valid" valid="valid" title="valid: True, node: 44, level: 7" node_number="44">Since the very beginning, we&#8217;ve offered a variety of tools and libraries for developers, administrators and architects to perform all kind of actions: from spinning up Virtual Machines in virtual networks to deploying Web Apps with PostgreSQL databases. One of the most popular tools of course is the <a class="valid" valid="valid" title="valid: True, node: 45, level: 8" node_number="45">Azure &#8220;az&#8221; command line interface</a>. To build this open source tool, which includes thousands of commands as well as third-party extensions, we turned to Python.</p> <h2 class="valid" valid="valid" title="valid: True, node: 46, level: 7" node_number="46">Why Python</h2> <p class="valid" valid="valid" title="valid: True, node: 47, level: 7" node_number="47">At the beginning, the Azure command line experience was available as a PowerShell module for Windows users, and as a Node.js-based CLI for everyone else, including users working with macOS and Linux. However, significant growth led to engineering complexity that became difficult to resolve.</p> <p class="valid" valid="valid" title="valid: True, node: 48, level: 7" node_number="48">Switching to Python enabled us to produce one implementation that behaves the same across all platforms. Each command is a wrapper around one or more functions from the <a class="valid" valid="valid" title="valid: True, node: 49, level: 8" node_number="49">Azure SDK for Python</a>, which ensures that developers can build scripts with identical functionality. And consistent command line conventions enable us to provide one set of instructions for all users.</p> <p class="valid" valid="valid" title="valid: True, node: 50, level: 7" node_number="50">Because Python is easy to distribute for all our platforms, we can provide platform-specific packages that adhere to the correct conventions. On Windows, you can use a regular installer that includes all necessary components. On Linux, we offer packages in our repositories for many distributions, so for example users on Ubuntu can use apt-get; and on macOS we recommend Homebrew. Adhering to platform conventions gives our users confidence that the software is trustworthy, and Python provides the flexibility to provide it.</p> <h2 class="valid" valid="valid" title="valid: True, node: 51, level: 7" node_number="51">Features of the Azure CLI</h2> <p class="valid" valid="valid" title="valid: True, node: 52, level: 7" node_number="52">Thanks to the flexibility of Python and the powerful ecosystem of packages, the Azure CLI supports features such as autocompletion (in shells that support it), persistent credentials, JMESPath result parsing, lazy initialization, network-less unit tests, and more.</p> <p class="valid" valid="valid" title="valid: True, node: 53, level: 7" node_number="53">Much of this support has been abstracted into an open-source package called <a class="valid" valid="valid" title="valid: True, node: 54, level: 8" node_number="54">Knack</a>, allowing us, or anyone else, to use it for their own command line tools.</p> <p class="valid" valid="valid" title="valid: True, node: 55, level: 7" node_number="55">Specific to the Azure CLI, we have enabled extensions that can be installed using pip to allow the development of more complex tools, such as <a class="valid" valid="valid" title="valid: True, node: 56, level: 8" node_number="56">self-destruct mode</a>, which allows any resource to be automatically deleted after a certain time using a simple command line argument. Being able to have an ecosystem of extensions empowers our users to develop workflows that fit their preferences.</p> <p class="valid" valid="valid" title="valid: True, node: 57, level: 7" node_number="57">Because Azure supports several API versions simultaneously, as well as on-premises Azure Stack deployments, the Azure CLI has to be able to adapt its commands to whatever version is it connected to. Thanks to the composable architecture of the tool in Python, we can easily add or remove commands at runtime based on availability. The result is that users are not suggested to use invalid commands or arguments and can freely update the command line tool even when working against older deployments.</p> <h2 class="valid" valid="valid" title="valid: True, node: 58, level: 7" node_number="58">Conclusion</h2> <p class="valid" valid="valid" title="valid: True, node: 59, level: 7" node_number="59">Microsoft Azure provides hundreds of services, each providing multiple compatibility versions and many commands. Exposing this complexity through a command-line tool that is responsive, helpful, and easy to use is a challenge.</p> <p class="valid" valid="valid" title="valid: True, node: 60, level: 7" node_number="60">Developing the Azure CLI in Python enabled us to architect a tool that looks and feels native on all platforms, runs consistently everywhere, performs well enough for interactive use, supports powerful extensibility, and helps our customers be successful no matter what they intend to achieve.</p> </article> </section> </div> </div> </div> </body>
        <style tyle='text/css'>
body{
    position: relative;
    padding-left: 30px;
    top: 60px;
}
* {
    border: 1px solid #eee;
    padding: 5px 12px;
    margin: 3px 0;
    box-sizing: content-box;
    background-color: #fff;
    cursor: no-drop;
}
main:hover > *, section:hover > *, header:hover > *, nav:hover > *, a:hover > *, div:hover > *, p:hover > *, ul:hover > *, h1:hover > *, h2:hover > *, h3:hover > *, li:hover > *, span:hover > *{
    border: 2px solid green;
    background-color: #fffeee;
    padding: 5px 23px !important;
    margin: 1px 0;
    color: green;
}
main:hover, section:hover, header:hover, nav:hover, a:hover, div:hover, p:hover, ul:hover, h1:hover, h2:hover, h3:hover, li:hover, span:hover{
    border: 1px solid #fff;
    background-color: #eee;
}
a, span {
    display: block;
}
.selected {
    border: 2px solid orchid !important;
    opacity: 0.8;
    color: orchid !important;
}
.selected * {
    padding: 2px !important;
    color: orchid !important;
}
.valid {
  cursor: pointer;
}
.btn{
  cursor: pointer;
  font-weight: bolder;
  padding: 8px;
}
</style> 
        <script>function OpenOriginalLink($event){
    $event.stopPropagation();
    console.log(url);
}

function removeItem($event){
    $event.stopPropagation();
    console.log('Remove item: ', url)
    localStorage.removeItem(url)
}

function exportData($event){
    $event.stopPropagation();

    result = []
    for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        result.push(localStorage.getItem(key))
    }
    const _url = URL.createObjectURL(new Blob([result.join("\n")], {type: 'text/plain'}))
    $event.target.href = _url;
    localStorage.clear()
}

var removeItemBtn = document.createElement("BUTTON");   // Create a <button> element
removeItemBtn.innerHTML = "Remove Item";
removeItemBtn.classList.add('btn');
removeItemBtn.style.position = "fixed";
removeItemBtn.style.left = '5px';
removeItemBtn.style.top = 0;
removeItemBtn.style.border = "1px solid";
removeItemBtn.style.boxShadow = "3px 3px #888";
removeItemBtn.onclick = removeItem;
document.body.appendChild(removeItemBtn);

var goToOriginLink = document.createElement("A");   // Create a <button> element
goToOriginLink.innerHTML = "GoToOrigin";
goToOriginLink.classList.add('btn');
goToOriginLink.style.position = "fixed"
goToOriginLink.style.left = '115px'
goToOriginLink.style.top = 0;
goToOriginLink.onclick = OpenOriginalLink;
goToOriginLink.setAttribute('href', decodeURIComponent(url));
goToOriginLink.target = '_blank';
document.body.appendChild(goToOriginLink);

var current = new Date
var exportDataLink = document.createElement("A");   // Create a <button> element
exportDataLink.innerHTML = "Export data";
exportDataLink.classList.add('btn');
exportDataLink.download = current.toISOString() + '.exported.txt';
exportDataLink.style.position = "fixed";
exportDataLink.style.right = '5px';
exportDataLink.style.top = 0;
exportDataLink.style.border = "1px solid #888";
exportDataLink.style.boxShadow = "3px 3px #888";
exportDataLink.onclick = exportData;
document.body.appendChild(exportDataLink);

data = {
    'title': null ,
    'article': null
}

var body = document.getElementsByTagName("body")[0];

body.onclick = function($e){
    var num = $e.target.getAttribute('node_number')
    var valid = $e.target.getAttribute('valid')

    if(!valid){
        console.log("Element is invalid")
        return
    }

    if(data.length > 2){
        data = data.splice(0, 2)
    }

    console.log("node:", $e.target)

    if(!data.title && !data.article){
        data.title = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else if (data.title && !data.article){
        data.article = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else{
        selected = Array.from(document.getElementsByClassName("selected"))
        selected.forEach(function(el){
            el.classList.remove('selected')
        })

        data.title = num;
        data.article = null;
        $e.target.classList.add('selected')

    }

    if(data.title && data.article){
        var obj = {
            url: url,
            text: body_html,
            title: data.title,
            article: data.article,
        }

        var datasetItem = JSON.stringify(obj)
        localStorage.setItem(url, datasetItem)
    }
}
</script> 
      </html>