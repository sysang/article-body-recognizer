<!DOCTYPE html>
<html>
<head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

        <script> var url = encodeURIComponent('https://www.freebsd.org/security/advisories/FreeBSD-SA-21:15.libfetch.asc');</script>

        <script> var body_html = 'PGJvZHk+PHA+LS0tLS1CRUdJTiBQR1AgU0lHTkVEIE1FU1NBR0UtLS0tLSBIYXNoOiBTSEE1MTIgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gRnJlZUJTRC1TQS0yMToxNS5saWJmZXRjaCBTZWN1cml0eSBBZHZpc29yeSBUaGUgRnJlZUJTRCBQcm9qZWN0IFRvcGljOmxpYmZldGNoIG91dCBvZiBib3VuZHMgcmVhZCBDYXRlZ29yeTogY29yZSBNb2R1bGU6IGxpYmZldGNoIEFubm91bmNlZDogMjAyMS0wOC0yNCBDcmVkaXRzOlNhbWFudGEgTmF2YXJybyBBZmZlY3RzOiBBbGwgc3VwcG9ydGVkIHZlcnNpb25zIG9mIEZyZWVCU0QuIENvcnJlY3RlZDogMjAyMS0wOC0yNCAxNzo1OTo0MyBVVEMgKHN0YWJsZS8xMywgMTMuMC1TVEFCTEUpIDIwMjEtMDgtMjQgMTg6MDA6NDcgVVRDIChyZWxlbmcvMTMuMCwgMTMuMC1SRUxFQVNFLXA0KSAyMDIxLTA4LTI0IDE4OjMwOjE2IFVUQyAoc3RhYmxlLzEyLCAxMi4yLVNUQUJMRSkgMjAyMS0wOC0yNCAxODozMjoxNyBVVEMgKHJlbGVuZy8xMi4yLCAxMi4yLVJFTEVBU0UtcDEwKSAyMDIxLTA4LTI0IDE4OjI5OjQwIFVUQyAoc3RhYmxlLzExLCAxMS40LVNUQUJMRSkgMjAyMS0wOC0yNCAxODozMTozMSBVVEMgKHJlbGVuZy8xMS40LCAxMS40LVJFTEVBU0UtcDEzKSBDVkUgTmFtZTogQ1ZFLTIwMjEtMzYxNTkgRm9yIGdlbmVyYWwgaW5mb3JtYXRpb24gcmVnYXJkaW5nIEZyZWVCU0QgU2VjdXJpdHkgQWR2aXNvcmllcywgaW5jbHVkaW5nIGRlc2NyaXB0aW9ucyBvZiB0aGUgZmllbGRzIGFib3ZlLCBzZWN1cml0eSBicmFuY2hlcywgYW5kIHRoZSBmb2xsb3dpbmcgc2VjdGlvbnMsIHBsZWFzZSB2aXNpdCA8aHR0cHM6PjwvaHR0cHM6Pi4gSS4gQmFja2dyb3VuZCBsaWJmZXRjaCgzKSBpcyBhIG11bHRpLXByb3RvY29sIGZpbGUgdHJhbnNmZXIgbGlicmFyeSBpbmNsdWRlZCB3aXRoIEZyZWVCU0QgYW5kIHVzZWQgYnkgdGhlIGZldGNoKDEpIGNvbW1hbmQtbGluZSB0b29sLCBwa2coOCkgcGFja2FnZSBtYW5hZ2VyLCBhbmQgb3RoZXJzLiBJSS4gUHJvYmxlbSBEZXNjcmlwdGlvbiBUaGUgcGFzc2l2ZSBtb2RlIGluIEZUUCBjb21tdW5pY2F0aW9uIGFsbG93cyBhbiBvdXQgb2YgYm91bmRhcnkgcmVhZCB3aGlsZSBsaWJmZXRjaCB1c2VzIHN0cnRvbCB0byBwYXJzZSB0aGUgcmVsZXZhbnQgbnVtYmVycyBpbnRvIGFkZHJlc3MgYnl0ZXMuIEl0IGRvZXMgbm90IGNoZWNrIGlmIHRoZSBsaW5lIGVuZHMgcHJlbWF0dXJlbHkuIElmIGl0IGRvZXMsIHRoZSBmb3ItbG9vcCBjb25kaXRpb24gY2hlY2tzIGZvciAqcCA9PSAnXDAnIG9uZSBieXRlIHRvbyBsYXRlIGJlY2F1c2UgcCsrIHdhcyBhbHJlYWR5IHBlcmZvcm1lZC4gSUlJLiBJbXBhY3QgVGhlIGNvbm5lY3Rpb24gYnVmZmVyIHNpemUgY2FuIGJlIGNvbnRyb2xsZWQgYnkgYSBtYWxpY2lvdXMgRlRQIHNlcnZlciBiZWNhdXNlIHRoZSBzaXplIGlzIGluY3JlYXNlZCB1bnRpbCBhIG5ld2xpbmUgaXMgZW5jb3VudGVyZWQgKG9yIG5vIG1vcmUgY2hhcmFjdGVycyBhcmUgcmVhZCkuIFRoaXMgYWxzbyBhbGxvd3MgdG8gbW92ZSB0aGUgYnVmZmVyIGludG8gbW9yZSBpbnRlcmVzdGluZyBhcmVhcyB3aXRoaW4gdGhlIGFkZHJlc3Mgc3BhY2UsIHBvdGVudGlhbGx5IHBhcnNpbmcgcmVsZXZhbnQgbnVtYmVycyBmb3IgdGhlIGF0dGFja2VyLiBTaW5jZSB0aGVzZSBieXRlcyBiZWNvbWUgYXZhaWxhYmxlIHRvIHRoZSBzZXJ2ZXIgaW4gZm9ybSBvZiBhIG5ldyBUQ1AgY29ubmVjdGlvbiB0byBhIGNvbnN0cnVjdGVkIHBvcnQgbnVtYmVyIG9yIGV2ZW4gcGFydCBvZiB0aGUgSVB2NiBhZGRyZXNzIHRoaXMgaXMgYSBwb3RlbnRpYWwgaW5mb3JtYXRpb24gbGVhay4gSVYuIFdvcmthcm91bmQgTm8gd29ya2Fyb3VuZCBpcyBhdmFpbGFibGUuIFYuIFNvbHV0aW9uIFVwZ3JhZGUgeW91ciB2dWxuZXJhYmxlIHN5c3RlbSB0byBhIHN1cHBvcnRlZCBGcmVlQlNEIHN0YWJsZSBvciByZWxlYXNlIC8gc2VjdXJpdHkgYnJhbmNoIChyZWxlbmcpIGRhdGVkIGFmdGVyIHRoZSBjb3JyZWN0aW9uIGRhdGUuIFBlcmZvcm0gb25lIG9mIHRoZSBmb2xsb3dpbmc6IDEpIFRvIHVwZGF0ZSB5b3VyIHZ1bG5lcmFibGUgc3lzdGVtIHZpYSBhIGJpbmFyeSBwYXRjaDogU3lzdGVtcyBydW5uaW5nIGEgUkVMRUFTRSB2ZXJzaW9uIG9mIEZyZWVCU0Qgb24gdGhlIGFtZDY0LCBpMzg2LCBvciAob24gRnJlZUJTRCAxMyBhbmQgbGF0ZXIpIGFybTY0IHBsYXRmb3JtcyBjYW4gYmUgdXBkYXRlZCB2aWEgdGhlIGZyZWVic2QtdXBkYXRlKDgpIHV0aWxpdHk6ICMgZnJlZWJzZC11cGRhdGUgZmV0Y2ggIyBmcmVlYnNkLXVwZGF0ZSBpbnN0YWxsIDIpIFRvIHVwZGF0ZSB5b3VyIHZ1bG5lcmFibGUgc3lzdGVtIHZpYSBhIHNvdXJjZSBjb2RlIHBhdGNoOiBUaGUgZm9sbG93aW5nIHBhdGNoZXMgaGF2ZSBiZWVuIHZlcmlmaWVkIHRvIGFwcGx5IHRvIHRoZSBhcHBsaWNhYmxlIEZyZWVCU0QgcmVsZWFzZSBicmFuY2hlcy4gYSkgRG93bmxvYWQgdGhlIHJlbGV2YW50IHBhdGNoIGZyb20gdGhlIGxvY2F0aW9uIGJlbG93LCBhbmQgdmVyaWZ5IHRoZSBkZXRhY2hlZCBQR1Agc2lnbmF0dXJlIHVzaW5nIHlvdXIgUEdQIHV0aWxpdHkuICMgZmV0Y2ggaHR0cHM6Ly9zZWN1cml0eS5GcmVlQlNELm9yZy9wYXRjaGVzL1NBLTIxOjE1L2xpYmZldGNoLnBhdGNoICMgZmV0Y2ggaHR0cHM6Ly9zZWN1cml0eS5GcmVlQlNELm9yZy9wYXRjaGVzL1NBLTIxOjE1L2xpYmZldGNoLnBhdGNoLmFzYyAjIGdwZyAtLXZlcmlmeSBsaWJmZXRjaC5wYXRjaC5hc2MgYikgQXBwbHkgdGhlIHBhdGNoLiBFeGVjdXRlIHRoZSBmb2xsb3dpbmcgY29tbWFuZHMgYXMgcm9vdDogIyBjZCAvdXNyL3NyYyAjIHBhdGNoICZsdDsgL3BhdGgvdG8vcGF0Y2ggYykgUmVjb21waWxlIHRoZSBvcGVyYXRpbmcgc3lzdGVtIHVzaW5nIGJ1aWxkd29ybGQgYW5kIGluc3RhbGx3b3JsZCBhcyBkZXNjcmliZWQgaW4gPGh0dHBzOj4uIFZJLiBDb3JyZWN0aW9uIGRldGFpbHMgVGhpcyBpc3N1ZSBpcyBjb3JyZWN0ZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgR2l0IGNvbW1pdCBoYXNoIG9yIFN1YnZlcnNpb24gcmV2aXNpb24gbnVtYmVyIGluIHRoZSBmb2xsb3dpbmcgc3RhYmxlIGFuZCByZWxlYXNlIGJyYW5jaGVzOiBCcmFuY2gvcGF0aCBIYXNoIFJldmlzaW9uIC0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBzdGFibGUvMTMvIGE3NTMyNGQ2NzRmNSBzdGFibGUvMTMtbjI0NjkzOSByZWxlbmcvMTMuMC8gMDYwNTEwYmE4YmZiIHJlbGVuZy8xMy4wLW4yNDQ3NTggc3RhYmxlLzEyLyByMzcwMzg0IHJlbGVuZy8xMi4yLyByMzcwMzk1IHN0YWJsZS8xMS8gcjM3MDM4MiByZWxlbmcvMTEuNC8gcjM3MDM4OCAtIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0gRm9yIEZyZWVCU0QgMTMgYW5kIGxhdGVyOiBSdW4gdGhlIGZvbGxvd2luZyBjb21tYW5kIHRvIHNlZSB3aGljaCBmaWxlcyB3ZXJlIG1vZGlmaWVkIGJ5IGEgcGFydGljdWxhciBjb21taXQ6ICMgZ2l0IHNob3cgLS1zdGF0IDxjb21taXQgPiBPciB2aXNpdCB0aGUgZm9sbG93aW5nIFVSTCwgcmVwbGFjaW5nIE5OTk5OTiB3aXRoIHRoZSBoYXNoOiA8aHR0cHM6PiBUbyBkZXRlcm1pbmUgdGhlIGNvbW1pdCBjb3VudCBpbiBhIHdvcmtpbmcgdHJlZSAoZm9yIGNvbXBhcmlzb24gYWdhaW5zdCBuTk5OTk5OIGluIHRoZSB0YWJsZSBhYm92ZSksIHJ1bjogIyBnaXQgcmV2LWxpc3QgLS1jb3VudCAtLWZpcnN0LXBhcmVudCBIRUFEIEZvciBGcmVlQlNEIDEyIGFuZCBlYXJsaWVyOiBSdW4gdGhlIGZvbGxvd2luZyBjb21tYW5kIHRvIHNlZSB3aGljaCBmaWxlcyB3ZXJlIG1vZGlmaWVkIGJ5IGEgcGFydGljdWxhciByZXZpc2lvbiwgcmVwbGFjaW5nIE5OTk5OTiB3aXRoIHRoZSByZXZpc2lvbiBudW1iZXI6ICMgc3ZuIGRpZmYgLWNOTk5OTk4gLS1zdW1tYXJpemUgc3ZuOi8vc3ZuLmZyZWVic2Qub3JnL2Jhc2UgT3IgdmlzaXQgdGhlIGZvbGxvd2luZyBVUkwsIHJlcGxhY2luZyBOTk5OTk4gd2l0aCB0aGUgcmV2aXNpb24gbnVtYmVyOiA8aHR0cHM6PiBWSUkuIFJlZmVyZW5jZXMgPGh0dHBzOj4gPGh0dHBzOj4gPGh0dHBzOj4gVGhlIGxhdGVzdCByZXZpc2lvbiBvZiB0aGlzIGFkdmlzb3J5IGlzIGF2YWlsYWJsZSBhdCA8aHR0cHM6PiAtLS0tLUJFR0lOIFBHUCBTSUdOQVRVUkUtLS0tLSBpUUl6QkFFQkNnQWRGaUVFL0E2SGl1V3Y1NGdDaldOVjA1ZVM5SjZuNWNJRkFtRWxWMTRBQ2drUTA1ZVM5SjZuIDVjSnBWQkFBcEJSQkt3eFRwbUxmSCtKSlA4SndEd3BvcDQwNy9BNTR1UEZSWHpsN3JpNkQwd2x2bEhnTWI3MFQgT1BuRDJwY28zZ0k1NkdPdlJMaXBuYnRya0daSlQwaWpzWEhNcU1LKzNPNDR5b01QOEJNTk9aYXVQVVZpYTZGVyA2UDBhTFhxamlKRFlaOE4yaytNbm5zWFFGSkt2RnQvVnYwRDdhSE9VZXR0Zmd5eDVZSVFYMnVyakIvaEdaSWZNIDkzVk1SQ3NMcnVpeElSZ3NMNkp0MlB2UzAwNEh4cUpPc2FOTWc2dW5wMEpXYS92cmNDY3I0QU16Sm11K2swbGcgL1h0VXBOQldkQ2xLU1l2REZpa05yQ3o5eDhhZTZWOXdvc3o1Z2ZlS0wrMXRjdEJNeGhyTUx3QkVhV3RCN1lJYyA0VnU5K1pzR1JMQnBhcEVFOGFMUnlBcFkxeEZQMHhjRHV0ZjFHL3R1dXo1eks4Z09iYVRyeFRjUm02ZmJ5ZjhDIGVqc3BQYWJnTTNsZ0tyV2pHaUkwVDNXellQV0pLVFpxdEdFQXR5TUF1dGpwdjkrTi9wMFlFRHNDV2t2Ry96bHQgQlorVGJUMzNvTDJOMW9kekxCTk9sSmtpUjJMUW5UY2pCZ2NpK2pxQ1Z4N0NkblltVjJsYUdGMWtJdHRCQ2NSTiBUT0pvT0oxcGJLMVVYcWVrNzcrY0NTZVRLcmxvY1U2b0gzKzFXNjhvTGVXdGVtdnpDVHhseExzVC9wVS9UZXRDIDJmaWJWeU45UDFQTUkwVmJha3RqU044SFg4UVd0cjF1NWtwMkFJWlBtcTVScUwrUzcrbzkwR1ZGcjVmNDFEN00gUWpIR2RkTytERzc3bEd5ZCtLQzd6TXVHNnA4T2NEQmtkeTlUYzBhVFZXNEpQaG5JZXlBPSA9UU4zUiAtLS0tLUVORCBQR1AgU0lHTkFUVVJFLS0tLS08L2h0dHBzOj48L2h0dHBzOj48L2h0dHBzOj48L2h0dHBzOj48L2h0dHBzOj48L2h0dHBzOj48L2NvbW1pdD48L2h0dHBzOj48L3A+PC9ib2R5Pg=='</script>

      </head>
        <body class="valid" valid="valid" title="valid: True, node: 1, tag: body, level: 1" node_number="1"><p class="valid" valid="valid" title="valid: True, node: 2, tag: p, level: 2" node_number="2">-----BEGIN PGP SIGNED MESSAGE----- Hash: SHA512 ============================================================================= FreeBSD-SA-21:15.libfetch Security Advisory The FreeBSD Project Topic:libfetch out of bounds read Category: core Module: libfetch Announced: 2021-08-24 Credits:Samanta Navarro Affects: All supported versions of FreeBSD. Corrected: 2021-08-24 17:59:43 UTC (stable/13, 13.0-STABLE) 2021-08-24 18:00:47 UTC (releng/13.0, 13.0-RELEASE-p4) 2021-08-24 18:30:16 UTC (stable/12, 12.2-STABLE) 2021-08-24 18:32:17 UTC (releng/12.2, 12.2-RELEASE-p10) 2021-08-24 18:29:40 UTC (stable/11, 11.4-STABLE) 2021-08-24 18:31:31 UTC (releng/11.4, 11.4-RELEASE-p13) CVE Name: CVE-2021-36159 For general information regarding FreeBSD Security Advisories, including descriptions of the fields above, security branches, and the following sections, please visit <https: class="valid" valid="valid" title="valid: True, node: 3, tag: https:, level: 3" node_number="3"/>. I. Background libfetch(3) is a multi-protocol file transfer library included with FreeBSD and used by the fetch(1) command-line tool, pkg(8) package manager, and others. II. Problem Description The passive mode in FTP communication allows an out of boundary read while libfetch uses strtol to parse the relevant numbers into address bytes. It does not check if the line ends prematurely. If it does, the for-loop condition checks for *p == '\0' one byte too late because p++ was already performed. III. Impact The connection buffer size can be controlled by a malicious FTP server because the size is increased until a newline is encountered (or no more characters are read). This also allows to move the buffer into more interesting areas within the address space, potentially parsing relevant numbers for the attacker. Since these bytes become available to the server in form of a new TCP connection to a constructed port number or even part of the IPv6 address this is a potential information leak. IV. Workaround No workaround is available. V. Solution Upgrade your vulnerable system to a supported FreeBSD stable or release / security branch (releng) dated after the correction date. Perform one of the following: 1) To update your vulnerable system via a binary patch: Systems running a RELEASE version of FreeBSD on the amd64, i386, or (on FreeBSD 13 and later) arm64 platforms can be updated via the freebsd-update(8) utility: # freebsd-update fetch # freebsd-update install 2) To update your vulnerable system via a source code patch: The following patches have been verified to apply to the applicable FreeBSD release branches. a) Download the relevant patch from the location below, and verify the detached PGP signature using your PGP utility. # fetch https://security.FreeBSD.org/patches/SA-21:15/libfetch.patch # fetch https://security.FreeBSD.org/patches/SA-21:15/libfetch.patch.asc # gpg --verify libfetch.patch.asc b) Apply the patch. Execute the following commands as root: # cd /usr/src # patch &lt; /path/to/patch c) Recompile the operating system using buildworld and installworld as described in <https: class="valid" valid="valid" title="valid: True, node: 4, tag: https:, level: 3" node_number="4">. VI. Correction details This issue is corrected by the corresponding Git commit hash or Subversion revision number in the following stable and release branches: Branch/path Hash Revision - ------------------------------------------------------------------------- stable/13/ a75324d674f5 stable/13-n246939 releng/13.0/ 060510ba8bfb releng/13.0-n244758 stable/12/ r370384 releng/12.2/ r370395 stable/11/ r370382 releng/11.4/ r370388 - ------------------------------------------------------------------------- For FreeBSD 13 and later: Run the following command to see which files were modified by a particular commit: # git show --stat <commit class="valid" valid="valid" title="valid: True, node: 5, tag: commit, level: 4" node_number="5"> Or visit the following URL, replacing NNNNNN with the hash: <https: class="valid" valid="valid" title="valid: True, node: 6, tag: https:, level: 5" node_number="6"> To determine the commit count in a working tree (for comparison against nNNNNNN in the table above), run: # git rev-list --count --first-parent HEAD For FreeBSD 12 and earlier: Run the following command to see which files were modified by a particular revision, replacing NNNNNN with the revision number: # svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base Or visit the following URL, replacing NNNNNN with the revision number: <https: class="valid" valid="valid" title="valid: True, node: 7, tag: https:, level: 6" node_number="7"> VII. References <https: class="valid" valid="valid" title="valid: True, node: 8, tag: https:, level: 7" node_number="8"> <https: class="valid" valid="valid" title="valid: True, node: 9, tag: https:, level: 8" node_number="9"> <https: class="valid" valid="valid" title="valid: True, node: 10, tag: https:, level: 9" node_number="10"> The latest revision of this advisory is available at <https: class="valid" valid="valid" title="valid: True, node: 11, tag: https:, level: 10" node_number="11"> -----BEGIN PGP SIGNATURE----- iQIzBAEBCgAdFiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAmElV14ACgkQ05eS9J6n 5cJpVBAApBRBKwxTpmLfH+JJP8JwDwpop407/A54uPFRXzl7ri6D0wlvlHgMb70T OPnD2pco3gI56GOvRLipnbtrkGZJT0ijsXHMqMK+3O44yoMP8BMNOZauPUVia6FW 6P0aLXqjiJDYZ8N2k+MnnsXQFJKvFt/Vv0D7aHOUettfgyx5YIQX2urjB/hGZIfM 93VMRCsLruixIRgsL6Jt2PvS004HxqJOsaNMg6unp0JWa/vrcCcr4AMzJmu+k0lg /XtUpNBWdClKSYvDFikNrCz9x8ae6V9wosz5gfeKL+1tctBMxhrMLwBEaWtB7YIc 4Vu9+ZsGRLBpapEE8aLRyApY1xFP0xcDutf1G/tuuz5zK8gObaTrxTcRm6fbyf8C ejspPabgM3lgKrWjGiI0T3WzYPWJKTZqtGEAtyMAutjpv9+N/p0YEDsCWkvG/zlt BZ+TbT33oL2N1odzLBNOlJkiR2LQnTcjBgci+jqCVx7CdnYmV2laGF1kIttBCcRN TOJoOJ1pbK1UXqek77+cCSeTKrlocU6oH3+1W68oLeWtemvzCTxlxLsT/pU/TetC 2fibVyN9P1PMI0VbaktjSN8HX8QWtr1u5kp2AIZPmq5RqL+S7+o90GVFr5f41D7M QjHGddO+DG77lGyd+KC7zMuG6p8OcDBkdy9Tc0aTVW4JPhnIeyA= =QN3R -----END PGP SIGNATURE-----</https:></https:></https:></https:></https:></https:></commit></https:></p></body>
        <style tyle='text/css'>
body{
    position: relative;
    padding-left: 30px;
    top: 60px;
}
* {
    border: 1px solid #eee;
    padding: 5px 12px;
    margin: 3px 0;
    box-sizing: content-box;
    background-color: #fff;
    cursor: no-drop;
}
main:hover > *, section:hover > *, header:hover > *, nav:hover > *, a:hover > *, div:hover > *, p:hover > *, ul:hover > *, h1:hover > *, h2:hover > *, h3:hover > *, li:hover > *, span:hover > *{
    border: 2px solid green;
    background-color: #fffeee;
    padding: 5px 23px !important;
    margin: 1px 0;
    color: green;
}
main:hover, section:hover, header:hover, nav:hover, a:hover, div:hover, p:hover, ul:hover, h1:hover, h2:hover, h3:hover, li:hover, span:hover{
    border: 1px solid #fff;
    background-color: #eee;
}
a, span {
    display: block;
}
.selected {
    border: 2px solid orchid !important;
    opacity: 0.8;
    color: orchid !important;
}
.selected * {
    padding: 2px !important;
    color: orchid !important;
}
.valid {
  cursor: pointer;
}
.btn{
  cursor: pointer;
  font-weight: bolder;
  padding: 8px;
}
</style> 
        <script>function OpenOriginalLink($event){
    $event.stopPropagation();
    console.log(url);
}

function removeItem($event){
    $event.stopPropagation();
    console.log('Remove item: ', url)
    localStorage.removeItem(url)
}

function exportData($event){
    $event.stopPropagation();

    result = []
    for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        result.push(localStorage.getItem(key))
    }
    const _url = URL.createObjectURL(new Blob([result.join("\n")], {type: 'text/plain'}))
    $event.target.href = _url;
    localStorage.clear()
}

var removeItemBtn = document.createElement("BUTTON");   // Create a <button> element
removeItemBtn.innerHTML = "Remove Item";
removeItemBtn.classList.add('btn');
removeItemBtn.style.position = "fixed";
removeItemBtn.style.left = '5px';
removeItemBtn.style.top = 0;
removeItemBtn.style.border = "1px solid";
removeItemBtn.style.boxShadow = "3px 3px #888";
removeItemBtn.onclick = removeItem;
document.body.appendChild(removeItemBtn);

var goToOriginLink = document.createElement("A");   // Create a <button> element
goToOriginLink.innerHTML = "GoToOrigin";
goToOriginLink.classList.add('btn');
goToOriginLink.style.position = "fixed"
goToOriginLink.style.left = '115px'
goToOriginLink.style.top = 0;
goToOriginLink.onclick = OpenOriginalLink;
goToOriginLink.setAttribute('href', decodeURIComponent(url));
goToOriginLink.target = '_blank';
document.body.appendChild(goToOriginLink);

var current = new Date
var exportDataLink = document.createElement("A");   // Create a <button> element
exportDataLink.innerHTML = "Export data";
exportDataLink.classList.add('btn');
exportDataLink.download = current.toISOString() + '.exported.txt';
exportDataLink.style.position = "fixed";
exportDataLink.style.right = '5px';
exportDataLink.style.top = 0;
exportDataLink.style.border = "1px solid #888";
exportDataLink.style.boxShadow = "3px 3px #888";
exportDataLink.onclick = exportData;
document.body.appendChild(exportDataLink);

data = {
    'title': null ,
    'article': null
}

var body = document.getElementsByTagName("body")[0];

body.onclick = function($e){
    var num = $e.target.getAttribute('node_number')
    var valid = $e.target.getAttribute('valid')

    if(!valid){
        console.log("Element is invalid")
        return
    }

    if(data.length > 2){
        data = data.splice(0, 2)
    }

    console.log("node:", $e.target)

    if(!data.title && !data.article){
        data.title = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else if (data.title && !data.article){
        data.article = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else{
        selected = Array.from(document.getElementsByClassName("selected"))
        selected.forEach(function(el){
            el.classList.remove('selected')
        })

        data.title = num;
        data.article = null;
        $e.target.classList.add('selected')

    }

    if(data.title && data.article){
        var obj = {
            url: url,
            text: body_html,
            title: data.title,
            article: data.article,
        }

        var datasetItem = JSON.stringify(obj)
        localStorage.setItem(url, datasetItem)
    }
}
</script> 
      </html>