<!DOCTYPE html>
<html>
<head>

      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">

        <script> var url = encodeURIComponent('https://www.freebsd.org/security/advisories/FreeBSD-SA-21:16.openssl.asc');</script>

        <script> var body_html = 'PGJvZHk+PHA+LS0tLS1CRUdJTiBQR1AgU0lHTkVEIE1FU1NBR0UtLS0tLSBIYXNoOiBTSEE1MTIgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0gRnJlZUJTRC1TQS0yMToxNi5vcGVuc3NsIFNlY3VyaXR5IEFkdmlzb3J5IFRoZSBGcmVlQlNEIFByb2plY3QgVG9waWM6IE11bHRpcGxlIE9wZW5TU0wgdnVsbmVyYWJpbGl0aWVzIENhdGVnb3J5OiBjb250cmliIE1vZHVsZTogb3BlbnNzbCBBbm5vdW5jZWQ6IDIwMjEtMDgtMjQgQ3JlZGl0czogU2VlIE9wZW5TU0wgYWR2aXNvcnkgaW4gcmVmZXJlbmNlcy4gQWZmZWN0czogRnJlZUJTRCAxMi4yIGFuZCBsYXRlci4gQ29ycmVjdGVkOiAyMDIxLTA4LTI0IDE4OjA1OjQ4IFVUQyAoc3RhYmxlLzEzLCAxMy4wLVNUQUJMRSkgMjAyMS0wOC0yNCAxODowODowNCBVVEMgKHJlbGVuZy8xMy4wLCAxMy4wLVJFTEVBU0UtcDQpIDIwMjEtMDgtMjQgMTg6MzA6MjIgVVRDIChzdGFibGUvMTIsIDEyLjItU1RBQkxFKSAyMDIxLTA4LTI0IDE4OjMyOjE5IFVUQyAocmVsZW5nLzEyLjIsIDEyLjItUkVMRUFTRS1wMTApIENWRSBOYW1lOiBDVkUtMjAyMS0zNzExLCBDVkUtMjAyMS0zNzEyIEZvciBnZW5lcmFsIGluZm9ybWF0aW9uIHJlZ2FyZGluZyBGcmVlQlNEIFNlY3VyaXR5IEFkdmlzb3JpZXMsIGluY2x1ZGluZyBkZXNjcmlwdGlvbnMgb2YgdGhlIGZpZWxkcyBhYm92ZSwgc2VjdXJpdHkgYnJhbmNoZXMsIGFuZCB0aGUgZm9sbG93aW5nIHNlY3Rpb25zLCBwbGVhc2UgdmlzaXQgPGh0dHBzOj48L2h0dHBzOj4uIEkuIEJhY2tncm91bmQgRnJlZUJTRCBpbmNsdWRlcyBzb2Z0d2FyZSBmcm9tIHRoZSBPcGVuU1NMIFByb2plY3QuIFRoZSBPcGVuU1NMIFByb2plY3QgaXMgYSBjb2xsYWJvcmF0aXZlIGVmZm9ydCB0byBkZXZlbG9wIGEgcm9idXN0LCBjb21tZXJjaWFsLWdyYWRlLCBmdWxsLWZlYXR1cmVkIE9wZW4gU291cmNlIHRvb2xraXQgZm9yIHRoZSBUcmFuc3BvcnQgTGF5ZXIgU2VjdXJpdHkgKFRMUykgcHJvdG9jb2wuIEl0IGlzIGFsc28gYSBnZW5lcmFsLXB1cnBvc2UgY3J5cHRvZ3JhcGh5IGxpYnJhcnkuIElJLiBQcm9ibGVtIERlc2NyaXB0aW9uIFRoZXJlIGFyZSB0d28gaXNzdWVzIGZpeGVkIGluIHRoaXMgc2VjdXJpdHkgYWR2aXNvcnk6IEEgYnVnIGluIHRoZSBTTTIgZGVjcnlwdGlvbiBpbXBsZW1lbnRhdGlvbiBpbmNvcnJlY3RseSBjYWxjdWxhdGVzIGEgYnVmZmVyIG5lZWRlZCB0byBob2xkIHRoZSBwbGFpbnRleHQgbGVhZGluZyB0byBhIHBvdGVudGlhbCBidWZmZXIgb3ZlcmZsb3cuIFtDVkUtMjAyMS0zNzExXSBBU04xX1NUUklORyBzdHJ1Y3R1cmVzIGRpcmVjdGx5IGNvbnN0cnVjdGVkLCBpbnN0ZWFkIG9mIHVzaW5nIGxpYnJhcnkgZnVuY3Rpb25zLCBtYXkgbm90IGJlIE5VTEwtdGVybWluYXRlZCByZXN1bHRpbmcgaW4gbGlicmFyeSBmdW5jdGlvbnMgY2F1c2luZyBhIHJlYWQgYnVmZmVyIG92ZXJydW4uIFtDVkUtMjAyMS0zNzEyXSBJSUkuIEltcGFjdCBTcGVjaWFsbHkgY3JhZnRlZCBkZWNyeXB0ZWQgU00yIGNvbnRlbnQgY291bGQgY2F1c2UgYXR0YWNrZXIgY2hvc2VuIGRhdGEgdG8gb3ZlcmZsb3cgdGhlIGJ1ZmZlciBjaGFuZ2luZyBhcHBsaWNhdGlvbiBiZWhhdmlvciBvciBjYXVzaW5nIHRoZSBhcHBsaWNhdGlvbiB0byBjcmFzaC4gW0NWRS0yMDIxLTM3MTFdIEEgc3BlY2lhbGx5IGNyYWZ0ZWQgbWFsaWNpb3VzIHN0cmluZyBjYW4gY2F1c2UgYW4gYXBwbGljYXRpb24gdGhhdCBkaXJlY3RseSBjb25zdHJ1Y3RzIHRoZSBBU04xX1NUUklORyBzdHJ1Y3R1cmUgdG8gY3Jhc2ggb3IgZGlzY2xvc2UgbWVtb3J5IGNvbnRlbnRzLiBbQ1ZFLTIwMjEtMzcxMl0gSVYuIFdvcmthcm91bmQgTm8gd29ya2Fyb3VuZCBpcyBhdmFpbGFibGUuIFYuIFNvbHV0aW9uIFVwZ3JhZGUgeW91ciB2dWxuZXJhYmxlIHN5c3RlbSB0byBhIHN1cHBvcnRlZCBGcmVlQlNEIHN0YWJsZSBvciByZWxlYXNlIC8gc2VjdXJpdHkgYnJhbmNoIChyZWxlbmcpIGRhdGVkIGFmdGVyIHRoZSBjb3JyZWN0aW9uIGRhdGUuIFBlcmZvcm0gb25lIG9mIHRoZSBmb2xsb3dpbmc6IDEpIFRvIHVwZGF0ZSB5b3VyIHZ1bG5lcmFibGUgc3lzdGVtIHZpYSBhIGJpbmFyeSBwYXRjaDogU3lzdGVtcyBydW5uaW5nIGEgUkVMRUFTRSB2ZXJzaW9uIG9mIEZyZWVCU0Qgb24gdGhlIGFtZDY0LCBpMzg2LCBvciAob24gRnJlZUJTRCAxMyBhbmQgbGF0ZXIpIGFybTY0IHBsYXRmb3JtcyBjYW4gYmUgdXBkYXRlZCB2aWEgdGhlIGZyZWVic2QtdXBkYXRlKDgpIHV0aWxpdHk6ICMgZnJlZWJzZC11cGRhdGUgZmV0Y2ggIyBmcmVlYnNkLXVwZGF0ZSBpbnN0YWxsIDIpIFRvIHVwZGF0ZSB5b3VyIHZ1bG5lcmFibGUgc3lzdGVtIHZpYSBhIHNvdXJjZSBjb2RlIHBhdGNoOiBUaGUgZm9sbG93aW5nIHBhdGNoZXMgaGF2ZSBiZWVuIHZlcmlmaWVkIHRvIGFwcGx5IHRvIHRoZSBhcHBsaWNhYmxlIEZyZWVCU0QgcmVsZWFzZSBicmFuY2hlcy4gYSkgRG93bmxvYWQgdGhlIHJlbGV2YW50IHBhdGNoIGZyb20gdGhlIGxvY2F0aW9uIGJlbG93LCBhbmQgdmVyaWZ5IHRoZSBkZXRhY2hlZCBQR1Agc2lnbmF0dXJlIHVzaW5nIHlvdXIgUEdQIHV0aWxpdHkuIFtGcmVlQlNEIDEzLjBdICMgZmV0Y2ggaHR0cHM6Ly9zZWN1cml0eS5GcmVlQlNELm9yZy9wYXRjaGVzL1NBLTIxOjE2L29wZW5zc2wuMTMucGF0Y2ggIyBmZXRjaCBodHRwczovL3NlY3VyaXR5LkZyZWVCU0Qub3JnL3BhdGNoZXMvU0EtMjE6MTYvb3BlbnNzbC4xMy5wYXRjaC5hc2MgIyBncGcgLS12ZXJpZnkgb3BlbnNzbC4xMy5wYXRjaC5hc2MgW0ZyZWVCU0QgMTIuMl0gIyBmZXRjaCBodHRwczovL3NlY3VyaXR5LkZyZWVCU0Qub3JnL3BhdGNoZXMvU0EtMjE6MTYvb3BlbnNzbC4xMi5wYXRjaCAjIGZldGNoIGh0dHBzOi8vc2VjdXJpdHkuRnJlZUJTRC5vcmcvcGF0Y2hlcy9TQS0yMToxNi9vcGVuc3NsLjEyLnBhdGNoLmFzYyAjIGdwZyAtLXZlcmlmeSBvcGVuc3NsLjEyLnBhdGNoLmFzYyBiKSBBcHBseSB0aGUgcGF0Y2guIEV4ZWN1dGUgdGhlIGZvbGxvd2luZyBjb21tYW5kcyBhcyByb290OiAjIGNkIC91c3Ivc3JjICMgcGF0Y2ggJmx0OyAvcGF0aC90by9wYXRjaCBjKSBSZWNvbXBpbGUgdGhlIG9wZXJhdGluZyBzeXN0ZW0gdXNpbmcgYnVpbGR3b3JsZCBhbmQgaW5zdGFsbHdvcmxkIGFzIGRlc2NyaWJlZCBpbiA8aHR0cHM6Pi4gUmVzdGFydCBhbGwgZGFlbW9ucyB0aGF0IHVzZSB0aGUgbGlicmFyeSwgb3IgcmVib290IHRoZSBzeXN0ZW0uIFZJLiBDb3JyZWN0aW9uIGRldGFpbHMgVGhpcyBpc3N1ZSBpcyBjb3JyZWN0ZWQgYnkgdGhlIGNvcnJlc3BvbmRpbmcgR2l0IGNvbW1pdCBoYXNoIG9yIFN1YnZlcnNpb24gcmV2aXNpb24gbnVtYmVyIGluIHRoZSBmb2xsb3dpbmcgc3RhYmxlIGFuZCByZWxlYXNlIGJyYW5jaGVzOiBCcmFuY2gvcGF0aCBIYXNoIFJldmlzaW9uIC0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBzdGFibGUvMTMvIDlkMzFhZTMxODcxMSBzdGFibGUvMTMtbjI0Njk0MCByZWxlbmcvMTMuMC8gMjI2MWM4MTRiN2ZhIHJlbGVuZy8xMy4wLW4yNDQ3NTkgc3RhYmxlLzEyLyByMzcwMzg1IHJlbGVuZy8xMi4yLyByMzcwMzk2IC0gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLSBGb3IgRnJlZUJTRCAxMyBhbmQgbGF0ZXI6IFJ1biB0aGUgZm9sbG93aW5nIGNvbW1hbmQgdG8gc2VlIHdoaWNoIGZpbGVzIHdlcmUgbW9kaWZpZWQgYnkgYSBwYXJ0aWN1bGFyIGNvbW1pdDogIyBnaXQgc2hvdyAtLXN0YXQgPGNvbW1pdCA+IE9yIHZpc2l0IHRoZSBmb2xsb3dpbmcgVVJMLCByZXBsYWNpbmcgTk5OTk5OIHdpdGggdGhlIGhhc2g6IDxodHRwczo+IFRvIGRldGVybWluZSB0aGUgY29tbWl0IGNvdW50IGluIGEgd29ya2luZyB0cmVlIChmb3IgY29tcGFyaXNvbiBhZ2FpbnN0IG5OTk5OTk4gaW4gdGhlIHRhYmxlIGFib3ZlKSwgcnVuOiAjIGdpdCByZXYtbGlzdCAtLWNvdW50IC0tZmlyc3QtcGFyZW50IEhFQUQgRm9yIEZyZWVCU0QgMTIgYW5kIGVhcmxpZXI6IFJ1biB0aGUgZm9sbG93aW5nIGNvbW1hbmQgdG8gc2VlIHdoaWNoIGZpbGVzIHdlcmUgbW9kaWZpZWQgYnkgYSBwYXJ0aWN1bGFyIHJldmlzaW9uLCByZXBsYWNpbmcgTk5OTk5OIHdpdGggdGhlIHJldmlzaW9uIG51bWJlcjogIyBzdm4gZGlmZiAtY05OTk5OTiAtLXN1bW1hcml6ZSBzdm46Ly9zdm4uZnJlZWJzZC5vcmcvYmFzZSBPciB2aXNpdCB0aGUgZm9sbG93aW5nIFVSTCwgcmVwbGFjaW5nIE5OTk5OTiB3aXRoIHRoZSByZXZpc2lvbiBudW1iZXI6IDxodHRwczo+IFZJSS4gUmVmZXJlbmNlcyA8aHR0cHM6PiA8aHR0cHM6PiA8aHR0cHM6PiBUaGUgbGF0ZXN0IHJldmlzaW9uIG9mIHRoaXMgYWR2aXNvcnkgaXMgYXZhaWxhYmxlIGF0IDxodHRwczo+IC0tLS0tQkVHSU4gUEdQIFNJR05BVFVSRS0tLS0tIGlRSXpCQUVCQ2dBZEZpRUUvQTZIaXVXdjU0Z0NqV05WMDVlUzlKNm41Y0lGQW1FbFYxOEFDZ2tRMDVlUzlKNm4gNWNMbnJBLy9Yb2lDbEptdm0rNUdLRHpQNkliREl4UnlTN05rRHhNV1kvN1EvUXZQczhmRnJGZFhpRDRxSk9jeiBWVEVsZmlvS1R2Mlg3aitYNVRPNHpSS2pnODZMYjk0Z1NYdGdPTGVLMnRXdGlja3NaM281V1BMWFhqSTBvaEJvIE0xVmhNSm9KYzNwMk9hbTl5UE9kZm5sbENUSllWNVpxbWNCTDJGWkNZV2RrZWJaV2twSGdySW1aNTN5UTg3am0gSUs0ZnkrRWw0N2wzSmIySzZQNVMxZWVXM2UzQ0VsYmtVZ05rU0lKc2w1WjloZHJUcmQzV2U2RlNFOFFRalhuKyBPc1F3NXM2VkRoSHpGRzM0eDlDSWhxcGpXUVRYNWl6ZGxhZVN1bk1YSHdlM1ZwNUNvUnBsL3NxMXI1M1BKRzFqIG5uWTdYNENzZ2J2NDhyUm02S1hPQ0hEekVhdE52bWRuQm1FemNhbklVWGVyLy90cmE5N1pkL3dsV2VwVjBod0sgVDRUY0pseS83NERIK3RXNlRRNzgvVUMwRWt4ZVRxYy9JMVF1NDFqQklIMUtEZkRzN09xS2lmdEhvMndPSmpRYSA0M0RsQXI2ZUViUkFaMmwxZStBVEpzMHI2YW8xQkNVbkIrRnBjNGNuQkxhZnQ5RzNEWUNBbVdJNHdVS1JTUkFVIG44ODBVM2tqU1R0VkRmTFRrVVEzM1FTZzB1cWR1VkVqdDlYV2UvU1Y5Um9MOHhIcXR2ay9DSVMrYUZBcVBiUjQgNjJ5YVRRQ3JVZGlka2VxbjcvWFZTY0N1WjI3YldDSnBxV0hHdGloVG5tM3lmTTA5TnRZSWpvenluZ2YyZHVhSiAwUkZ1ZXdsMWt2WW81WHN1NTRUdU8zNmRRUWRtSlUwcWF5S0VwV1oxK05hZGdKVU1BSlk9ID04SS90IC0tLS0tRU5EIFBHUCBTSUdOQVRVUkUtLS0tLTwvaHR0cHM6PjwvaHR0cHM6PjwvaHR0cHM6PjwvaHR0cHM6PjwvaHR0cHM6PjwvaHR0cHM6PjwvY29tbWl0PjwvaHR0cHM6PjwvcD48L2JvZHk+'</script>

      </head>
        <body class="valid" valid="valid" title="valid: True, node: 1, tag: body, level: 1" node_number="1"><p class="valid" valid="valid" title="valid: True, node: 2, tag: p, level: 2" node_number="2">-----BEGIN PGP SIGNED MESSAGE----- Hash: SHA512 ============================================================================= FreeBSD-SA-21:16.openssl Security Advisory The FreeBSD Project Topic: Multiple OpenSSL vulnerabilities Category: contrib Module: openssl Announced: 2021-08-24 Credits: See OpenSSL advisory in references. Affects: FreeBSD 12.2 and later. Corrected: 2021-08-24 18:05:48 UTC (stable/13, 13.0-STABLE) 2021-08-24 18:08:04 UTC (releng/13.0, 13.0-RELEASE-p4) 2021-08-24 18:30:22 UTC (stable/12, 12.2-STABLE) 2021-08-24 18:32:19 UTC (releng/12.2, 12.2-RELEASE-p10) CVE Name: CVE-2021-3711, CVE-2021-3712 For general information regarding FreeBSD Security Advisories, including descriptions of the fields above, security branches, and the following sections, please visit <https: class="valid" valid="valid" title="valid: True, node: 3, tag: https:, level: 3" node_number="3"/>. I. Background FreeBSD includes software from the OpenSSL Project. The OpenSSL Project is a collaborative effort to develop a robust, commercial-grade, full-featured Open Source toolkit for the Transport Layer Security (TLS) protocol. It is also a general-purpose cryptography library. II. Problem Description There are two issues fixed in this security advisory: A bug in the SM2 decryption implementation incorrectly calculates a buffer needed to hold the plaintext leading to a potential buffer overflow. [CVE-2021-3711] ASN1_STRING structures directly constructed, instead of using library functions, may not be NULL-terminated resulting in library functions causing a read buffer overrun. [CVE-2021-3712] III. Impact Specially crafted decrypted SM2 content could cause attacker chosen data to overflow the buffer changing application behavior or causing the application to crash. [CVE-2021-3711] A specially crafted malicious string can cause an application that directly constructs the ASN1_STRING structure to crash or disclose memory contents. [CVE-2021-3712] IV. Workaround No workaround is available. V. Solution Upgrade your vulnerable system to a supported FreeBSD stable or release / security branch (releng) dated after the correction date. Perform one of the following: 1) To update your vulnerable system via a binary patch: Systems running a RELEASE version of FreeBSD on the amd64, i386, or (on FreeBSD 13 and later) arm64 platforms can be updated via the freebsd-update(8) utility: # freebsd-update fetch # freebsd-update install 2) To update your vulnerable system via a source code patch: The following patches have been verified to apply to the applicable FreeBSD release branches. a) Download the relevant patch from the location below, and verify the detached PGP signature using your PGP utility. [FreeBSD 13.0] # fetch https://security.FreeBSD.org/patches/SA-21:16/openssl.13.patch # fetch https://security.FreeBSD.org/patches/SA-21:16/openssl.13.patch.asc # gpg --verify openssl.13.patch.asc [FreeBSD 12.2] # fetch https://security.FreeBSD.org/patches/SA-21:16/openssl.12.patch # fetch https://security.FreeBSD.org/patches/SA-21:16/openssl.12.patch.asc # gpg --verify openssl.12.patch.asc b) Apply the patch. Execute the following commands as root: # cd /usr/src # patch &lt; /path/to/patch c) Recompile the operating system using buildworld and installworld as described in <https: class="valid" valid="valid" title="valid: True, node: 4, tag: https:, level: 3" node_number="4">. Restart all daemons that use the library, or reboot the system. VI. Correction details This issue is corrected by the corresponding Git commit hash or Subversion revision number in the following stable and release branches: Branch/path Hash Revision - ------------------------------------------------------------------------- stable/13/ 9d31ae318711 stable/13-n246940 releng/13.0/ 2261c814b7fa releng/13.0-n244759 stable/12/ r370385 releng/12.2/ r370396 - ------------------------------------------------------------------------- For FreeBSD 13 and later: Run the following command to see which files were modified by a particular commit: # git show --stat <commit class="valid" valid="valid" title="valid: True, node: 5, tag: commit, level: 4" node_number="5"> Or visit the following URL, replacing NNNNNN with the hash: <https: class="valid" valid="valid" title="valid: True, node: 6, tag: https:, level: 5" node_number="6"> To determine the commit count in a working tree (for comparison against nNNNNNN in the table above), run: # git rev-list --count --first-parent HEAD For FreeBSD 12 and earlier: Run the following command to see which files were modified by a particular revision, replacing NNNNNN with the revision number: # svn diff -cNNNNNN --summarize svn://svn.freebsd.org/base Or visit the following URL, replacing NNNNNN with the revision number: <https: class="valid" valid="valid" title="valid: True, node: 7, tag: https:, level: 6" node_number="7"> VII. References <https: class="valid" valid="valid" title="valid: True, node: 8, tag: https:, level: 7" node_number="8"> <https: class="valid" valid="valid" title="valid: True, node: 9, tag: https:, level: 8" node_number="9"> <https: class="valid" valid="valid" title="valid: True, node: 10, tag: https:, level: 9" node_number="10"> The latest revision of this advisory is available at <https: class="valid" valid="valid" title="valid: True, node: 11, tag: https:, level: 10" node_number="11"> -----BEGIN PGP SIGNATURE----- iQIzBAEBCgAdFiEE/A6HiuWv54gCjWNV05eS9J6n5cIFAmElV18ACgkQ05eS9J6n 5cLnrA//XoiClJmvm+5GKDzP6IbDIxRyS7NkDxMWY/7Q/QvPs8fFrFdXiD4qJOcz VTElfioKTv2X7j+X5TO4zRKjg86Lb94gSXtgOLeK2tWticksZ3o5WPLXXjI0ohBo M1VhMJoJc3p2Oam9yPOdfnllCTJYV5ZqmcBL2FZCYWdkebZWkpHgrImZ53yQ87jm IK4fy+El47l3Jb2K6P5S1eeW3e3CElbkUgNkSIJsl5Z9hdrTrd3We6FSE8QQjXn+ OsQw5s6VDhHzFG34x9CIhqpjWQTX5izdlaeSunMXHwe3Vp5CoRpl/sq1r53PJG1j nnY7X4Csgbv48rRm6KXOCHDzEatNvmdnBmEzcanIUXer//tra97Zd/wlWepV0hwK T4TcJly/74DH+tW6TQ78/UC0EkxeTqc/I1Qu41jBIH1KDfDs7OqKiftHo2wOJjQa 43DlAr6eEbRAZ2l1e+ATJs0r6ao1BCUnB+Fpc4cnBLaft9G3DYCAmWI4wUKRSRAU n880U3kjSTtVDfLTkUQ33QSg0uqduVEjt9XWe/SV9RoL8xHqtvk/CIS+aFAqPbR4 62yaTQCrUdidkeqn7/XVScCuZ27bWCJpqWHGtihTnm3yfM09NtYIjozyngf2duaJ 0RFuewl1kvYo5Xsu54TuO36dQQdmJU0qayKEpWZ1+NadgJUMAJY= =8I/t -----END PGP SIGNATURE-----</https:></https:></https:></https:></https:></https:></commit></https:></p></body>
        <style tyle='text/css'>
body{
    position: relative;
    padding-left: 30px;
    top: 60px;
}
* {
    border: 1px solid #eee;
    padding: 5px 12px;
    margin: 3px 0;
    box-sizing: content-box;
    background-color: #fff;
    cursor: no-drop;
}
main:hover > *, section:hover > *, header:hover > *, nav:hover > *, a:hover > *, div:hover > *, p:hover > *, ul:hover > *, h1:hover > *, h2:hover > *, h3:hover > *, li:hover > *, span:hover > *{
    border: 2px solid green;
    background-color: #fffeee;
    padding: 5px 23px !important;
    margin: 1px 0;
    color: green;
}
main:hover, section:hover, header:hover, nav:hover, a:hover, div:hover, p:hover, ul:hover, h1:hover, h2:hover, h3:hover, li:hover, span:hover{
    border: 1px solid #fff;
    background-color: #eee;
}
a, span {
    display: block;
}
.selected {
    border: 2px solid orchid !important;
    opacity: 0.8;
    color: orchid !important;
}
.selected * {
    padding: 2px !important;
    color: orchid !important;
}
.valid {
  cursor: pointer;
}
.btn{
  cursor: pointer;
  font-weight: bolder;
  padding: 8px;
}
</style> 
        <script>function OpenOriginalLink($event){
    $event.stopPropagation();
    console.log(url);
}

function removeItem($event){
    $event.stopPropagation();
    console.log('Remove item: ', url)
    localStorage.removeItem(url)
}

function exportData($event){
    $event.stopPropagation();

    result = []
    for(let i=0; i<localStorage.length; i++) {
        let key = localStorage.key(i);
        result.push(localStorage.getItem(key))
    }
    const _url = URL.createObjectURL(new Blob([result.join("\n")], {type: 'text/plain'}))
    $event.target.href = _url;
    localStorage.clear()
}

var removeItemBtn = document.createElement("BUTTON");   // Create a <button> element
removeItemBtn.innerHTML = "Remove Item";
removeItemBtn.classList.add('btn');
removeItemBtn.style.position = "fixed";
removeItemBtn.style.left = '5px';
removeItemBtn.style.top = 0;
removeItemBtn.style.border = "1px solid";
removeItemBtn.style.boxShadow = "3px 3px #888";
removeItemBtn.onclick = removeItem;
document.body.appendChild(removeItemBtn);

var goToOriginLink = document.createElement("A");   // Create a <button> element
goToOriginLink.innerHTML = "GoToOrigin";
goToOriginLink.classList.add('btn');
goToOriginLink.style.position = "fixed"
goToOriginLink.style.left = '115px'
goToOriginLink.style.top = 0;
goToOriginLink.onclick = OpenOriginalLink;
goToOriginLink.setAttribute('href', decodeURIComponent(url));
goToOriginLink.target = '_blank';
document.body.appendChild(goToOriginLink);

var current = new Date
var exportDataLink = document.createElement("A");   // Create a <button> element
exportDataLink.innerHTML = "Export data";
exportDataLink.classList.add('btn');
exportDataLink.download = current.toISOString() + '.exported.txt';
exportDataLink.style.position = "fixed";
exportDataLink.style.right = '5px';
exportDataLink.style.top = 0;
exportDataLink.style.border = "1px solid #888";
exportDataLink.style.boxShadow = "3px 3px #888";
exportDataLink.onclick = exportData;
document.body.appendChild(exportDataLink);

data = {
    'title': null ,
    'article': null
}

var body = document.getElementsByTagName("body")[0];

body.onclick = function($e){
    var num = $e.target.getAttribute('node_number')
    var valid = $e.target.getAttribute('valid')

    if(!valid){
        console.log("Element is invalid")
        return
    }

    if(data.length > 2){
        data = data.splice(0, 2)
    }

    console.log("node:", $e.target)

    if(!data.title && !data.article){
        data.title = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else if (data.title && !data.article){
        data.article = num;
        console.log("data:", data)
        $e.target.classList.add('selected')
    }else{
        selected = Array.from(document.getElementsByClassName("selected"))
        selected.forEach(function(el){
            el.classList.remove('selected')
        })

        data.title = num;
        data.article = null;
        $e.target.classList.add('selected')

    }

    if(data.title && data.article){
        var obj = {
            url: url,
            text: body_html,
            title: data.title,
            article: data.article,
        }

        var datasetItem = JSON.stringify(obj)
        localStorage.setItem(url, datasetItem)
    }
}
</script> 
      </html>